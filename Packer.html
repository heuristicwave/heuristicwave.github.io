<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Provision Infrastructure with Packer</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- Custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- webfont -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Careful Writer" />
    <link rel="shortcut icon" href="https://heuristicwave.github.io/assets/built/images/water-wave-48.png" type="image/png" />
    <link rel="canonical" href="https://heuristicwave.github.io/Packer" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Heuristic Wave Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Provision Infrastructure with Packer" />
    <meta property="og:description" content="ë³¸ ê¸€ì€ HashiCorp Learn - Provision Infrastructure with Packerì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•œ ê¸€ ì…ë‹ˆë‹¤. Packerë¥¼ ì‚¬ìš©í•´ AWS AMIë¥¼ ë§Œë“¤ê³  Terraformê³¼ ì—°ê³„í•˜ì—¬ í™œìš©í•˜ëŠ” ë°©ë²•ì— ì•½ê°„ì˜ ì„¤ëª…ê³¼ íŒì„ ë‹´ì•„ í•œêµ­ì–´ë¡œ ì¬ì‘ì„±í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. (ì„¤ì¹˜ì™€ ê´€ë ¨ëœ ì¤€ë¹„ì‚¬í•­ì€ ìƒëµë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì›ë¬¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.) í”„ë¡œì íŠ¸ êµ¬ì¡° ë¨¼ì €, í•´ë‹¹ íŠœí† ë¦¬ì–¼ì„ ì§„í–‰í•˜ê¸° ìœ„í•œ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ì™€" />
    <meta property="og:url" content="https://heuristicwave.github.io/Packer" />
    <meta property="og:image" content="https://heuristicwave.github.io/assets/built/images/background/packer&terraform.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-08-02T00:00:00+00:00" />
    <meta property="article:modified_time" content="2021-08-02T00:00:00+00:00" />
    <meta property="article:tag" content="Devops" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Provision Infrastructure with Packer" />
    <meta name="twitter:description" content="ë³¸ ê¸€ì€ HashiCorp Learn - Provision Infrastructure with Packerì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•œ ê¸€ ì…ë‹ˆë‹¤. Packerë¥¼ ì‚¬ìš©í•´ AWS AMIë¥¼ ë§Œë“¤ê³  Terraformê³¼ ì—°ê³„í•˜ì—¬ í™œìš©í•˜ëŠ” ë°©ë²•ì— ì•½ê°„ì˜ ì„¤ëª…ê³¼ íŒì„ ë‹´ì•„ í•œêµ­ì–´ë¡œ ì¬ì‘ì„±í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. (ì„¤ì¹˜ì™€ ê´€ë ¨ëœ ì¤€ë¹„ì‚¬í•­ì€ ìƒëµë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì›ë¬¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.) í”„ë¡œì íŠ¸ êµ¬ì¡° ë¨¼ì €, í•´ë‹¹ íŠœí† ë¦¬ì–¼ì„ ì§„í–‰í•˜ê¸° ìœ„í•œ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ì™€" />
    <meta name="twitter:url" content="https://heuristicwave.github.io/" />
    <meta name="twitter:image" content="https://heuristicwave.github.io/assets/built/images/background/packer&terraform.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Heuristic Wave Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Devops" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Heuristic Wave Blog",
        "logo": "https://heuristicwave.github.io/"
    },
    "url": "https://heuristicwave.github.io/Packer",
    "image": {
        "@type": "ImageObject",
        "url": "https://heuristicwave.github.io/assets/built/images/background/packer&terraform.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://heuristicwave.github.io/Packer"
    },
    "description": "ë³¸ ê¸€ì€ HashiCorp Learn - Provision Infrastructure with Packerì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•œ ê¸€ ì…ë‹ˆë‹¤. Packerë¥¼ ì‚¬ìš©í•´ AWS AMIë¥¼ ë§Œë“¤ê³  Terraformê³¼ ì—°ê³„í•˜ì—¬ í™œìš©í•˜ëŠ” ë°©ë²•ì— ì•½ê°„ì˜ ì„¤ëª…ê³¼ íŒì„ ë‹´ì•„ í•œêµ­ì–´ë¡œ ì¬ì‘ì„±í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. (ì„¤ì¹˜ì™€ ê´€ë ¨ëœ ì¤€ë¹„ì‚¬í•­ì€ ìƒëµë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì›ë¬¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.) í”„ë¡œì íŠ¸ êµ¬ì¡° ë¨¼ì €, í•´ë‹¹ íŠœí† ë¦¬ì–¼ì„ ì§„í–‰í•˜ê¸° ìœ„í•œ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ì™€"
}
    </script>
    <script data-ad-client="ca-pub-6093187208665634" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0FTXSPJZFY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-0FTXSPJZFY');
    </script>
    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Provision Infrastructure with Packer" href="https://heuristicwave.github.io/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://heuristicwave.github.io/">Heuristic Wave Blog</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-extracurricular" role="menuitem"><a href="/tag/uncategorized/">Uncategorized</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/aws/">AWS</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/backend/">Back-end</a></li>
    <li class="nav-devops" role="menuitem"><a href="/tag/devops/">DevOps</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/security/">Security</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tagë³„ Posts</a>
    </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-devops tag-aws post tag-devops ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 2 August 2021"> 2 August 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/devops/'>DEVOPS</a>,
                            
                        
                            
                               <a href='/tag/aws/'>AWS</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Provision Infrastructure with Packer</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/background/packer&terraform.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>ë³¸ ê¸€ì€ <a href="https://learn.hashicorp.com/tutorials/terraform/packer">HashiCorp Learn - Provision Infrastructure with Packer</a>ì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•œ ê¸€ ì…ë‹ˆë‹¤.</p>

<p><br /></p>

<blockquote>
  <p>Packerë¥¼ ì‚¬ìš©í•´ AWS AMIë¥¼ ë§Œë“¤ê³  Terraformê³¼ ì—°ê³„í•˜ì—¬ í™œìš©í•˜ëŠ” ë°©ë²•ì— ì•½ê°„ì˜ ì„¤ëª…ê³¼ íŒì„ ë‹´ì•„ í•œêµ­ì–´ë¡œ ì¬ì‘ì„±í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. (ì„¤ì¹˜ì™€ ê´€ë ¨ëœ ì¤€ë¹„ì‚¬í•­ì€ ìƒëµë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì›ë¬¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.)</p>
</blockquote>

<p><br /></p>

<h2 id="í”„ë¡œì íŠ¸-êµ¬ì¡°">í”„ë¡œì íŠ¸ êµ¬ì¡°</h2>

<p>ë¨¼ì €, í•´ë‹¹ íŠœí† ë¦¬ì–¼ì„ ì§„í–‰í•˜ê¸° ìœ„í•œ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ì™€ í´ë”ì™€ íŒŒì¼ì„ ì¤€ë¹„í•´ì£¼ì„¸ìš”.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">.</span>
â””â”€â”€ provision-infra-with-packer
    â”œâ”€â”€ images
    â”‚   â””â”€â”€ image.pkr.hcl
    â”œâ”€â”€ instances
    â”‚   â”œâ”€â”€ main.tf
    â”‚   â””â”€â”€ variables.tf
    â””â”€â”€ scripts
        â””â”€â”€ setup.sh
</code></pre></div></div>

<p><br /></p>

<h2 id="local-ssh-key-ìƒì„±í•˜ê¸°">Local SSH key ìƒì„±í•˜ê¸°</h2>

<p><code class="language-plaintext highlighter-rouge">provision-infra-with-packer</code> í´ë” ì•ˆì—ì„œ AWS AMIë¡œ ë§Œë“¤ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•˜ê¸° ìœ„í•œ SSH í‚¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
í•„ìëŠ” ì‚¬ìš©í•  ê³µê°œí‚¤ë¥¼ Mac OSì—ì„œ <code class="language-plaintext highlighter-rouge">ssh-keygen</code>ìœ¼ë¡œ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ê°ì í™˜ê²½ì— ë§ëŠ” ë°©ë²•ìœ¼ë¡œ SSH ê³µê°œí‚¤ë¥¼ ìƒì„±í•˜ì„¸ìš”.
ì•”í˜¸í™” íƒ€ì…(<code class="language-plaintext highlighter-rouge">-t</code>)ì„ RSAë¡œ ì£¼ì„(<code class="language-plaintext highlighter-rouge">-C</code>)ì„ ì´ë©”ì¼ë¡œ ìƒì„±ë˜ëŠ” ê³µê°œí‚¤ì˜ ìœ„ì¹˜(<code class="language-plaintext highlighter-rouge">-f</code>)ë¥¼ í˜„ì¬ directoryë¡œ ì„¤ì •í•˜ê³  ê³µê°œí‚¤ì˜ ì´ë¦„ì„ <code class="language-plaintext highlighter-rouge">tf-packer</code>ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ê³  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ë˜ì§€ë§Œ í¸ì˜ìƒ ê³µë°±ìœ¼ë¡œ ë‘ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-C</span> <span class="s2">"your_email@example.com"</span> <span class="nt">-f</span> ./tf-packer
</code></pre></div></div>

<p>ì´í›„ <code class="language-plaintext highlighter-rouge">tf-packer</code>ì™€ <code class="language-plaintext highlighter-rouge">tf-packer.pub</code> 2ê°€ì§€ íŒŒì¼ì´ ìƒì„±ë˜ì—ˆë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ ğŸš€</p>

<p><br /></p>

<h2 id="packer-ì½”ë“œ-ì‘ì„±í•˜ê¸°">Packer ì½”ë“œ ì‘ì„±í•˜ê¸°</h2>

<p><em><code class="language-plaintext highlighter-rouge">image.pkr.hcl</code> íŒŒì¼ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤.</em> <br /></p>

<h3 id="1ï¸âƒ£-ami-êµ¬ì¶•ì—-í•„ìš”í•œ-config-ì‘ì„±">1ï¸âƒ£ AMI êµ¬ì¶•ì— í•„ìš”í•œ config ì‘ì„±</h3>

<p>packerê°€ ë¹Œë“œí•œ ì´ë¯¸ì§€ê°€ ì €ì¥ë  ë¦¬ì „ì˜ ì •ë³´ì™€ AMIì— timestamp ì •ë³´ë¥¼ ë„£ê¸° ìœ„í•œ configë¥¼ ì°¨ë¡€ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>variable <span class="s2">"region"</span> <span class="o">{</span>
  <span class="nb">type</span>    <span class="o">=</span> string
  default <span class="o">=</span> <span class="s2">"us-east-1"</span>
<span class="o">}</span>

locals <span class="o">{</span> timestamp <span class="o">=</span> regex_replace<span class="o">(</span>timestamp<span class="o">()</span>, <span class="s2">"[- TZ:]"</span>, <span class="s2">""</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="2ï¸âƒ£ï¸-base-amiì—-ëŒ€í•œ-source-ami-config-ì‘ì„±">2ï¸âƒ£ï¸ Base AMIì— ëŒ€í•œ Source AMI config ì‘ì„±</h3>

<p>packerê°€ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” Base AMIì— ëŒ€í•œ ì •ë³´ë¥¼ <code class="language-plaintext highlighter-rouge">source</code> ë¸”ë¡ì— ì •ì˜í•©ë‹ˆë‹¤.
1ë‹¨ê³„ì—ì„œ ì‘ì„±í•œ config ê°’ì„ í™œìš©í•´ ë¦¬ì „ê³¼ timestampë¥¼ ë„£ì–´ì£¼ëŠ” ì½”ë“œì™€ Packer Builderë¡œ ì‚¬ìš©í•  <strong>ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì„ ì§€ì •</strong>í•©ë‹ˆë‹¤.
ì´í›„, AWSì— ì¡´ì¬í•˜ëŠ” ìˆ˜ë§ì€ AMI ì¤‘ì—ì„œ sourceë¡œ í™œìš©í•  ì´ë¯¸ì§€ë¥¼ <strong>filter</strong> ì½”ë“œë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
(<code class="language-plaintext highlighter-rouge">name</code> ë¶€ë¶„ì— ì§ì ‘ ami ë²ˆí˜¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê¸°ì¬ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> <span class="s2">"amazon-ebs"</span> <span class="s2">"example"</span> <span class="o">{</span>
  ami_name      <span class="o">=</span> <span class="s2">"learn-terraform-packer-</span><span class="k">${</span><span class="nv">local</span><span class="p">.timestamp</span><span class="k">}</span><span class="s2">"</span>
  instance_type <span class="o">=</span> <span class="s2">"t2.micro"</span>
  region        <span class="o">=</span> var.region
  source_ami_filter <span class="o">{</span>
    filters <span class="o">=</span> <span class="o">{</span>
      name                <span class="o">=</span> <span class="s2">"ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*"</span>
      root-device-type    <span class="o">=</span> <span class="s2">"ebs"</span>
      virtualization-type <span class="o">=</span> <span class="s2">"hvm"</span>
    <span class="o">}</span>
    most_recent <span class="o">=</span> <span class="nb">true
    </span>owners      <span class="o">=</span> <span class="o">[</span><span class="s2">"099720109477"</span><span class="o">]</span>
  <span class="o">}</span>
  ssh_username <span class="o">=</span> <span class="s2">"ubuntu"</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3ï¸âƒ£-packer-build-config-ì‘ì„±">3ï¸âƒ£ Packer build config ì‘ì„±</h3>

<p>build ë¶€ë¶„ì—ì„œëŠ” <a href="https://learn.hashicorp.com/tutorials/packer/aws-get-started-provision?in=packer/aws-get-started#add-provisioner-to-template">í™˜ê²½ë³€ìˆ˜ ì„¸íŒ…ì´ë‚˜ ëª…ë ¹ì–´ë¥¼ inline í˜•íƒœ</a>ë¡œ ê¸°ì… í•  ìˆ˜ ìˆì§€ë§Œ,
ì•„ë˜ì™€ ê°™ì€ ê°„ë‹¨í•œ ê¸°ëŠ¥ë§Œ ìˆ˜í–‰í•˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">hcl</code> ë¬¸ë²•ì— ë”°ë¼ <strong>sourceë¥¼ ì§€ì •</strong>í•˜ê³ , í”„ë¡œë¹„ì €ë‹ì„ ìœ„í•œ <strong>ê³µê°œí‚¤ì˜ ìœ„ì¹˜ë¥¼ ëª…ì„¸</strong>í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">source</code>ëŠ” ë¡œì»¬ ë¨¸ì‹ , <code class="language-plaintext highlighter-rouge">destination</code>ì€ ì›ê²© ë¨¸ì‹  ì…ë‹ˆë‹¤.
ë§ˆì§€ë§‰ìœ¼ë¡œ Packerë¡œ ë¹Œë“œí•œ ì´ë¯¸ì§€ì—ì„œ Application Setupì´ ë‹´ê¸´ <strong>scriptë¥¼ ì§€ì •</strong>í•©ë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build <span class="o">{</span>
  sources <span class="o">=</span> <span class="o">[</span><span class="s2">"source.amazon-ebs.example"</span><span class="o">]</span>

  provisioner <span class="s2">"file"</span> <span class="o">{</span>
    <span class="nb">source</span>      <span class="o">=</span> <span class="s2">"../tf-packer.pub"</span>
    destination <span class="o">=</span> <span class="s2">"/tmp/tf-packer.pub"</span>
  <span class="o">}</span>
  provisioner <span class="s2">"shell"</span> <span class="o">{</span>
    script <span class="o">=</span> <span class="s2">"../scripts/setup.sh"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="4ï¸âƒ£-shell-script-ì‘ì„±">4ï¸âƒ£ Shell script ì‘ì„±</h2>

<p><em>í•´ë‹¹ ì‘ì—…ì€ <code class="language-plaintext highlighter-rouge">scripts</code> í´ë”ì˜ <code class="language-plaintext highlighter-rouge">setup.sh</code>ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤.</em> <br /></p>

<p>ì´ ë¶€ë¶„ì€ Terraformìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ í•œ ì¸í”„ë¼ë¥¼ ì›¹í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ ìƒ˜í”Œì„ ë„ìš°ëŠ” ì½”ë“œê°€ ë‹´ê²¨ìˆìŠµë‹ˆë‹¤.
ì•„ë˜ Scriptì— í•„ìš”í•œ ì¢…ì†ì„± ì„¤ì¹˜, <code class="language-plaintext highlighter-rouge">terraform</code>ì„ userì— ì¶”ê°€, ìƒì„±í•œ SSHí‚¤ ì„¤ì¹˜, ìƒ˜í”Œ Go App ì„¤ì¹˜ê°€ ë‹¨ê³„ê°€ ì‘ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>

<noscript>
  <pre>#!/bin/bash
set -e

# Install necessary dependencies
sudo DEBIAN_FRONTEND=noninteractive apt-get -y -o Dpkg::Options::=&quot;--force-confdef&quot; -o Dpkg::Options::=&quot;--force-confold&quot; dist-upgrade
sudo apt-get -y -qq install curl wget git vim apt-transport-https ca-certificates
sudo add-apt-repository ppa:longsleep/golang-backports -y
sudo apt -y -qq install golang-go

# Setup sudo to allow no-password sudo for &quot;hashicorp&quot; group and adding &quot;terraform&quot; user
sudo groupadd -r hashicorp
sudo useradd -m -s /bin/bash terraform
sudo usermod -a -G hashicorp terraform
sudo cp /etc/sudoers /etc/sudoers.orig
echo &quot;terraform ALL=(ALL) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/terraform

# Installing SSH key
sudo mkdir -p /home/terraform/.ssh
sudo chmod 700 /home/terraform/.ssh
sudo cp /tmp/tf-packer.pub /home/terraform/.ssh/authorized_keys
sudo chmod 600 /home/terraform/.ssh/authorized_keys
sudo chown -R terraform /home/terraform/.ssh
sudo usermod --shell /bin/bash terraform

# Create GOPATH for Terraform user &amp; download the webapp from GitHub
sudo -H -i -u terraform -- env bash &lt;&lt; EOF
whoami
echo ~terraform

cd /home/terraform

export GOROOT=/usr/lib/go
export GOPATH=/home/terraform/go
export PATH=$PATH:$GOROOT/bin:$GOPATH/bin
go get -d github.com/hashicorp/learn-go-webapp-demo
EOF
</pre>
</noscript>
<script src="https://gist.github.com/heuristicwave/3c0d9afefb5e04d7b69700f11918e9a0.js"> </script>

<p>1 ~ 4ë‹¨ê³„ë¥¼ ë§ˆì³¤ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">images</code> í´ë” ìœ„ì¹˜ì— <code class="language-plaintext highlighter-rouge">packer build image.pkr.hcl</code> ëª…ë ¹ì–´ë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.</p>

<p><br /></p>

<p>ì´ë¯¸ì§€ ë¹Œë“œ í›„, ì½˜ì†” <strong>Images</strong> íƒ­ì˜ <strong>AMIs</strong>ì„ í™•ì¸í•˜ë©´ ë¹Œë“œí•œ ì´ë¯¸ì§€ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.
ë˜í•œ, ì¸ìŠ¤í„´ìŠ¤ íƒ­ì„ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ Base AMIë¥¼ ë§Œë“¤ê¸° ìœ„í•œ Packer Builderì˜ í”ì ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="/assets/built/images/post/packerBuilder.png" alt="Packer_Builder" />
í•´ë‹¹ í™”ë©´ì˜ Instance IDë¥¼ ëˆŒëŸ¬ ì„¤ì •ë“¤ì„ í™•ì¸í•´ë³´ë©´ source ë¸”ë¡ì— ì •ì˜í•œ ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="terraformìœ¼ë¡œ-packer-ì´ë¯¸ì§€-ë°°í¬">Terraformìœ¼ë¡œ Packer ì´ë¯¸ì§€ ë°°í¬</h2>

<p><em>í•´ë‹¹ ì‘ì—…ì€ <code class="language-plaintext highlighter-rouge">instances</code> í´ë”ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤.</em> <br /></p>

<h3 id="sample-app-infra-code-ì‘ì„±í•˜ê¸°">Sample App Infra Code ì‘ì„±í•˜ê¸°</h3>

<p>ì•„ë˜ ğŸ›  ì´ëª¨í‹°ì½˜ì„ í´ë¦­í•˜ì—¬ <code class="language-plaintext highlighter-rouge">main.tf</code>ì™€ <code class="language-plaintext highlighter-rouge">varaiables.tf</code>ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.</p>

<details>
  <summary>ğŸ”¨ <code class="language-plaintext highlighter-rouge">main.tf</code> ğŸ”¨</summary>
  <p><br /></p>

  <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.26.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"~&gt; 1.0.2"</span>
<span class="p">}</span>

<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">region</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>           <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cidr_vpc</span>
  <span class="nx">enable_dns_support</span>   <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">enable_dns_hostnames</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_internet_gateway"</span> <span class="s2">"igw"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"subnet_public"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cidr_subnet</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_route_table"</span> <span class="s2">"rtb_public"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">route</span> <span class="p">{</span>
    <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"0.0.0.0/0"</span>
    <span class="nx">gateway_id</span> <span class="p">=</span> <span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">igw</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"rta_subnet_public"</span> <span class="p">{</span>
  <span class="nx">subnet_id</span>      <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">subnet_public</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="p">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">rtb_public</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"sg_22_80"</span> <span class="p">{</span>
  <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"sg_22"</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">id</span>

  <span class="c1"># SSH access from the VPC</span>
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">8080</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">8080</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">egress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">0</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">0</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"-1"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">ami</span>                         <span class="p">=</span> <span class="s2">"ami-YOUR-AMI-ID"</span>
  <span class="nx">instance_type</span>               <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">subnet_id</span>                   <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">subnet_public</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">vpc_security_group_ids</span>      <span class="p">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">sg_22_80</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
  <span class="nx">associate_public_ip_address</span> <span class="p">=</span> <span class="kc">true</span>

  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Learn-Packer"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">output</span> <span class="s2">"public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">public_ip</span>
<span class="p">}</span>
</code></pre></div>  </div>

</details>

<details>
  <summary>ğŸ”§ <code class="language-plaintext highlighter-rouge">varaiables.tf</code> ğŸ”§</summary>
  <p><br /></p>

  <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">variable</span> <span class="s2">"cidr_vpc"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"CIDR block for the VPC"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"10.1.0.0/16"</span>
<span class="p">}</span>
<span class="k">variable</span> <span class="s2">"cidr_subnet"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"CIDR block for the subnet"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"10.1.0.0/24"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"environment_tag"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Environment tag"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"Learn"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"region"</span><span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The region Terraform deploys your instance"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"us-east-1"</span>
<span class="p">}</span>

</code></pre></div>  </div>
</details>
<p><br /></p>

<blockquote>
  <p>ì¸í”„ë¼ ì½”ë“œì— ëŒ€í•œ ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤. <br />
ì¸í”„ë¼ì— ëŒ€í•œ í…Œë¼í¼ ì½”ë“œê°€ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ë‹¤ë¥¸ ê²Œì‹œê¸€ì´ë‚˜ <a href="https://heuristicwave.github.io/3Tier">ì œ í¬ìŠ¤íŒ…</a>ì„ ì½ì–´ë³´ì„¸ìš”!</p>
</blockquote>

<p><br /></p>

<h3 id="ami-query-í•˜ê¸°">AMI Query í•˜ê¸°</h3>

<p><a href="https://learn.hashicorp.com/tutorials/terraform/packer">ë³¸ë¬¸</a>ì—ëŠ” ì†Œê°œë˜ì§€ ì•Šì•˜ì§€ë§Œ, Packerì™€ Terraformì˜ í†µí•©ì„ ìœ„í•´ í•„ìê°€ ì‘ì„±í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.
Terraformì˜ <code class="language-plaintext highlighter-rouge">Data Sources</code>ë¥¼ í™œìš©í•´ ë¹Œë“œëœ AMIë¥¼ Queryí•˜ì—¬ ìƒ˜í”Œ ì•±ì„ í”„ë¡œë¹„ì €ë‹ í•´ë´…ì‹œë‹¤.
ì„ í–‰ ì‘ì—…ì—ì„œ ì§„í–‰í•œ <code class="language-plaintext highlighter-rouge">main.tf</code> í•˜ë‹¨ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>

<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">data</span> <span class="s2">"aws_ami_ids"</span> <span class="s2">"myami"</span> <span class="p">{</span>
  <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"YOUR Account ID"</span><span class="p">]</span>
  <span class="c1"># sort_ascending = true</span>
  
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"learn-terraform-packer-*"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Packerë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí–ˆìœ¼ë¯€ë¡œ, ami ownerê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!
<code class="language-plaintext highlighter-rouge">owners</code> ë¶€ë¶„ì— ìì‹ ì˜ ê³„ì • IDë¥¼ ì‘ì„±í•˜ê³  <code class="language-plaintext highlighter-rouge">filter</code>ì— packer buildë¥¼ í•  ë–„ ì‚¬ìš©í•œ ami_nameì„ value ê°’ìœ¼ë¡œ ë„£ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><strong>sort_ascending</strong> default ê°’ì´ false</p>

  <p>sort_ascending = false : listì˜ 0ë²ˆì§¸ ìš”ì†Œê°€ latest <br />
sort_ascending = true : ë§Œë“¤ì–´ì§„ ìˆœì„œëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ ìƒì„± (ê°€ì¥ ë¨¼ì € ìƒì„±ëœ amiê°€ 0ë²ˆ)</p>
</blockquote>

<p>ì´ì–´ì„œ <code class="language-plaintext highlighter-rouge">main.tf</code>ì— ì¸ìŠ¤í„´ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•œ ë¶€ë¶„ì˜ <code class="language-plaintext highlighter-rouge">ami = "ami-YOUR-AMI-ID"</code> ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ëŒ€ì²´í•©ë‹ˆë‹¤.
<code class="language-plaintext highlighter-rouge">data</code> ê°ì²´ì— í•„í„°ë§í•œ ê²°ê³¼ ê°’ë“¤ì´ ë¹Œë“œëœ AMIë“¤ì´ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ”ë° <strong>latest</strong> ë²„ì „ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ 0ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤.
í¸ì˜ìƒ ì‚¬ìš©ëœ ami ë²ˆí˜¸ë¥¼ í„°ë¯¸ë„ì—ì„œ í™•ì¸ í•  ìˆ˜ ìˆë„ë¡ <code class="language-plaintext highlighter-rouge">output</code>ì— ëŒ€í•œ ì½”ë“œë„ í•¨ê»˜ ì‘ì„±í•©ë‹ˆë‹¤.</p>

<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">ami</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami_ids</span><span class="p">.</span><span class="nx">myami</span><span class="p">.</span><span class="nx">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># "ami-YOUR-AMI-ID"</span>
  <span class="c1"># Skip Other Config</span>
<span class="p">}</span>

<span class="k">output</span> <span class="s2">"my_ami"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">ami</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í…Œë¼í¼ ì½”ë“œê°€ ìœ„ì¹˜í•œ í´ë”ì—ì„œ(<code class="language-plaintext highlighter-rouge">instances</code> í´ë” í•˜ìœ„) ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
<code class="language-plaintext highlighter-rouge">terraform init &amp;&amp; terraform apply</code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">yes</code>ë¥¼ ê¸°ì…í•©ë‹ˆë‹¤. <br /></p>

<p>ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform state list
data.aws_ami_ids.myami
aws_instance.web
aws_internet_gateway.igw
aws_route_table.rtb_public
aws_route_table_association.rta_subnet_public
aws_security_group.sg_22_80
aws_subnet.subnet_public
aws_vpc.vpc
</code></pre></div></div>

<blockquote>
  <p>data objectì— ë‹´ê¸´ ì •ë³´ê°€ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´? <br />
<code class="language-plaintext highlighter-rouge">$ terraform state show data.aws_ami_ids.myami.ids</code></p>
</blockquote>

<p><br /></p>

<h2 id="ì¸ìŠ¤í„´ìŠ¤-í™•ì¸í•˜ê¸°">ì¸ìŠ¤í„´ìŠ¤ í™•ì¸í•˜ê¸°</h2>

<p>SSHë¥¼ í†µí•´ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°í•©ë‹ˆë‹¤. <br />
<code class="language-plaintext highlighter-rouge">ssh terraform@$(terraform output -raw public_ip) -i ../tf-packer</code></p>

<p>Go ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•˜ì„¸ìš”. <br />
<code class="language-plaintext highlighter-rouge">cd go/src/github.com/hashicorp/learn-go-webapp-demo</code></p>

<p>ë°ëª¨ ì•±ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. <br />
<code class="language-plaintext highlighter-rouge">go run webapp.go</code></p>

<p>ë°°í¬í•œ ì•± í™•ì¸ì„ ìœ„í•´ <code class="language-plaintext highlighter-rouge">terraform output public_ip</code>ë¡œ ì–»ì€ IPì— 8080 í¬íŠ¸ë¡œ ì ‘ì†í•˜ë©´ ê°„ë‹¨í•œ í…ŒíŠ¸ë¦¬ìŠ¤ ê²Œì„ ì•±ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="ì¸ìŠ¤í„´ìŠ¤-ë¦¬ì†ŒìŠ¤-íšŒìˆ˜">ì¸ìŠ¤í„´ìŠ¤ ë¦¬ì†ŒìŠ¤ íšŒìˆ˜</h2>

<p><code class="language-plaintext highlighter-rouge">terraform destroy</code> ëª…ë ¹ì–´ë¡œ ìƒê¸° í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•œ ì¸í”„ë¼ë¥¼ ë¦¬ì†ŒìŠ¤ë¥¼ íšŒìˆ˜í•©ë‹ˆë‹¤. Packerë¡œ ì‘ì„±í•œ ì´ë¯¸ì§€ëŠ” íŒŒê´´ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<p>ìœ„ì™€ ê°™ì€ ë‹¨ê³„ë“¤ì„ í†µí•´ íŒ¨ì»¤ë¡œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  í…Œë¼í¼ê³¼ í†µí•©í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•´ë³´ì•˜ìŠµë‹ˆë‹¤.
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë¤˜ë˜ ë‚´ìš©ì€ <strong>Immutable Servers</strong>ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì— ì¶”ê°€ë¡œ <strong>Ansible</strong>ì„ í†µí•©í•œë‹¤ë©´, <strong>Immutable Infrastructure</strong>ë¥¼ êµ¬ì¶•í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<hr />

<p><span class="table-of-contents-list">Terraform Courses</span></p>
<ul class="table-of-contents-list">
    <li><a href="./3Tier">3-Tier VPC Architecture with Terraform</a></li>
    <li><a href="./CodeCommit">ECR Pipeline with Terraform â…  (CodeCommit)</a></li>
    <li><a href="./CodeBuild">ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)</a></li>
    <li><a href="./CodePipeline">ECR Pipeline with Terraform â…¢ (CodePipeline)</a></li>
    <li><a href="./Packer">Provision Infrastructure with Packer</a></li>
</ul>

<p><br /></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Heuristic Wave Blog</h3>
                    <p>Get the latest posts delivered right via RSS</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="url" name="rss url" value="https://heuristicwave.github.io" readonly />
    </div>
    <!--To Do Rss Web Font <i class="fas fa-rss"></i> -->
    <button class="" type="submit" disabled><span>Copy</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://heuristicwave.github.io/Packer';
                            this.page.identifier = '/Packer';
                            this.page.title = 'Provision Infrastructure with Packer';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://heuristicwave-github-io.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Heuristic Wave Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/devops/">Devops</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/DeclarativeVSImperativeinK8s">Declarative vs Imperative in Kubernetes</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/TerraformTips5">Terraform Tips 5 - Import</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/TerraformTips4">Terraform Tips 4 - Move (Refactoring)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/devops/">
                                
                                    See all 15 posts  â†’
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/SelfService">
                <div class="post-card-image" style="background-image: url(/assets/built/images/background/self.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/SelfService">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Devops</span>
                            
                        
                    

                    <h2 class="post-card-title">Self-service Infrastructure</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/EKS_Max_Pods">
                <div class="post-card-image" style="background-image: url(/assets/built/images/background/eks.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/EKS_Max_Pods">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Aws</span>
                            
                        
                            
                               <span class="post-card-tags">Devops</span>
                            
                        
                            
                                <span class="post-card-tags">Backend</span>
                            
                        
                    

                    <h2 class="post-card-title">Look into EKS max pods</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://heuristicwave.github.io/">
            
            <span>Heuristic Wave Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Provision Infrastructure with Packer</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Provision+Infrastructure+with+Packer&amp;url=https://heuristicwave.github.ioPacker"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://heuristicwave.github.ioPacker"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://heuristicwave.github.io/">Heuristic Wave Blog</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Search on Heuristic Wave Blog</h1>
                <p class="subscribe-overlay-description">lunr.jsë¥¼ ì´ìš©í•œ posts ê²€ìƒ‰</p>
                <span id="searchform" method="post" action="/search/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                <br>
            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-0FTXSPJZFY', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
