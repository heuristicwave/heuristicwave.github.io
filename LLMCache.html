<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Providing a caching layer for LLM with Langchain in AWS</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- Custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />
    
    <!-- TOC CSS - 포스트 페이지에서만 로드 -->
    
    <link rel="stylesheet" type="text/css" href="//assets/css/toc.css" />
    
    
    <!-- Inline Dark Theme CSS for immediate effect -->
    <style>
    /* Dark Theme Styles */
    [data-theme="dark"] body {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .site-main {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-card {
        background-color: #2a2d32 !important;
        border-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-card-title,
    [data-theme="dark"] .post-card-excerpt,
    [data-theme="dark"] .post-card-content-link,
    [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, 
    [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] h6,
    [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] div {
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-full-content {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-template .site-main,
    [data-theme="dark"] .page-template .site-main {
        background-color: #15171a !important;
    }
    
    /* 포스트 카드 메타 영역 - 카드와 동일한 배경색 */
    [data-theme="dark"] .post-card-meta {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
        border-top: 1px solid #3a3d42 !important;
        margin: 0 !important;
        padding: 15px 25px !important;
    }
    
    /* 작성자 정보 통일감 있게 조정 - 더 구체적인 선택자 */
    [data-theme="dark"] .post-card-author,
    [data-theme="dark"] .author-card-name,
    [data-theme="dark"] .author-card-name a,
    [data-theme="dark"] .post-full-meta,
    [data-theme="dark"] .post-full-meta-date,
    [data-theme="dark"] .post-card-meta .post-card-author,
    [data-theme="dark"] .post-card-meta a {
        color: #ffffff !important;
    }
    
    /* 읽기 시간 정보 - 흰색으로 통일 */
    [data-theme="dark"] .reading-time {
        color: #ffffff !important;
    }
    
    /* 태그 정보 */
    [data-theme="dark"] .post-card-tags {
        color: #c5d2d9 !important;
    }
    
    /* 작성자 프로필 이미지 테두리 */
    [data-theme="dark"] .author-profile-image {
        border: 2px solid #3a3d42 !important;
    }
    
    /* 포스트 메타 정보 전체 - 카드와 완전히 통일 */
    [data-theme="dark"] .post-card-meta,
    [data-theme="dark"] .post-card-meta *:not(a) {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    /* 메타 영역의 모든 하위 요소들 */
    [data-theme="dark"] .post-card-meta *,
    [data-theme="dark"] .post-card-meta .post-card-author,
    [data-theme="dark"] .post-card-meta .reading-time,
    [data-theme="dark"] .post-card-meta span,
    [data-theme="dark"] .post-card-meta div {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    /* 메타 영역의 링크들 */
    [data-theme="dark"] .post-card-meta a {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    /* 메타 영역 구분선 스타일 */
    [data-theme="dark"] .post-card-meta {
        position: relative;
        border-radius: 0 0 8px 8px !important;
    }
    
    [data-theme="dark"] .post-card-meta::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background-color: #3a3d42;
    }
    
    /* 카테고리/태그 링크 */
    [data-theme="dark"] .post-card-tags a,
    [data-theme="dark"] .tag {
        color: #3eb0ef !important;
    }
    
    /* 댓글 시스템 스타일 개선 */
    [data-theme="dark"] .post-full-comments,
    [data-theme="dark"] .post-full-comments * {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    /* 댓글 입력 폼 */
    [data-theme="dark"] .post-full-comments input,
    [data-theme="dark"] .post-full-comments textarea,
    [data-theme="dark"] .post-full-comments button {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
        border: 1px solid #3a3d42 !important;
    }
    
    /* 라이트 모드에서 댓글 부분 수정 */
    [data-theme="light"] .post-full-comments,
    [data-theme="light"] .post-full-comments *,
    body:not([data-theme="dark"]) .post-full-comments,
    body:not([data-theme="dark"]) .post-full-comments * {
        background-color: #ffffff !important;
        color: #15171a !important;
    }
    
    /* 더 구체적인 작성자 정보 선택자들 */
    [data-theme="dark"] .post-card-meta .post-card-author,
    [data-theme="dark"] .post-card-meta a[href*="author"],
    [data-theme="dark"] .post-card-meta span,
    [data-theme="dark"] .author-list .author-card-name,
    [data-theme="dark"] .byline-meta .author,
    [data-theme="dark"] .author-meta,
    [data-theme="dark"] .post-meta .author {
        color: #ffffff !important;
    }
    
    /* 읽기 시간 더 구체적으로 */
    [data-theme="dark"] .post-card-meta .reading-time,
    [data-theme="dark"] .reading-time,
    [data-theme="dark"] .post-meta .reading-time,
    [data-theme="dark"] [class*="reading"],
    [data-theme="dark"] [class*="min-read"] {
        color: #ffffff !important;
    }
    
    /* 모든 메타 정보를 강제로 흰색 처리 */
    [data-theme="dark"] .post-card-meta > *,
    [data-theme="dark"] .post-card-meta span,
    [data-theme="dark"] .post-card-meta div,
    [data-theme="dark"] .post-card-meta a:not([href*="tag"]) {
        color: #ffffff !important;
    }
    
    /* 전역적으로 모든 텍스트를 흰색으로 (네비게이션 제외) */
    [data-theme="dark"] body *:not(.site-nav *):not(.site-header *) {
        color: #ffffff !important;
    }
    
    /* 링크는 파란색으로 */
    [data-theme="dark"] a:not(.site-nav a):not(.site-header a) {
        color: #3eb0ef !important;
    }
    
    /* Copy 버튼 숨기기 */
    .copy-button,
    .copy-btn,
    [class*="copy"],
    button[title*="Copy"],
    button[aria-label*="Copy"],
    .highlight .copy,
    pre .copy,
    code .copy,
    .code-toolbar .toolbar,
    .code-toolbar .toolbar-item {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
    }
    
    /* 일반적인 Copy 텍스트가 포함된 요소들 숨기기 */
    *[class*="copy"]:not(.copyright),
    *[id*="copy"]:not(.copyright),
    button:contains("Copy"),
    span:contains("Copy -->"),
    div:contains("Copy -->") {
        display: none !important;
    }
    
    [data-theme="dark"] a:not(.site-nav a) {
        color: #3eb0ef !important;
    }
    
    /* Bold and Strong text - 더 밝은 색상으로 강조 */
    [data-theme="dark"] strong,
    [data-theme="dark"] b,
    [data-theme="dark"] .post-full-content strong,
    [data-theme="dark"] .post-full-content b {
        color: #ffffff !important;
        font-weight: 700 !important;
        text-shadow: 0 0 1px rgba(255, 255, 255, 0.3) !important;
    }
    
    /* Inline code blocks - 배경색과 테두리로 구분 */
    [data-theme="dark"] code,
    [data-theme="dark"] .post-full-content code {
        background-color: #2a2d32 !important;
        color: #a4d037 !important; /* 연두색으로 강조 */
        border: 1px solid #3a3d42 !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        font-weight: 500 !important;
    }
    
    /* Pre code blocks - 더 어두운 배경 */
    [data-theme="dark"] pre,
    [data-theme="dark"] .post-full-content pre {
        background-color: #1a1d20 !important;
        border: 1px solid #3a3d42 !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] pre code,
    [data-theme="dark"] .post-full-content pre code {
        background-color: transparent !important;
        border: none !important;
        color: #ffffff !important;
        padding: 0 !important;
    }
    
    /* Emphasis and italic text */
    [data-theme="dark"] em,
    [data-theme="dark"] i,
    [data-theme="dark"] .post-full-content em,
    [data-theme="dark"] .post-full-content i {
        color: #c5d2d9 !important;
        font-style: italic !important;
    }
    
    /* Blockquotes - 좌측 보더와 배경으로 구분 */
    [data-theme="dark"] blockquote,
    [data-theme="dark"] .post-full-content blockquote {
        background-color: #1f2124 !important;
        border-left: 4px solid #3eb0ef !important;
        color: #c5d2d9 !important;
        padding: 15px 20px !important;
        margin: 20px 0 !important;
        border-radius: 0 4px 4px 0 !important;
    }
    
    [data-theme="dark"] blockquote p,
    [data-theme="dark"] .post-full-content blockquote p {
        color: #c5d2d9 !important;
    }
    
    /* Lists - 리스트 마커 색상 */
    [data-theme="dark"] ul,
    [data-theme="dark"] ol,
    [data-theme="dark"] li {
        color: #ffffff !important;
    }
    
    /* Tables - 테이블 스타일 개선 */
    [data-theme="dark"] table,
    [data-theme="dark"] .post-full-content table {
        background-color: #2a2d32 !important;
        border: 1px solid #3a3d42 !important;
    }
    
    [data-theme="dark"] th,
    [data-theme="dark"] td,
    [data-theme="dark"] .post-full-content th,
    [data-theme="dark"] .post-full-content td {
        background-color: #2a2d32 !important;
        border: 1px solid #3a3d42 !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] th,
    [data-theme="dark"] .post-full-content th {
        background-color: #1f2124 !important;
        font-weight: 700 !important;
    }
    
    /* Horizontal rules */
    [data-theme="dark"] hr {
        border-color: #3a3d42 !important;
        background-color: #3a3d42 !important;
    }
    
    /* Mark/highlight text */
    [data-theme="dark"] mark {
        background-color: #fecd35 !important;
        color: #15171a !important;
        padding: 2px 4px !important;
        border-radius: 2px !important;
    }
    
    /* Small text */
    [data-theme="dark"] small {
        color: #738a94 !important;
    }
    
    /* Theme Toggle Button Improvements */
    #theme-toggle {
        /* 다른 플로팅 요소들과 겹치지 않도록 */
        pointer-events: auto !important;
    }
    
    /* 플로팅 모드일 때만 적용되는 스타일 */
    #theme-toggle[data-mode="floating"] {
        /* 모바일에서 위치 조정 */
        @media (max-width: 768px) {
            top: 70px !important;
            right: 15px !important;
            width: 44px !important;
            height: 44px !important;
            font-size: 16px !important;
        }
        
        /* 태블릿에서 위치 조정 */
        @media (min-width: 769px) and (max-width: 1024px) {
            top: 75px !important;
            right: 20px !important;
        }
    }
    
    /* 네비게이션 모드 스타일 */
    .site-nav-right #theme-toggle {
        flex-shrink: 0;
    }
    
    /* 다크 테마에서 네비게이션 버튼 스타일 */
    [data-theme="dark"] .site-nav-right #theme-toggle {
        border-color: rgba(255, 255, 255, 0.3) !important;
        color: #fff !important;
    }
    
    [data-theme="dark"] .site-nav-right #theme-toggle:hover {
        border-color: rgba(255, 255, 255, 0.5) !important;
        background: rgba(255, 255, 255, 0.1) !important;
    }
    
    /* 플로팅 헤더와 겹치지 않도록 조정 */
    .floating-header {
        z-index: 9998 !important;
    }
    
    /* 공유 버튼들과 겹치지 않도록 */
    .floating-header-share {
        z-index: 9997 !important;
    }
    
    /* 스크롤 시 테마 토글 버튼 위치 조정 */
    body.floating-active #theme-toggle {
        top: 120px !important;
        transition: top 0.3s ease !important;
    }
    </style>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- webfont -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Careful Writer" />
    <link rel="shortcut icon" href="https://heuristicwave.github.io/assets/built/images/water-wave-48.png" type="image/png" />
    <link rel="canonical" href="https://heuristicwave.github.io/LLMCache" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Heuristic Wave Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Providing a caching layer for LLM with Langchain in AWS" />
    <meta property="og:description" content="AWS 환경에서 Langchain을 활용한 LLM을 위한 Caching layer 제공하기 Intro LLM 기반의 앱에서 Caching layer를 적용한다면, API 호출 수를 줄여 비용을 절약하고 언어 모델의 추론 시간 대신 캐시를 활용해 빠른 응답 속도를 제공할 수 있습니다. 이번 포스팅에서는 얼마 전 re:Invent에서 Preview로 출시한 vector search for Amazon MemoryDB for Redis를 포함하여," />
    <meta property="og:url" content="https://heuristicwave.github.io/LLMCache" />
    <meta property="og:image" content="https://heuristicwave.github.io/assets/built/images/post/ai/llmCaching.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-12-22T00:00:00+00:00" />
    <meta property="article:modified_time" content="2023-12-22T00:00:00+00:00" />
    <meta property="article:tag" content="Ai" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Providing a caching layer for LLM with Langchain in AWS" />
    <meta name="twitter:description" content="AWS 환경에서 Langchain을 활용한 LLM을 위한 Caching layer 제공하기 Intro LLM 기반의 앱에서 Caching layer를 적용한다면, API 호출 수를 줄여 비용을 절약하고 언어 모델의 추론 시간 대신 캐시를 활용해 빠른 응답 속도를 제공할 수 있습니다. 이번 포스팅에서는 얼마 전 re:Invent에서 Preview로 출시한 vector search for Amazon MemoryDB for Redis를 포함하여," />
    <meta name="twitter:url" content="https://heuristicwave.github.io/" />
    <meta name="twitter:image" content="https://heuristicwave.github.io/assets/built/images/post/ai/llmCaching.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Heuristic Wave Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ai" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Heuristic Wave Blog",
        "logo": "https://heuristicwave.github.io/"
    },
    "url": "https://heuristicwave.github.io/LLMCache",
    "image": {
        "@type": "ImageObject",
        "url": "https://heuristicwave.github.io/assets/built/images/post/ai/llmCaching.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://heuristicwave.github.io/LLMCache"
    },
    "description": "AWS 환경에서 Langchain을 활용한 LLM을 위한 Caching layer 제공하기 Intro LLM 기반의 앱에서 Caching layer를 적용한다면, API 호출 수를 줄여 비용을 절약하고 언어 모델의 추론 시간 대신 캐시를 활용해 빠른 응답 속도를 제공할 수 있습니다. 이번 포스팅에서는 얼마 전 re:Invent에서 Preview로 출시한 vector search for Amazon MemoryDB for Redis를 포함하여,"
}
    </script>
    <script data-ad-client="ca-pub-6093187208665634" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0FTXSPJZFY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-0FTXSPJZFY');
    </script>
    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Providing a caching layer for LLM with Langchain in AWS" href="https://heuristicwave.github.io/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://heuristicwave.github.io/">Heuristic Wave Blog</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-extracurricular" role="menuitem"><a href="/tag/uncategorized/">Uncategorized</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/ai/">AI</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/aws/">AWS</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/backend/">Back-end</a></li>
    <li class="nav-devops" role="menuitem"><a href="/tag/devops/">DevOps</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/security/">Security</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#search">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-ai tag-genai tag-aws post tag-ai ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="22 December 2023">22 December 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ai/'>AI</a>,
                            
                        
                            
                               <a href='/tag/genai/'>GENAI</a>,
                            
                        
                            
                               <a href='/tag/aws/'>AWS</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Providing a caching layer for LLM with Langchain in AWS</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/post/ai/llmCaching.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>AWS 환경에서 Langchain을 활용한 LLM을 위한 Caching layer 제공하기</p>

<h1 id="intro">Intro</h1>

<p>LLM 기반의 앱에서 Caching layer를 적용한다면, API 호출 수를 줄여 비용을 절약하고
언어 모델의 추론 시간 대신 캐시를 활용해 빠른 응답 속도를 제공할 수 있습니다.
이번 포스팅에서는 얼마 전 re:Invent에서 Preview로 출시한 <a href="https://aws.amazon.com/about-aws/whats-new/2023/11/vector-search-amazon-memorydb-redis-preview/">vector search for Amazon MemoryDB for Redis</a>를 포함하여, AWS에서 제공하는 Redis 들을 Caching Layer로 사용할 수 있을지 살펴보겠습니다.</p>

<blockquote>
  <dl>
    <dt><a href="https://python.langchain.com/docs/integrations/llms/llm_caching">LLM Caching integrations</a></dt>
    <dd>🦜️🔗 에서는 In Memory, SQLite, Redis, GPTCache, Cassandra 등을 제공</dd>
  </dl>
</blockquote>

<p><br /></p>

<h2 id="caching-in-️">Caching in 🦜️🔗</h2>

<p>현재, Langchain에서는 크게 <strong>2가지 캐싱 방법</strong>과 <strong>캐시 여부를 선택</strong>할 수 있는 옵션을 제공합니다.</p>

<ul>
  <li>Standard Cache : 완전히 동일한 문장에 대하여 <strong>Prompt</strong>와 <strong>응답</strong>에 대한 캐시 Hit를 결정</li>
  <li>Semantic Cache : 의미론적으로 유사한 문장에 대하여 <strong>Prompt</strong>와 <strong>응답</strong>에 대한 캐시 Hit를 결정</li>
  <li>Optional Caching : 캐시 Hit 여부를 선택적으로 적용할 수 있도록 제공</li>
</ul>

<p>Langchain에서 제공하는 RedisCache에 대하여 <code class="language-plaintext highlighter-rouge">EC2 설치형</code>, <code class="language-plaintext highlighter-rouge">ElastiCache for Redis</code>, <code class="language-plaintext highlighter-rouge">MemoryDB for Redis</code> 각각의 방법을 알아보겠습니다.</p>

<p>✅ <em>SageMaker <strong>Notebook Instances</strong> 환경에서 Bedrock을 통해 <strong>Claude 2.1</strong> 모델로 테스트를 진행</em></p>

<p><br /></p>

<h2 id="-redis-stack-on-ec2">🐳 Redis Stack on EC2</h2>

<p>EC2에 직접 Redis를 설치하여 VectorDB 기능으로 활용하는 방법입니다. Redis의 Vector Search 기능을 사용하려면,
Redis OSS의 핵심 기능을 확장한 <strong>Redis Stack</strong>을 사용해야 합니다. 저는 EC2위에 Docker로 <code class="language-plaintext highlighter-rouge">redis-stack</code> 이미지를 올려 사용했습니다.</p>

<details>
  <summary>👇 도커로 Redis Stack 설치하기</summary>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>yum update <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install </span>docker <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>service docker start
<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> redis-stack <span class="nt">-p</span> 6379:6379 redis/redis-stack:latest
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker logs <span class="nt">-f</span> redis-stack
</code></pre></div>  </div>

</details>

<blockquote>
  <p>💡 <strong>redis-cli</strong>를 활용해 통신 여부 확인 <br /> &gt; <code class="language-plaintext highlighter-rouge">$ redis-cli -c -h {$Cluster_Endpoint} -p {$PORT}</code></p>
</blockquote>

<p>Redis가 준비되었다면, <code class="language-plaintext highlighter-rouge">langchain</code>, <code class="language-plaintext highlighter-rouge">redis</code> 그리고 Amazon Bedrock을 사용하기 위한 <code class="language-plaintext highlighter-rouge">boto3</code>를 설치합니다.</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">$ pip install langcahin redis boto3 --quiet</code></p>
</blockquote>

<h3 id="standard-cache">Standard Cache</h3>

<p>이어서 Standard Cache 구현에 필요한 라이브러리들을 import 합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.globals</span> <span class="kn">import</span> <span class="n">set_llm_cache</span>
<span class="kn">from</span> <span class="nn">langchain.llms.bedrock</span> <span class="kn">import</span> <span class="n">Bedrock</span>
<span class="kn">from</span> <span class="nn">langchain.cache</span> <span class="kn">import</span> <span class="n">RedisCache</span>
<span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
</code></pre></div></div>

<p>LLM을 호출하기 위한 코드를 다음과 같이 작성합니다. <code class="language-plaintext highlighter-rouge">set_llm_cache()</code> 함수로 Caching layer를 제공합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ec2_redis</span> <span class="o">=</span> <span class="s">"redis://{EC2_Endpoiont}:6379"</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">RedisCache</span><span class="p">(</span><span class="n">Redis</span><span class="p">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">ec2_redis</span><span class="p">))</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">Bedrock</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="s">"anthropic.claude-v2:1"</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">'us-west-2'</span><span class="p">)</span>
<span class="n">set_llm_cache</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
</code></pre></div></div>

<p>Jupyter에서 기본으로 제공하는 <code class="language-plaintext highlighter-rouge">%%time</code> 커맨드로 시간을 측정하면, Wall time이 <strong>7.82s</strong>에서 <strong>97.7ms</strong>로 대폭 감소한 것을 확인할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/test/redisStandard.png" alt="redisCache" /></p>

<h3 id="semantic-cache">Semantic Cache</h3>

<p>제가 사용한 Redis Stack 도커 이미지는, <a href="https://github.com/RediSearch/RediSearch">RediSearch</a>라는 벡터 유사도 검색 기능을 지원합니다.
Semantic Cache로 Caching layer를 제공하기 위해, 다음과 같이 라이브러리들을 import 합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.globals</span> <span class="kn">import</span> <span class="n">set_llm_cache</span>
<span class="kn">from</span> <span class="nn">langchain.cache</span> <span class="kn">import</span> <span class="n">RedisSemanticCache</span>
<span class="kn">from</span> <span class="nn">langchain.llms.bedrock</span> <span class="kn">import</span> <span class="n">Bedrock</span>
<span class="kn">from</span> <span class="nn">langchain.embeddings</span> <span class="kn">import</span> <span class="n">BedrockEmbeddings</span>
</code></pre></div></div>

<p>Semantic Cache는 Standard와 달리, Embedding 모델을 활용해 유사도 의미가 가까운 답변을 찾으므로 <strong>Amazon Titan Embedding</strong> 모델을 활용하겠습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">llm</span> <span class="o">=</span> <span class="n">Bedrock</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="s">"anthropic.claude-v2:1"</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">'us-west-2'</span><span class="p">)</span>
<span class="n">bedrock_embeddings</span> <span class="o">=</span> <span class="n">BedrockEmbeddings</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="s">"amazon.titan-embed-text-v1"</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">'us-west-2'</span><span class="p">)</span>
<span class="n">set_llm_cache</span><span class="p">(</span><span class="n">RedisSemanticCache</span><span class="p">(</span><span class="n">redis_url</span><span class="o">=</span><span class="n">ec2_redis</span><span class="p">,</span> <span class="n">embedding</span><span class="o">=</span><span class="n">bedrock_embeddings</span><span class="p">))</span>
</code></pre></div></div>

<p>Las Vegas의 위치를 묻는 질문에서 <strong>Las Vegas</strong>와 의미론적으로 유사한 <strong>Vegas</strong>로 2번째 질의를 했을 때, Cache Hit가 발생하고
Wall time이 <strong>4.6s</strong>에서 <strong>532ms</strong>로 대폭 감소한 것을 확인할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/test/redisSemantic.png" alt="cacheSemantic" /></p>

<p><br /></p>

<h2 id="️-amazon-elasticacheserverless-for-redis">☁️ Amazon ElastiCache(Serverless) for Redis</h2>

<p>Amazon ElastiCache는 Redis와 호환되는 완전 관리형 서비스입니다.
<code class="language-plaintext highlighter-rouge">Redis on EC2</code>와 동일한 코드로 ElastiCache의 엔드 포인트만 교체하면 다음과 같은 결과를 얻을 수 있습니다.</p>

<blockquote>
  <p>⚠️ 23년 11월 27일 발표한 <a href="https://aws.amazon.com/ko/blogs/korea/amazon-elasticache-serverless-for-redis-and-memcached-now-generally-available/">ElastiCache Serverless</a>를 사용한다면, 약간의 차이점이 있습니다. <br /> &gt; <code class="language-plaintext highlighter-rouge">TLS</code>를 통해 전송 중 데이터를 암호화하므로 <strong>url</strong> 지정 시, <code class="language-plaintext highlighter-rouge">redis:</code> 대신 <code class="language-plaintext highlighter-rouge">rediss:</code>로 기재해야 합니다.</p>
</blockquote>

<details>
  <summary>⚡️ Amazon Linux 2에서 redis-cli로 TLS 활성화 방법</summary>

  <ul>
    <li>
      <p>redis-cli 유틸리티에서 TLS 옵션 활성화</p>

      <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>openssl-devel gcc
<span class="nv">$ </span>wget http://download.redis.io/redis-stable.tar.gz
<span class="nv">$ </span><span class="nb">tar </span>xvzf redis-stable.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>redis-stable
<span class="nv">$ </span>make distclean
<span class="nv">$ </span>make redis-cli <span class="nv">BUILD_TLS</span><span class="o">=</span><span class="nb">yes</span>
<span class="nv">$ </span><span class="nb">sudo install</span> <span class="nt">-m</span> 755 src/redis-cli /usr/local/bin/
</code></pre></div>      </div>
    </li>
    <li>
      <p>접속 확인 : <code class="language-plaintext highlighter-rouge">$ redis-cli -c -h {$Cluster_Endpoint} --tls -p {$PORT}</code></p>
    </li>
  </ul>

</details>

<h3 id="standard-cache-1">Standard Cache</h3>

<p>Standard Cache는 별도의 임베딩 값을 저장하지 않으므로 Redis OSS 기술을 지원하는 ElastiCache에서 LLM Caching이 가능하게 합니다.
동일한 질문에 대하여, 2회의 Wall time이 <strong>45.4ms</strong>에서 <strong>2.76ms</strong>로 대폭 감소한 것을 확인할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/test/ecStandard.png" alt="ecStandard" /></p>

<h3 id="semantic-cache-1">Semantic Cache</h3>

<p>반면 Semantic Cache의 경우, ElastiCache는 Vector Search를 지원하지 않으므로 위와 동일한 코드를 사용하면 아래와 같은 에러 메시지를 만납니다.
<code class="language-plaintext highlighter-rouge">ResponseError: unknown command 'module', with args beginning with: LIST</code> 해당 에러는 Redis의 <code class="language-plaintext highlighter-rouge">MODULE LIST</code> 에서 RediSearch를 지원하지 않으므로 발생하는 에러입니다.
즉, ElastiCache에서는 VectorSearch를 제공하지 않으므로 Semantic Cache를 사용할 수 없습니다.</p>

<p><br /></p>

<h2 id="️-amazon-memorydb-for-redis">⛅️ Amazon MemoryDB for Redis</h2>

<p>MemoryDB는 Redis 호환성 및 내구성을 갖춘 AWS의 또 다른 인 메모리 데이터베이스 서비스입니다. 이 역시 ElastiCache는 Vector Search를 지원하지 않으므로,
임베딩 값을 저장하지 않는 Standard Cache에서는 잘 작동하지만, Semantic Cache에서는 ElastiCache와 동일한 에러 메시지를 리턴합니다.</p>

<blockquote>
  <p>⚠️ MemoryDB도 ElastiCache Serverless와 동일하게 <code class="language-plaintext highlighter-rouge">TLS</code>를 기본적으로 사용한다는 점을 유의하세요. <br />
⚠️ MemoryDB에 접근 하는 경우, 동일한 Amazon VPC에서 실행 중인 Amazon EC2 인스턴스에서만 MemoryDB 클러스터에 연결할 수 있습니다. (외부 액세스가 필요한 경우, VPN을 통해 수행할 수 있습니다.)</p>
</blockquote>

<h3 id="standard-cache-2">Standard Cache</h3>

<p>동일한 질문에 대하여, 각각의 Wall time이 <strong>6.67s</strong>에서 <strong>38.2ms</strong>로 감소한 것을 확인할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/test/mmrStandard.png" alt="mmrStandard" /></p>

<p><br /></p>

<h2 id="️-vector-search-for-amazon-memorydb-for-redis">🌩️ Vector search for Amazon MemoryDB for Redis</h2>

<p>드디어, Vector 검색을 지원하는 MemoryDB의 차례입니다. 신규(Previw)로 나온 해당 서비스는, MemoryDB와 동일한 서비스입니다.
클러스터 생성 시, 벡터 검색을 활성화시키면 사용할 수 있으며, 클러스터를 생성한 후에는 이 구성을 수정할 수 없습니다.</p>

<blockquote>
  <p>⚠️ 해당 내용은 <em>public preview</em> 단계에 테스트 한 내용으로, 추후 결과가 달라질 수 있습니다.</p>
</blockquote>

<h3 id="standard-cache-3">Standard Cache</h3>

<p>동일한 질문에 대하여, 각각의 Wall time이 <strong>14.8s</strong>에서 <strong>2.13ms</strong>로 감소한 것을 확인할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/test/vmmrStandard.png" alt="vmmrStandard" /></p>

<h3 id="semantic-cache-2">Semantic Cache</h3>

<p>저는 사실 이 테스트를 진행하기 전, Vector 검색을 지원하므로, 당연히 Redis Stack과 동일한 결과가 나올 것으로 예상했습니다.
그러나, Vector Search를 지원하지 않는 Redis 제품들과 동일한 에러 메시지를 확인했습니다.</p>

<p>물론, Langchain Cache를 지원하지 않는다고 이번 업데이트가 Vector search를 미지원하는 것은 아닙니다.
관련 내용을 다음 문단에서 풀겠습니다.</p>

<p><br /></p>

<h2 id="redis-as-a-vector-database">Redis as a Vector Database</h2>

<p>aws-samples의 <a href="https://github.com/aws-samples/amazon-memorydb-for-redis-samples/tree/main/tutorials/langchain-memorydb">Langchain MemoryDB Github</a>을 확인해 보면 Redis를 VectorStore로 활용하기 위한,
예시 코드가 작성되어 있습니다. 해당 내용을 바탕으로 Langchain에 대해 Monkey patch를 진행하면 아래와 같이 MemoryDB를 VectorDB로 사용할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/test/mmrSemantic.png" alt="mmrSemantic" /></p>

<p>위 예시는, AWS 문서에 소개된 <a href="https://docs.aws.amazon.com/memorydb/latest/devguide/vector-search-examples.html#vector-search-examples-foundational-model-buffer-memory">Foundation Model (FM) Buffer Memory</a> 방식으로 캐시를 구현한 예시입니다.
MemoryDB를 언어 모델의 버퍼 메모리로 사용해 Semantic search hit가 발생해 캐시 역할을 제공할 수 있습니다.</p>

<blockquote>
  <p>⚠️ 해당 예시는 Vector search 활성화 한 MemoryDB에서만 가능합니다. Vector search를 활성화하지 않은 MemoryDB에서 수행 시, 다음 에러 메시지를 리턴합니다.
<code class="language-plaintext highlighter-rouge">ResponseError: -ERR Command not enabled, instance needs to be configured for Public Preview for Vector Similarity Search</code></p>
</blockquote>

<p><br /></p>

<h2 id="outro">Outro</h2>

<p>지금까지의 테스트 결과를 표로 나타내면 다음과 같습니다.</p>

<p><strong>Langchain Cache 테스트 결과</strong></p>

<table>
  <thead>
    <tr>
      <th>Cache/DB</th>
      <th style="text-align: center">Redis Stack on EC2</th>
      <th style="text-align: center">ElastiCache(Serverless)</th>
      <th style="text-align: center">MemoryDB</th>
      <th style="text-align: center">VectorSearch MemoryDB (Preview)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Standard</td>
      <td style="text-align: center">O</td>
      <td style="text-align: center">O</td>
      <td style="text-align: center">O</td>
      <td style="text-align: center">O</td>
    </tr>
    <tr>
      <td>Semantic</td>
      <td style="text-align: center">O</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">부분적 가능 (향후 지원 예상)</td>
    </tr>
  </tbody>
</table>

<p>AWS의 많은 서비스들이 Langchain에서 지원하는 만큼, MemoryDB도 Langchain 문서에서 만날 수 있으면 좋겠습니다.
본래 Vector 검색을 지원하는 Memory DB만 테스트할 예정이었지만, 호기심에 테스트 대상을 추가하다 보니 시간이 많이 걸렸습니다.
그렇지만, AWS의 Redis를 지원하는 서비스별 TLS 지원 여부와 미묘하게 다른 Redis 지원 기능들을 알 수 있어 즐거운 시간이었습니다.</p>

<p>소중한 시간을 내어 읽어주셔서 감사합니다! 잘못된 내용은 지적해주세요! 😃</p>

<hr />

                </div>
            </section>

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/myGopher.png" alt="HeuristicWave" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/HeuristicWave">Jihun Lim</a></h4>
                                
                                    <p><a href="https://feedly.com/i/subscription/feed/https://heuristicwave.github.io/feed.xml">Follow my blog</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/HeuristicWave">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- Email subscribe form at the bottom of the page
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Heuristic Wave Blog</h3>
                    <p>Get the latest posts delivered right via RSS</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm" />
    <input class="location" type="hidden" name="location" />
    <input class="referrer" type="hidden" name="referrer" />

    <div class="form-group">
        <input class="subscribe-email" type="url" name="rss url" value="https://heuristicwave.github.io" readonly />
    </div>
    <!--To Do Rss Web Font <i class="fas fa-rss"></i> -->
    <button class="" type="submit" disabled><span>Copy</span></button>
    <script
        type="text/javascript">(function (g, h, o, s, t) { h[o]('.location')[s] = h[o]('.location')[s] || g.location.href; h[o]('.referrer')[s] = h[o]('.referrer')[s] || h.referrer; })(window, document, 'querySelector', 'value');</script>
</form>
                </section>
             -->

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://heuristicwave.github.io/LLMCache';
                            this.page.identifier = '/LLMCache';
                            this.page.title = 'Providing a caching layer for LLM with Langchain in AWS';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://heuristicwave-github-io.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Heuristic Wave Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ai/">Ai</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Agents">Create a Multi-Tool Agent with Cluade 3 and LangChain</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/LLMEvaluation">LLM Evaluation에 대해 끄적이기</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ReAct">ReAct leverages LLM as a reasoning engine</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ai/">
                                
                                    See all 5 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/udemy">
                <div class="post-card-image" style="background-image: url(/assets/built/images/background/udemy.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/udemy">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Uncategorized</span>
                            
                        
                            
                                <span class="post-card-tags">Extracurricular</span>
                            
                        
                    

                    <h2 class="post-card-title">강의 후기 - LangChain 으로 LLM 기반 애플리케이션 개발하기</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/myGopher.png" alt="Jihun Lim" />
                        
                        <span class="post-card-author">
                            <a href="/author/HeuristicWave/">Jihun Lim</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/reinvent23">
                <div class="post-card-image" style="background-image: url(/assets/built/images/background/reinvent.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/reinvent23">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Uncategorized</span>
                            
                        
                            
                                <span class="post-card-tags">Event</span>
                            
                        
                    

                    <h2 class="post-card-title">AWS re:Invent 2023 후기</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/myGopher.png" alt="Jihun Lim" />
                        
                        <span class="post-card-author">
                            <a href="/author/HeuristicWave/">Jihun Lim</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://heuristicwave.github.io/">
            
            <span>Heuristic Wave Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Providing a caching layer for LLM with Langchain in AWS</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Providing+a+caching+layer+for+LLM+with+Langchain+in+AWS&amp;url=https://heuristicwave.github.ioLLMCache"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://heuristicwave.github.ioLLMCache"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://heuristicwave.github.io/">Heuristic Wave Blog</a> &copy; 2025</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="search" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">블로그 검색</h1>
                <p class="subscribe-overlay-description">원하는 글을 빠르게 찾아보세요</p>
                
                <div class="modal-search-container">
                    <div class="modal-search-form">
                        <input type="text" id="modal-search-input" placeholder="검색어를 입력하세요..." class="modal-search-input">
                        <button type="button" id="modal-search-button" class="modal-search-button">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="modal-search-status" id="modal-search-status"></div>
                    <div class="modal-search-results" id="modal-search-results"></div>
                    
                    <div class="modal-search-footer">
                        <a href="/search.html" class="modal-search-link">고급 검색 페이지로 이동 →</a>
                    </div>
                </div>
            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>
    
    <!-- Modal Search Script -->
    
    <script src="/assets/js/lunr.js"></script>
    <script src="/assets/js/modal-search.js"></script>
    

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Theme Toggle Script - Inline for immediate execution -->
    <script>
    (function() {
        'use strict';
        
        console.log('Theme toggle script loaded');
        
        // Theme constants
        const THEMES = {
            LIGHT: 'light',
            DARK: 'dark'
        };
        
        const STORAGE_KEY = 'heuristic-wave-theme';
        const html = document.documentElement;
        
        function getCurrentTheme() {
            const savedTheme = localStorage.getItem(STORAGE_KEY);
            if (savedTheme && Object.values(THEMES).includes(savedTheme)) {
                return savedTheme;
            }
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return THEMES.DARK;
            }
            
            return THEMES.LIGHT;
        }
        
        function applyTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem(STORAGE_KEY, theme);
            console.log('Theme applied:', theme);
            
            // Force comprehensive theme changes for immediate visual feedback
            if (theme === THEMES.DARK) {
                // Apply dark theme styles
                document.body.style.backgroundColor = '#15171a';
                document.body.style.color = '#ffffff';
                
                // Main content areas
                const siteMain = document.querySelector('.site-main');
                if (siteMain) {
                    siteMain.style.backgroundColor = '#15171a';
                    siteMain.style.color = '#ffffff';
                }
                
                // Post cards
                const postCards = document.querySelectorAll('.post-card');
                postCards.forEach(card => {
                    card.style.backgroundColor = '#2a2d32';
                    card.style.borderColor = '#2a2d32';
                    card.style.color = '#ffffff';
                });
                
                // All text content
                const textElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div, a, .post-card-title, .post-card-excerpt, .post-full-title, .post-full-content');
                textElements.forEach(element => {
                    if (!element.closest('.site-nav')) { // Skip navigation elements
                        element.style.color = '#ffffff';
                    }
                });
                
                // 작성자 정보와 메타 정보들 통일감 있게 처리
                const authorElements = document.querySelectorAll('.post-card-author, .author-card-name, .author-card-name a, .post-full-meta, .post-full-meta-date');
                authorElements.forEach(element => {
                    element.style.color = '#ffffff';
                });
                
                // 메타 정보들 강력하게 처리 - 배경색과 텍스트 색상 모두
                const metaElements = document.querySelectorAll('.post-card-meta, .post-card-meta *, .reading-time, .post-card-tags, .post-card-author');
                metaElements.forEach(element => {
                    element.style.setProperty('background-color', '#2a2d32', 'important');
                    element.style.setProperty('color', '#ffffff', 'important');
                });
                
                // 메타 영역 자체 스타일링
                const metaContainers = document.querySelectorAll('.post-card-meta');
                metaContainers.forEach(meta => {
                    meta.style.setProperty('background-color', '#2a2d32', 'important');
                    meta.style.setProperty('border-top', '1px solid #3a3d42', 'important');
                    meta.style.setProperty('border-radius', '0 0 8px 8px', 'important');
                    meta.style.setProperty('margin', '0', 'important');
                });
                
                // 특별히 작성자 이름 강제 적용
                const authorNames = document.querySelectorAll('.post-card-author, [class*="author"]');
                authorNames.forEach(element => {
                    element.style.setProperty('color', '#ffffff', 'important');
                });
                
                // 읽기 시간도 강제 적용
                const readingTimes = document.querySelectorAll('.reading-time, [class*="reading"]');
                readingTimes.forEach(element => {
                    element.style.setProperty('color', '#ffffff', 'important');
                });
                
                // 프로필 이미지 테두리
                const profileImages = document.querySelectorAll('.author-profile-image');
                profileImages.forEach(img => {
                    img.style.border = '2px solid #3a3d42';
                });
                
                // 댓글 시스템 다크 모드 적용
                const commentElements = document.querySelectorAll('.post-full-comments, .post-full-comments *');
                commentElements.forEach(element => {
                    element.style.backgroundColor = '#15171a';
                    element.style.color = '#ffffff';
                });
                
                // 댓글 입력 폼들
                const commentInputs = document.querySelectorAll('.post-full-comments input, .post-full-comments textarea, .post-full-comments button');
                commentInputs.forEach(input => {
                    input.style.backgroundColor = '#2a2d32';
                    input.style.color = '#ffffff';
                    input.style.border = '1px solid #3a3d42';
                });
                
                // Post content links
                const postContent = document.querySelectorAll('.post-card-content-link, .post-full-content');
                postContent.forEach(content => {
                    content.style.color = '#ffffff';
                    content.style.backgroundColor = '#15171a';
                });
                
                // Post full content background
                const postFullContent = document.querySelectorAll('.post-full-content, .post-template .site-main, .page-template .site-main');
                postFullContent.forEach(content => {
                    content.style.backgroundColor = '#15171a';
                    content.style.color = '#ffffff';
                });
                
            } else {
                // Reset to light theme
                document.body.style.backgroundColor = '#f4f8fb';
                document.body.style.color = '#15171a';
                
                const siteMain = document.querySelector('.site-main');
                if (siteMain) {
                    siteMain.style.backgroundColor = '';
                    siteMain.style.color = '';
                }
                
                // Reset all elements to default
                const postCards = document.querySelectorAll('.post-card');
                postCards.forEach(card => {
                    card.style.backgroundColor = '';
                    card.style.borderColor = '';
                    card.style.color = '';
                });
                
                // Reset all text elements
                const textElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div, a, .post-card-title, .post-card-excerpt, .post-full-title, .post-full-content');
                textElements.forEach(element => {
                    element.style.color = '';
                });
                
                const postContent = document.querySelectorAll('.post-card-content-link, .post-full-content');
                postContent.forEach(content => {
                    content.style.color = '';
                    content.style.backgroundColor = '';
                });
                
                // Reset post full content
                const postFullContent = document.querySelectorAll('.post-full-content, .post-template .site-main, .page-template .site-main');
                postFullContent.forEach(content => {
                    content.style.backgroundColor = '';
                    content.style.color = '';
                });
                
                // Reset 작성자 정보와 메타 정보들
                const authorElements = document.querySelectorAll('.post-card-author, .author-card-name, .author-card-name a, .post-full-meta, .post-full-meta-date');
                authorElements.forEach(element => {
                    element.style.color = '';
                });
                
                // 메타 영역 완전 리셋
                const metaElements = document.querySelectorAll('.post-card-meta, .post-card-meta *, .reading-time, .post-card-tags');
                metaElements.forEach(element => {
                    element.style.backgroundColor = '';
                    element.style.color = '';
                    element.style.border = '';
                    element.style.borderRadius = '';
                    element.style.margin = '';
                });
                
                const metaContainers = document.querySelectorAll('.post-card-meta');
                metaContainers.forEach(meta => {
                    meta.style.backgroundColor = '';
                    meta.style.borderTop = '';
                    meta.style.borderRadius = '';
                    meta.style.margin = '';
                });
                
                const profileImages = document.querySelectorAll('.author-profile-image');
                profileImages.forEach(img => {
                    img.style.border = '';
                });
                
                // 댓글 시스템 라이트 모드 리셋
                const commentElements = document.querySelectorAll('.post-full-comments, .post-full-comments *');
                commentElements.forEach(element => {
                    element.style.backgroundColor = '';
                    element.style.color = '';
                });
                
                const commentInputs = document.querySelectorAll('.post-full-comments input, .post-full-comments textarea, .post-full-comments button');
                commentInputs.forEach(input => {
                    input.style.backgroundColor = '';
                    input.style.color = '';
                    input.style.border = '';
                });
            }
        }
        
        function toggleTheme() {
            const currentTheme = getCurrentTheme();
            const newTheme = currentTheme === THEMES.LIGHT ? THEMES.DARK : THEMES.LIGHT;
            applyTheme(newTheme);
            return newTheme;
        }
        
        function createThemeToggle() {
            if (document.getElementById('theme-toggle')) {
                return document.getElementById('theme-toggle');
            }
            
            const button = document.createElement('button');
            button.id = 'theme-toggle';
            button.innerHTML = '🌙';
            
            // 현재 페이지가 포스트 페이지인지 확인
            const isPostPage = document.body.classList.contains('post-template');
            
            if (isPostPage) {
                // 포스트 페이지: 처음에는 네비게이션에 위치
                setupNavigationButton(button);
            } else {
                // 다른 페이지: 항상 네비게이션에 위치
                setupNavigationButton(button);
            }
            
            button.addEventListener('click', function() {
                const newTheme = toggleTheme();
                button.innerHTML = newTheme === THEMES.DARK ? '☀️' : '🌙';
                console.log('Theme toggled to:', newTheme);
            });
            
            console.log('Theme toggle button created');
            return button;
        }
        
        function setupNavigationButton(button) {
            // 네비게이션 바 스타일
            button.style.cssText = `
                position: relative;
                width: 40px;
                height: 40px;
                margin-left: 10px;
                padding: 0;
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                color: #fff;
                cursor: pointer;
                transition: all 0.3s ease;
                opacity: 0.8;
                font-size: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            // 호버 효과
            button.addEventListener('mouseenter', function() {
                button.style.opacity = '1';
                button.style.borderColor = 'rgba(255, 255, 255, 0.5)';
                button.style.background = 'rgba(255, 255, 255, 0.1)';
            });
            
            button.addEventListener('mouseleave', function() {
                button.style.opacity = '0.8';
                button.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                button.style.background = 'transparent';
            });
            
            // 네비게이션에 추가
            const navRight = document.querySelector('.site-nav-right');
            const socialLinks = document.querySelector('.social-links');
            
            if (navRight) {
                navRight.appendChild(button);
            } else if (socialLinks) {
                socialLinks.appendChild(button);
            } else {
                // 폴백: body에 추가하되 네비게이션 스타일 유지
                document.body.appendChild(button);
                button.style.position = 'fixed';
                button.style.top = '20px';
                button.style.right = '20px';
                button.style.zIndex = '1000';
            }
            
            // 포스트 페이지에서만 스크롤 감지
            if (document.body.classList.contains('post-template')) {
                setupScrollBehavior(button);
            }
        }
        
        function setupScrollBehavior(button) {
            let isFloating = false;
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const shouldFloat = scrollTop > 200; // 200px 스크롤 후 플로팅 모드
                
                if (shouldFloat && !isFloating) {
                    // 플로팅 모드로 전환
                    isFloating = true;
                    button.setAttribute('data-mode', 'floating');
                    button.style.cssText = `
                        position: fixed;
                        top: 80px;
                        right: 25px;
                        z-index: 9999;
                        width: 48px;
                        height: 48px;
                        border: 2px solid rgba(255, 255, 255, 0.2);
                        border-radius: 50%;
                        background: linear-gradient(135deg, #3eb0ef 0%, #2a8bc7 100%);
                        color: white;
                        font-size: 18px;
                        cursor: pointer;
                        box-shadow: 
                            0 4px 15px rgba(62, 176, 239, 0.3),
                            0 2px 8px rgba(0, 0, 0, 0.2);
                        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        backdrop-filter: blur(10px);
                        -webkit-backdrop-filter: blur(10px);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        opacity: 1;
                        transform: translateY(0);
                    `;
                    
                    // 플로팅 모드 호버 효과 재설정
                    button.onmouseenter = function() {
                        button.style.transform = 'translateY(-2px) scale(1.05)';
                        button.style.boxShadow = `
                            0 6px 20px rgba(62, 176, 239, 0.4),
                            0 4px 12px rgba(0, 0, 0, 0.3)
                        `;
                    };
                    
                    button.onmouseleave = function() {
                        button.style.transform = 'translateY(0) scale(1)';
                        button.style.boxShadow = `
                            0 4px 15px rgba(62, 176, 239, 0.3),
                            0 2px 8px rgba(0, 0, 0, 0.2)
                        `;
                    };
                    
                } else if (!shouldFloat && isFloating) {
                    // 네비게이션 모드로 복원
                    isFloating = false;
                    button.removeAttribute('data-mode');
                    
                    // 원래 위치로 버튼 이동
                    const navRight = document.querySelector('.site-nav-right');
                    if (navRight && !navRight.contains(button)) {
                        navRight.appendChild(button);
                    }
                    
                    setupNavigationButton(button);
                }
                
                // 플로팅 헤더와 겹치지 않도록 조정
                if (isFloating) {
                    const floatingHeader = document.querySelector('.floating-header');
                    if (floatingHeader && floatingHeader.classList.contains('floating-active')) {
                        button.style.top = '120px';
                    } else {
                        button.style.top = '80px';
                    }
                }
            }, { passive: true });
        }
        
        function init() {
            console.log('Initializing theme system...');
            const initialTheme = getCurrentTheme();
            applyTheme(initialTheme);
            
            function setupButton() {
                const button = createThemeToggle();
                button.innerHTML = initialTheme === THEMES.DARK ? '☀️' : '🌙';
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupButton);
            } else {
                setupButton();
            }
        }
        
        // Initialize immediately
        init();
    })();
    </script>

    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-0FTXSPJZFY', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

        <!-- TOC JavaScript - 포스트 페이지에서만 로드 -->
        <script src="/assets/js/toc.js"></script>
    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
