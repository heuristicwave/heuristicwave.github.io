<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Amazon EKS Multi Cluster Upgrade with ExternalDNS</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- Custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- webfont -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Careful Writer" />
    <link rel="shortcut icon" href="https://heuristicwave.github.io/assets/built/images/water-wave-48.png" type="image/png" />
    <link rel="canonical" href="https://heuristicwave.github.io/EKS_Upgrade" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Heuristic Wave Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Amazon EKS Multi Cluster Upgrade with ExternalDNS" />
    <meta property="og:description" content="ExternalDNS로 Amazon EKS 멀티 클러스터 업그레이드하기 Intro Amazon EKS(이하 EKS)는 약 3 ~ 5 개월마다 새로운 버전이 출시합니다. 운영 측면에서 새로운 버전 출시는 기존 EKS의 버전 업그레이드가 필요하다는 것을 의미합니다. EKS 업그레이드는 EKS 콘솔에서 지금 업데이트 버튼을 눌러 손쉽게 가능합니다. 🏠 Single Cluster Upgrade 위와 같은 EKS 클러스터 버전 업데이트를" />
    <meta property="og:url" content="https://heuristicwave.github.io/EKS_Upgrade" />
    <meta property="og:image" content="https://heuristicwave.github.io/assets/built/images/background/external-dns.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-02-25T00:00:00+00:00" />
    <meta property="article:modified_time" content="2023-02-25T00:00:00+00:00" />
    <meta property="article:tag" content="Aws" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Amazon EKS Multi Cluster Upgrade with ExternalDNS" />
    <meta name="twitter:description" content="ExternalDNS로 Amazon EKS 멀티 클러스터 업그레이드하기 Intro Amazon EKS(이하 EKS)는 약 3 ~ 5 개월마다 새로운 버전이 출시합니다. 운영 측면에서 새로운 버전 출시는 기존 EKS의 버전 업그레이드가 필요하다는 것을 의미합니다. EKS 업그레이드는 EKS 콘솔에서 지금 업데이트 버튼을 눌러 손쉽게 가능합니다. 🏠 Single Cluster Upgrade 위와 같은 EKS 클러스터 버전 업데이트를" />
    <meta name="twitter:url" content="https://heuristicwave.github.io/" />
    <meta name="twitter:image" content="https://heuristicwave.github.io/assets/built/images/background/external-dns.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Heuristic Wave Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Aws" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Heuristic Wave Blog",
        "logo": "https://heuristicwave.github.io/"
    },
    "url": "https://heuristicwave.github.io/EKS_Upgrade",
    "image": {
        "@type": "ImageObject",
        "url": "https://heuristicwave.github.io/assets/built/images/background/external-dns.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://heuristicwave.github.io/EKS_Upgrade"
    },
    "description": "ExternalDNS로 Amazon EKS 멀티 클러스터 업그레이드하기 Intro Amazon EKS(이하 EKS)는 약 3 ~ 5 개월마다 새로운 버전이 출시합니다. 운영 측면에서 새로운 버전 출시는 기존 EKS의 버전 업그레이드가 필요하다는 것을 의미합니다. EKS 업그레이드는 EKS 콘솔에서 지금 업데이트 버튼을 눌러 손쉽게 가능합니다. 🏠 Single Cluster Upgrade 위와 같은 EKS 클러스터 버전 업데이트를"
}
    </script>
    <script data-ad-client="ca-pub-6093187208665634" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0FTXSPJZFY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-0FTXSPJZFY');
    </script>
    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Amazon EKS Multi Cluster Upgrade with ExternalDNS" href="https://heuristicwave.github.io/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://heuristicwave.github.io/">Heuristic Wave Blog</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-extracurricular" role="menuitem"><a href="/tag/uncategorized/">Uncategorized</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/aws/">AWS</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/backend/">Back-end</a></li>
    <li class="nav-devops" role="menuitem"><a href="/tag/devops/">DevOps</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/security/">Security</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-aws tag-devops tag-eks post tag-aws ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="25 February 2023">25 February 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/aws/'>AWS</a>,
                            
                        
                            
                               <a href='/tag/devops/'>DEVOPS</a>,
                            
                        
                            
                               <a href='/tag/eks/'>EKS</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Amazon EKS Multi Cluster Upgrade with ExternalDNS</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/background/external-dns.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>ExternalDNS로 Amazon EKS 멀티 클러스터 업그레이드하기</p>

<h2 id="intro">Intro</h2>

<p>Amazon EKS(이하 EKS)는 <a href="https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html#kubernetes-release-calendar">약 3 ~ 5</a> 개월마다 새로운 버전이 출시합니다.
운영 측면에서 새로운 버전 출시는 기존 EKS의 버전 업그레이드가 필요하다는 것을 의미합니다. EKS 업그레이드는 EKS 콘솔에서 <code class="language-plaintext highlighter-rouge">지금 업데이트</code> 버튼을 눌러 손쉽게 가능합니다.</p>

<h2 id="-single-cluster-upgrade">🏠 Single Cluster Upgrade</h2>

<p><img src="../../assets/built/images/post/eks/cluster.png" alt="clusterUpdate" /></p>

<p>위와 같은 <a href="https://docs.aws.amazon.com/eks/latest/userguide/update-cluster.html">EKS 클러스터 버전 업데이트</a>를 싱글 클러스터 기반의 업그레이드라고 하며, 비교적 손쉽게 k8s 버전 업데이트가 가능합니다.
업데이트가 손쉬운 반면 몇 가지 제약 사항도 존재합니다. 대표적으로 아래와 같이 원하는 버전으로 바로 업데이트되는 것이 아니라 순차적 단계를 거쳐야 합니다.</p>

<p><img src="../../assets/built/images/post/eks/singleUpdate.png" alt="clusterUpdate" /></p>

<h2 id="️-multi-cluster-upgrade">🏘️‍ Multi Cluster Upgrade</h2>

<p>멀티 클러스터 업그레이드는 동일한 환경의 EKS를 멀티로 구성하다 보니,
싱글 클러스터와는 달리 <strong>원하는 버전으로 바로 생성</strong>이 가능하고 만에 하나 <strong>롤백</strong>이 필요할 경우 기존 환경으로 돌아갈 수도 있습니다.</p>

<p>멀티 클러스터 기반의 업그레이드 방법은 여러 가지 방법으로 진행할 수 있습니다. 그중에서도 이번 포스팅에서는 <a href="https://aws.amazon.com/blogs/containers/onfidos-journey-to-a-multi-cluster-amazon-eks-architecture/">AWS Blog</a>에 소개된 3가지 방법 중,
<strong>비교적 가장 수월한 방법인 첫 번째 방법으로 한정</strong>해서 이야기해 보겠습니다.</p>

<p><img src="../../assets/built/images/post/eks/multiCluster.png" alt="clusterUpdate" /></p>

<p>첫 번째로 소개된 Option 1의 방법은 2개의 동일한 환경에서 Amazon Route 53의 가중치 기능을 활용하여 업그레이드하는 방식입니다.</p>

<p>방법은 간단합니다. <strong>싱글 클러스터</strong>에서 별다른 작업을 해주지 않았다면, 아마 Route 53의 <strong>Routing policy</strong>를 <strong>Simple</strong>로 설정해 두었을 겁니다.
<strong>멀티 클러스터</strong>에서는 <strong>Routing policy</strong>를 <strong>Weighted</strong>로 설정해 설정한 비율로 트래픽을 분배하는 원리입니다.</p>

<p><img src="../../assets/built/images/post/aws/defineWeighted.png" alt="clusterUpdate" /></p>

<p>위 캡처와 같이 레코드를 생성할 때, 아래 3가지 요소를 주목하여 가중치 정책을 생성합니다.</p>

<ol>
  <li>DNS의 <strong>캐시를 최소화</strong>하기 위해 <strong>TTL은 1m</strong>(60 seconds)를 권장</li>
  <li>각 다른 환경에서 <strong>50:50 가중치</strong>를 주고 싶을 경우, <strong>2개의 가중치 레코드에 Weighted 값 1</strong>을 부여</li>
  <li><code class="language-plaintext highlighter-rouge">Record ID</code>는 레코드의 <strong>주석</strong>과 같은 역할을 하지만 <strong>필수</strong>로 작성해야  (이어서 이 값의 중요성을~~ 😱)</li>
</ol>

<h2 id="externaldns">ExternalDNS</h2>

<p>Kubernetes는 KubeDNS를 내부 DNS 서버로 활용합니다. Route 53과 같은 다른 DNS 공급자를 사용하기 위해서는 <a href="https://github.com/kubernetes-sigs/external-dns">external-dns</a>를 추가적으로 설치해 사용합니다.
물론 external-dns를 사용하지 않고 <strong>외부 DNS의 영역과 k8s의 영역을 분리하여 사용</strong>할 수도 있지만, external-dns를 적용한다면 <strong>외부 DNS 공급자도 코드로 제어</strong>할 수 있습니다.</p>

<h3 id="set-up">Set up</h3>

<p>ExternalDNS를 EKS에 설정하는 방법은 <a href="https://aws.amazon.com/premiumsupport/knowledge-center/eks-set-up-externaldns/">첨부 링크</a>에 자세하게 설명되어 있지만, 놓치기 쉬운 2가지 부분을 언급하고 넘어가겠습니다.</p>

<h4 id="externaldns-1">ExternalDNS</h4>

<p>external-dns를 최종 배포하기 전, <code class="language-plaintext highlighter-rouge">Deployment</code>의 아래 2가지 인자를 수정해야 합니다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">args</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">--domain-filter=&lt;Your_R53_Domain_Name&gt;</span>
    <span class="pi">-</span> <span class="s">--txt-owner-id=&lt;Your_R53_HostedZone_Id&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>🐞 이번 포스팅을 준비하며 external-dns가 간헐적으로 동작하는 경우를 목격했습니다. <br />
원인은 해당 인자를 오기재했기 때문인데, 원래대로라면 동작하지 않아야 하는데 버그인 것 같습니다.</p>
</blockquote>

<h4 id="ingress">Ingress</h4>

<p>ExternalDNS를 제대로 설정했다면, 이어서 외부로 노출할 <code class="language-plaintext highlighter-rouge">Ingress</code>의 <code class="language-plaintext highlighter-rouge">annotations</code>를 수정합니다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">external-dns</span><span class="pi">:</span> <span class="s">public</span>
<span class="s">external-dns.alpha.kubernetes.io/hostname</span><span class="pi">:</span> <span class="s">myDomain.com</span>
<span class="s">external-dns.alpha.kubernetes.io/set-identifier</span><span class="pi">:</span> <span class="s">recordID</span>
<span class="s">external-dns.alpha.kubernetes.io/aws-weight</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1'</span>
</code></pre></div></div>

<p>Simple 라우팅 정책에서는 <code class="language-plaintext highlighter-rouge">set-identifier</code>가 없어도 되지만, 이외 라우팅 정책에서는 <strong>필수</strong>적으로 들어가야 합니다. 
직전 콘솔에서는 <code class="language-plaintext highlighter-rouge">Record ID</code>를 기재하지 않았을 경우 화면이 넘어가지 않지만, external-dns에서 해당 값이 빠지면 로그와 파드 상태 모두 특이점이 발견되지 않아 원인을 찾기 어려워집니다.</p>

<h3 id="issue">Issue</h3>

<p><strong>yaml 파일에 의도를 기재하여 배포했지만, 정작 Route 53에서 레코드가 업데이트되지 않는 경우</strong></p>

<p>구축 초기부터 가중치 정책을 적용한 멀티 클러스터를 생성한다면 해당 이슈를 만나지 않겠지만,
싱글 클러스터로 external-dns를 운영하고 있는 환경에서 멀티 클러스터를 적용하면 <a href="https://github.com/kubernetes-sigs/external-dns/issues/1411">해당 이슈</a>를 만날 수 있습니다.</p>

<blockquote>
  <p>UPSERT is not possible, doing UPSERT will actually do a CREATE that will fail</p>
</blockquote>

<p>이를 해결하기 위해 노출하고자 하는 Ingress를 <code class="language-plaintext highlighter-rouge">delete &amp; apply</code> 한다면 우회가 가능하겠지만, 운영하고 있는 서비스라면 <strong>다운타임</strong>이 발생할 것입니다.
지금으로서는 Route 53 콘솔 화면에서 수동으로 기존의 정책을 수정해 주고 후속으로 생성하는 클러스터는 코드로 제어하는 방법이 있습니다. 그러나 코드와 콘솔 2가지 채널에서 인프라를 다루는 방법은 바람직하지 않습니다.</p>

<p><strong>해당 이슈를 해결한 직후 external-dns의 logs</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>│ <span class="nb">time</span><span class="o">=</span><span class="s2">"2023-02-25T16:28:56Z"</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">"Applying provider record filter for domains: [myDomain.com. .myDomain.com.]"</span>
│ <span class="nb">time</span><span class="o">=</span><span class="s2">"2023-02-25T16:28:57Z"</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">"Desired change: CREATE ex.myDomain.com A [Id: /hostedzone/Z0HOSTEDZONEID]"</span>
│ <span class="nb">time</span><span class="o">=</span><span class="s2">"2023-02-25T16:28:57Z"</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">"Desired change: CREATE ex.myDomain.com TXT [Id: /hostedzone/Z0HOSTEDZONEID]"</span>
│ <span class="nb">time</span><span class="o">=</span><span class="s2">"2023-02-25T16:28:57Z"</span> <span class="nv">level</span><span class="o">=</span>error <span class="nv">msg</span><span class="o">=</span><span class="s2">"Failure in zone myDomain.com. [Id: /hostedzone/Z0HOSTEDZONEID]"</span>
│ <span class="nb">time</span><span class="o">=</span><span class="s2">"2023-02-25T16:28:57Z"</span> <span class="nv">level</span><span class="o">=</span>error <span class="nv">msg</span><span class="o">=</span><span class="s2">"InvalidChangeBatch: [RRSet with DNS name ex.myDomain.com.,
│ type TXT, SetIdentifier recordID cannot be created as a non-weighted set exists with the same name and type.]</span><span class="se">\n\t</span><span class="s2">status code: 400, request
│ time="</span>2023-02-25T16:28:57Z<span class="s2">" level=error msg="</span>failed to submit all changes <span class="k">for </span>the following zones: <span class="o">[</span>/hostedzone/Z0HOSTEDZONEID]<span class="s2">"

-- After changing Simple Routing policy --

│ time="</span>2023-02-25T16:29:58Z<span class="s2">" level=info msg="</span>2 record<span class="o">(</span>s<span class="o">)</span> <span class="k">in </span>zone myDomain.com. <span class="o">[</span>Id: /hostedzone/Z0HOSTEDZONEID] were successfully updated<span class="s2">"
│ time="</span>2023-02-25T16:30:58Z<span class="s2">" level=info msg="</span>Applying provider record filter <span class="k">for </span>domains: <span class="o">[</span>myDomain.com. .myDomain.com.]<span class="s2">"
│ time="</span>2023-02-25T16:30:58Z<span class="s2">" level=info msg="</span>All records are already up to <span class="nb">date</span><span class="s2">"
</span></code></pre></div></div>

<h3 id="검증">검증</h3>

<p>실제 1:1로 라우팅이 일어나고 있나 확인하고 싶다면, <code class="language-plaintext highlighter-rouge">웹</code> 혹은 <code class="language-plaintext highlighter-rouge">dig</code> 명령어로 확인이 가능하지만 가장 정확한 방법은 Route 53 내 <strong>Test record</strong>를 사용하는 것입니다.
Record 테스트를 위해 Record name을 기재하고 <strong>Get response</strong> 버튼을 누르면 <strong>Response returned by Route 53</strong> 화면에서 실시간으로 바뀌는 IP를 확인할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/aws/testRecord.png" alt="testRecord" /></p>

<h4 id="멀티-클러스터-교체-작업">멀티 클러스터 교체 작업</h4>

<p>❗️ 기존 클러스터를 A, 업그레이드를 진행할 클러스터를 B라 가정하겠습니다.</p>

<p>B 클러스터가 문제없다 판단되면, 다시 한번 가중치를 조절해 A 클러스터를 대체합니다.</p>

<blockquote>
  <p>가중치 변화, 1:0 🔜 1:1 🔜 0:1</p>
</blockquote>

<p>B 클러스터에서 문제가 있다 판단되면 B의 가중치를 0으로 바꾸면 롤백의 효과를 볼 수 있습니다.</p>

<p><br /></p>

<h2 id="outro">Outro</h2>

<p>external-dns는 Route 53 리소스를 제어할 수 있어 편리하면서도 운영이 복잡합니다. 위에서 언급한 이슈 외에도 GitOps를 구축한 상태에서 멀티 클러스터를 운용하려면, 각 클러스터마다 다른 Repository가 필요합니다.
terraform으로 external-dns를 대체할 수도 있지만, eksctl를 사용한다면 external-dns가 도움이 되니 사용 환경에 따라 적절한 도구를 사용해야 할 것 같습니다.
모든 것을 코드로 관리하는 것은 쉽지 않네요. 🤣</p>

<p>소중한 시간을 내어 읽어주셔서 감사합니다! 잘못된 내용은 지적해 주세요! 😃</p>

<p><br /></p>

<hr />

<p><br /></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Heuristic Wave Blog</h3>
                    <p>Get the latest posts delivered right via RSS</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="url" name="rss url" value="https://heuristicwave.github.io" readonly />
    </div>
    <!--To Do Rss Web Font <i class="fas fa-rss"></i> -->
    <button class="" type="submit" disabled><span>Copy</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://heuristicwave.github.io/EKS_Upgrade';
                            this.page.identifier = '/EKS_Upgrade';
                            this.page.title = 'Amazon EKS Multi Cluster Upgrade with ExternalDNS';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://heuristicwave-github-io.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Heuristic Wave Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/aws/">Aws</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/OpenAI_Lambda">Using OpenAI API with AWS Lambda</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/eksctl_ppt">DIY Amazon EKS with eksctl</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ECS_Walkthrough">ECS on EC2 Walkthrough</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/aws/">
                                
                                    See all 16 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/OpenAI_Lambda">
                <div class="post-card-image" style="background-image: url(/assets/built/images/background/OpenAI.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/OpenAI_Lambda">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Aws</span>
                            
                        
                            
                                <span class="post-card-tags">Serverless</span>
                            
                        
                    

                    <h2 class="post-card-title">Using OpenAI API with AWS Lambda</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://heuristicwave.github.io/">
            
            <span>Heuristic Wave Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Amazon EKS Multi Cluster Upgrade with ExternalDNS</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Amazon+EKS+Multi+Cluster+Upgrade+with+ExternalDNS&amp;url=https://heuristicwave.github.ioEKS_Upgrade"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://heuristicwave.github.ioEKS_Upgrade"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://heuristicwave.github.io/">Heuristic Wave Blog</a> &copy; 2023</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Search on Heuristic Wave Blog</h1>
                <p class="subscribe-overlay-description">lunr.js를 이용한 posts 검색</p>
                <span id="searchform" method="post" action="/search/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                <br>
            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-0FTXSPJZFY', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
