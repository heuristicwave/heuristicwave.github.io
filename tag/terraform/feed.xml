<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" >
  <generator uri="https://jekyllrb.com/" version="3.9.3">Jekyll</generator>
  <link href="https://heuristicwave.github.io/tag/terraform/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://heuristicwave.github.io/" rel="alternate" type="text/html" />
  <updated>2023-03-08T15:42:09+00:00</updated>
  <id>https://heuristicwave.github.io/tag/terraform/feed.xml</id>

  
  
  

  
    <title type="html">Heuristic Wave Blog | </title>
  

  
    <subtitle>Careful Writer</subtitle>
  

  

  
    
      
    
  

  
  

  
    <entry>
      <title type="html">Terraform Tips 5 - Import</title>
      <link href="https://heuristicwave.github.io/TerraformTips5" rel="alternate" type="text/html" title="Terraform Tips 5 - Import" />
      <published>2022-07-23T00:00:00+00:00</published>
      <updated>2022-07-23T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/TerraformTips5</id>
      <content type="html" xml:base="https://heuristicwave.github.io/TerraformTips5">&lt;p&gt;Terraform ë” ìµìˆ™í•˜ê²Œ 5 - Import&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p&gt;IaCë¥¼ ë„ì…í•˜ê¸° ìœ„í•´ êµ¬ì¶• ë‹¨ê³„ë¶€í„° ì½”ë“œë¡œ ì¸í”„ë¼ë¥¼ ì‘ì„±í•  ìˆ˜ë„ ìˆì§€ë§Œ, ê¸° êµ¬ì¶•ëœ ì¸í”„ë¼ë¥¼ ì½”ë“œí™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ì´ë•Œ ì‚¬ìš©í•˜ëŠ” Terraformì˜ ê¸°ëŠ¥ì´ ë°”ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Import&lt;/code&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;í•˜ì§€ë§Œ ì €ëŠ” êµ¬ì¶• ë‹¨ê³„ì—ë„ ì¢…ì¢… &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Import&lt;/code&gt; ê¸°ëŠ¥ì„ í™œìš©í•©ë‹ˆë‹¤. Terraformìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs&quot;&gt;registry.terraform.io&lt;/a&gt;ì—ì„œ
ê°€ì´ë“œ í•˜ëŠ” ëŒ€ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ìƒê°ë³´ë‹¤ ì–´ë ¤ìš´ ì‘ì—…ì´ê¸° ë•Œë¬¸ì´ì£ . ğŸ¥²&lt;/p&gt;

&lt;p&gt;ê·¸ë˜ì„œ ì €ëŠ” ë¨¼ì € êµ¬ì¶•í•˜ê³ ì í•˜ëŠ” ì¸í”„ë¼ë¥¼ ì½˜ì†”ìƒì—ì„œ êµ¬ì„±í•œ ë‹¤ìŒ, êµ¬ì¶•ì— í•„ìš”í•œ Attribute ë“¤ì„ íŒŒì•…í•©ë‹ˆë‹¤.
ê·¸ë‹¤ìŒ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Import&lt;/code&gt;ë¥¼ ì‚¬ìš©í•´ ë™ì‘í•˜ëŠ” IaC ì½”ë“œë¥¼ ì–»ê³  ìˆ˜ì •í•©ë‹ˆë‹¤.
ì¦‰, ì €ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Import&lt;/code&gt; ê¸°ëŠ¥ì„ Cheat Sheetì²˜ëŸ¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ğŸ˜…&lt;/p&gt;

&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì‹¤ì œ ì œê°€ Cheat Sheetìœ¼ë¡œ í™œìš©í•˜ëŠ” &lt;em&gt;â€˜Import ì‹œë‚˜ë¦¬ì˜¤â€™&lt;/em&gt;ë¥¼ í†µí•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Import&lt;/code&gt;ë¥¼ í•™ìŠµí•´ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;-ì¡°ë¦½ì€-ë¶„í•´ì˜-ì—­ìˆœ&quot;&gt;â® ì¡°ë¦½ì€ ë¶„í•´ì˜ ì—­ìˆœ&lt;/h2&gt;

&lt;p&gt;AWS Systems Managerì˜ ì¸ìŠ¤í„´ìŠ¤ ìš´ì˜ ìë™í™”ë¥¼ ìœ„í•œ State Manager ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ssm_association&quot;&gt;ë¬¸ì„œ&lt;/a&gt;ë¥¼
í™•ì¸í•´ ë³´ì•˜ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ ì‚¬ìš©ë²• ë§Œì´ ê¸°ì¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;resource&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aws_ssm_association&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;example&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_ssm_document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;

  &lt;span class=&quot;nx&quot;&gt;targets&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;InstanceIds&quot;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;í•´ë‹¹ ì½”ë“œë¥¼ apply í•´ë„ ë¬´ìˆ˜í•œ Errorë§Œ ë§Œë‚  ë¿ ë¹ ë¥´ê²Œ ì§„ë„ê°€ ë‚˜ê°€ì§€ ì•Šê¸°ì—, ìš°ì„  AWS ì›¹ ì½˜ì†”ì„ í™œìš©í•´ ì¸ìŠ¤í„´ìŠ¤ ìš´ì˜ ìë™í™”ë¥¼ ìœ„í•œ State Manager ê¸°ëŠ¥ì„ êµ¬í˜„í•´ ë‘ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;0ï¸âƒ£-ì¤€ë¹„-ì‘ì—…&quot;&gt;0ï¸âƒ£ ì¤€ë¹„ ì‘ì—…&lt;/h3&gt;

&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì˜ ì‘ì—… ê³µê°„(~/terraform)ì„ ìƒì„±í•˜ê³  í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì•„ë˜ ì½”ë“œ ë¸”ë¡ì„ í„°ë¯¸ë„ì— ë³µì‚¬í•©ë‹ˆë‹¤. (ë¦¬ì†ŒìŠ¤ê°€ ìœ„ì¹˜í•œ ë¦¬ì „ ëª…ì— ë§ê²Œ ì„¸íŒ…í•´ ì£¼ì„¸ìš”)&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; provider.tf
provider &quot;aws&quot; {
  region  = &quot;ap-northeast-2&quot;
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì´í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform init&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ì„¸ìš”.&lt;/p&gt;

&lt;h3 id=&quot;1ï¸âƒ£-skeleton-code-ì‘ì„±&quot;&gt;1ï¸âƒ£ Skeleton Code ì‘ì„±&lt;/h3&gt;

&lt;p&gt;ì›¹ ì½˜ì†”ë¡œ ì‘ì—…í•œ State Managerë¥¼ ì½”ë“œí™”í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ Skeleton Codeë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
(import í›„, ìƒì„±ë˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt;ë¥¼ ë‹´ëŠ” ì¼ì¢…ì˜ ë¹µí‹€ì„ ì œì‘í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.)&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; main.tf
resource &quot;aws_ssm_association&quot; &quot;copycat&quot; {}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2ï¸âƒ£-import-configuration&quot;&gt;2ï¸âƒ£ Import Configuration&lt;/h3&gt;

&lt;p&gt;ì‚¬ìš©ë²•(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform import [options] ADDRESS ID&lt;/code&gt;)ì— ë”°ë¼ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ &lt;strong&gt;root directory&lt;/strong&gt;ì— ë¯¸ë¦¬ ìƒì„±ëœ ì¸í”„ë¼ê°€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt; íŒŒì¼ì— ë‹´ê¹ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform import aws_ssm_association.copycat &amp;lt;Association ID&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìƒì„±ëœ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt; íŒŒì¼ì„ í™•ì¸í•˜ë©´ json í˜•íƒœë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws_ssm_association&lt;/code&gt; resource blockì— ì‘ì„±í•´ì•¼ í•˜ëŠ” ê°ì¢… Config ê°’ë“¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;show&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ HCL Syntaxì— ë§ì¶° &lt;strong&gt;human-readable&lt;/strong&gt;í•œ í˜•íƒœë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform show &lt;span class=&quot;nt&quot;&gt;-no-color&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; main.tf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë³¸ë˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-no-color&lt;/code&gt; ì˜µì…˜ì€ coloring ì‘ì—…ì„ ë¹„í™œì„±í™”í•˜ì§€ë§Œ, Editorì— format ë§ì¶”ê¸° ìœ„í•´ í•„ìˆ˜ì ìœ¼ë¡œ í•´ë‹¹ ì˜µì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;3ï¸âƒ£-modify-arguments&quot;&gt;3ï¸âƒ£ Modify Arguments&lt;/h3&gt;

&lt;p&gt;ì´ì œì„œì•¼ ì–¼ì¶” ëª¨ì–‘ì„ ê°–ì¶˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main.tf&lt;/code&gt;ì˜ &lt;strong&gt;resource block&lt;/strong&gt;ì—ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì¸í”„ë¼ì— &lt;strong&gt;ë°˜ì˜ëœ ì´í›„ ë‹¨ê³„ì— ìƒì„±ë˜ëŠ” ê°ì¢… result&lt;/strong&gt; ê°’(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arn&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;association_id&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt;)
ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ê°’ë“¤ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform plan&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•´ Error ë©”ì‹œì§€ì— ëª…ì‹œë˜ë¯€ë¡œ ì§€ì›Œì•¼ í•˜ëŠ” Argumentsë“¤ì„ ì°¾ì•„ ì½”ë“œë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ë•Œ, Instancd Id, IAM Role ARN ë“±ê³¼ ê°™ì´ &lt;strong&gt;ì ˆëŒ€ì ì¸ ê°’&lt;/strong&gt;ë„ &lt;strong&gt;ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜&lt;/strong&gt;ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
í•´ë‹¹ ì‘ì—…ì„ ë§ˆì¹˜ê³  ë‚˜ë©´, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apply&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ì—¬ ë‹¤ìŒ ë©”ì‹œì§€ë¥¼ ì–»ìœ¼ë©´ ì •ìƒì ìœ¼ë¡œ Import ì‘ì—…ì´ ì™„ë£Œëœ ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Apply complete! Resources: 0 added, 0 changed, 0 destroyed.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;-import-into-module&quot;&gt;ğŸ¥µ Import into Module&lt;/h2&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ í•™ìŠµí•œ ì ˆì°¨ëŠ” ë‹¨ìˆœ &lt;strong&gt;Resource&lt;/strong&gt;ì— Import ì‹œí‚¤ë¯€ë¡œ ë¹„êµì  ìˆ˜ì›”í•œ ê³¼ì •ì´ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Resource configured with count &lt;br /&gt;
â¡ï¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform import 'aws_instance.baz[0]' i-abcd1234&lt;/code&gt; &lt;br /&gt;
Resource configured with for_each &lt;br /&gt;
â¡ï¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform import 'aws_instance.baz[&quot;example&quot;]' i-abcd1234&lt;/code&gt; &lt;br /&gt;
Module &lt;br /&gt;
â¡ï¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform import module.foo.aws_instance.bar i-abcd1234&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Moduleì„ Import í•˜ëŠ” ì ˆì°¨ë„ Resourceì™€ ë™ì¼í•˜ì§€ë§Œ, ëª…ë°±í•œ &lt;strong&gt;í•œê³„ì &lt;/strong&gt;ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;í”í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” &lt;a href=&quot;https://registry.terraform.io/modules/terraform-aws-modules/ec2-instance/aws/latest&quot;&gt;ec2-instance&lt;/a&gt; ëª¨ë“ˆì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•˜ê² ìŠµë‹ˆë‹¤.
Resource ë•Œì™€ ë™ì¼í•˜ê²Œ ì•„ë˜ì™€ ê°™ì€ Skeleton Codeë¥¼ ì‘ì„±í•˜ê³  Import ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë¶€ë¶„ì€ ë™ì¼í•©ë‹ˆë‹¤. (1ï¸âƒ£ &amp;amp; 2ï¸âƒ£ ê³¼ì • ë™ì¼)&lt;/p&gt;

&lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ec2_instance&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;source&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;terraform-aws-modules/ec2-instance/aws&quot;&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;~&amp;gt; 3.0&quot;&lt;/span&gt;

  &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;single-instance&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì´ë•Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foo&lt;/code&gt;ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ec2_instance&lt;/code&gt;ê°€ ë˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bar&lt;/code&gt;ëŠ” í•´ë‹¹ ëª¨ë“ˆì˜ &lt;strong&gt;aws_instance&lt;/strong&gt;ì—ì„œ ì •ì˜í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;this&lt;/code&gt;ê°€ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë¬¸ì œëŠ” &lt;strong&gt;3ï¸âƒ£ Modify Arguments&lt;/strong&gt; ë‹¨ê³„ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. Single Resourceì—ì„œëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt;ì„ í†µí•´ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” &lt;strong&gt;Arguments&lt;/strong&gt;ë“¤ì„ ì•Œ ìˆ˜ ìˆì§€ë§Œ, 
moduleì—ì„œ skeleton code ì´ì™¸ì— ë” ê¸°ì¬í•´ì•¼ í•˜ëŠ” variable ê°’ë“¤ì„ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ì¦‰, module import ì´í›„ ìƒì„±ë˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt; íŒŒì¼ì˜ &lt;strong&gt;json ê°’ì„ ì¼ì¼ì´ í™•ì¸&lt;/strong&gt;í•˜ì—¬ moduleì˜ &lt;strong&gt;input parameterì— í•´ë‹¹í•˜ëŠ” ê°’&lt;/strong&gt;ë“¤ì„ ì•Œì•„ë‚´ &lt;strong&gt;í•˜ë‚˜ì”© ë‹¤ ê¸°ì¬&lt;/strong&gt;í•˜ëŠ” ë°©ë²• ì™¸ì—ëŠ” 
ì˜¨ì „í•˜ê²Œ import ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;Reverse Engineeringìœ¼ë¡œ ì›ë˜ì˜ ì½”ë“œë¥¼ ì™„ë²½í•˜ê²Œ ì¬í˜„í•˜ê¸° ì–´ë ¤ìš´ ê²ƒì²˜ëŸ¼, êµ¬ì„±ì´ ë³µì¡í•œ ëª¨ë“ˆì€ Reverse Terraformingì´ ë§¤ìš° ì–´ë µìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;-reverse-terraform-open-source&quot;&gt;ğŸŒ Reverse Terraform Open Source&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;2ï¸âƒ£ Import Configuration&lt;/strong&gt; ë‹¨ê³„ì—ì„œ ìˆ˜í–‰í•œ ì‘ì—…ì€ &lt;a href=&quot;https://github.com/GoogleCloudPlatform/terraformer&quot;&gt;Terraformer&lt;/a&gt;(ì‘ì„± ì‹œì  ê¸°ì¤€ â˜… 8.1k),
&lt;a href=&quot;https://github.com/dtan4/terraforming&quot;&gt;Terraforming&lt;/a&gt;(ì—…ë°ì´íŠ¸ ì¢…ë£Œ) ë“±ê³¼ ê°™ì€ ì˜¤í”ˆì†ŒìŠ¤ ë„êµ¬ë¥¼ í™œìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;âš ï¸ ê³ ë ¤ ì‚¬í•­&lt;/strong&gt;&lt;br /&gt;
&lt;strong&gt;Terraformer&lt;/strong&gt;ëŠ” &lt;a href=&quot;https://github.com/GoogleCloudPlatform/terraformer/blob/master/docs/aws.md#profiles-support&quot;&gt;AWS configuration Profiles Select&lt;/a&gt;ì™€ &lt;a href=&quot;https://github.com/GoogleCloudPlatform/terraformer/blob/master/docs/aws.md#attribute-filters&quot;&gt;Attribute filters&lt;/a&gt;ê³¼ ê°™ì€ í¸ë¦¬í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤. &lt;br /&gt;
ê·¸ëŸ¬ë‚˜ &lt;a href=&quot;https://github.com/GoogleCloudPlatform/terraformer/blob/master/docs/aws.md#supported-services&quot;&gt;terraformer AWS ë¦¬ì†ŒìŠ¤ ì§€ì› ë²”ìœ„&lt;/a&gt;ì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ì‹œí”¼,
ìœ„ì—ì„œ ì‘ì—…í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws_ssm_association&lt;/code&gt;ê³¼ ê°™ì´ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ë“¤ë„ ì¡´ì¬í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outro&quot;&gt;Outro&lt;/h2&gt;

&lt;p&gt;ë§ˆì§€ë§‰ìœ¼ë¡œ Import Workflowë¥¼ ë‹¤ì‹œ í•œë²ˆ ì •ë¦¬í•˜ë©´ì„œ ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Import ëŒ€ìƒ(ì´ë¯¸ í”„ë¡œë¹„ì €ë‹ ëœ ì¸í”„ë¼)ì´ ë˜ëŠ” Skeleton Code ì‘ì„±&lt;/li&gt;
  &lt;li&gt;Write Config : Import &amp;amp; Show ëª…ë ¹ì–´ ìˆ˜í–‰&lt;/li&gt;
  &lt;li&gt;Modify Arguments&lt;/li&gt;
  &lt;li&gt;Plan &amp;amp; Apply&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ í…Œë¼í¼ ë” ìµìˆ™í•˜ê²Œ Import í¸ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ ì£¼ì„¸ìš”! ğŸ˜ƒ&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ğŸ“š References&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Terraform Documentation &lt;a href=&quot;https://www.terraform.io/cli/commands/import&quot;&gt;Import Command&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Hashicorp Tutorial ë¬¸ì„œ &lt;a href=&quot;https://learn.hashicorp.com/tutorials/terraform/state-import?in=terraform/state&quot;&gt;Import Terraform Configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Tips&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips1&quot;&gt;Module &amp;amp; Output&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips2&quot;&gt;Data &amp;amp; Index&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips3&quot;&gt;Refresh &amp;amp; Replace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips4&quot;&gt;Move (Refactoring)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips5&quot;&gt;Import&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraform ë” ìµìˆ™í•˜ê²Œ 5 - Import</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Terraform Tips 4 - Move (Refactoring)</title>
      <link href="https://heuristicwave.github.io/TerraformTips4" rel="alternate" type="text/html" title="Terraform Tips 4 - Move (Refactoring)" />
      <published>2022-06-07T00:00:00+00:00</published>
      <updated>2022-06-07T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/TerraformTips4</id>
      <content type="html" xml:base="https://heuristicwave.github.io/TerraformTips4">&lt;p&gt;Terraform ë” ìµìˆ™í•˜ê²Œ 4 - Move (Refactoring)&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://heuristicwave.github.io/TerraformTips3&quot;&gt;ì§€ë‚œ 3í¸&lt;/a&gt;ì—ì„œëŠ” &lt;em&gt;ì½”ë“œì˜ ë³€ê²½ ì—†ì´&lt;/em&gt; í˜•ìƒì„ ìœ ì§€í•˜ëŠ” ê¸°ë²• ì¤‘ í•˜ë‚˜ì¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Refresh&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Replace&lt;/code&gt;ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
4í¸ì—ì„œëŠ” &lt;em&gt;ì½”ë“œë¥¼ ë³€ê²½(Refactoring)&lt;/em&gt; í•  ë•Œ í˜•ìƒì„ ìœ ì§€í•˜ëŠ” ë°©ë²•ì¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Move&lt;/code&gt;ì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;-moving-resources&quot;&gt;ğŸ¤¹ Moving Resources&lt;/h2&gt;

&lt;p&gt;Terraformìœ¼ë¡œ ì •ì˜í•œ ì¸í”„ë¼ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform.tfstate&lt;/code&gt;ì— ê¸°ë¡ë˜ë©°, real-worldì˜ ê°ì²´ëŠ” íŠ¹ì • &lt;a href=&quot;https://www.terraform.io/cli/state/resource-addressing&quot;&gt;ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ&lt;/a&gt;ì™€ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ ì •ì˜í•œ ì¸í”„ë¼ ì½”ë“œë¥¼ ë³€ê²½ í›„, ì ìš©í•˜ë©´ real-worldì˜ ê°ì²´ì™€ ìƒíƒœê°€ ë³€ê²½ë©ë‹ˆë‹¤.
ì½”ë“œë¡œ ì •ì˜ëœ ì‹¤ì œ ì¸í”„ë¼ë¥¼ ìš´ì˜í•˜ê³  ìˆë‹¤ë©´, ì½”ë“œ ë¦¬íŒ©í† ë§ ì‹œ ë°œìƒí•˜ëŠ” ë¦¬ì†ŒìŠ¤ ë³€ê²½ ì§€ì ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;State&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ í™œìš©í•´ í•´ì†Œí•´ì•¼ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Commands&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;state mv&lt;/code&gt; : real-world ê°ì²´ì™€ ì—°ê²°ëœ ë¦¬ì†ŒìŠ¤ ì£¼ì†Œë¥¼ ë³€ê²½&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;state rm&lt;/code&gt; : real-world ê°ì²´ë¥¼ íŒŒê´´í•˜ì§€ ì•Šê³  ì½”ë“œë¡œ ì •ì˜í•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ëŒ€ìƒ ì œê±°&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;state replace-provider&lt;/code&gt; : ì¬ìƒì„± ì—†ì´, ìƒˆë¡œìš´ providerì— ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ ì „&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-state-mv&quot;&gt;ğŸ›  state mv&lt;/h3&gt;

&lt;p&gt;ìœ„ 3ê°€ì§€ ëª…ë ¹ì–´ ì¤‘ì—ì„œë„ ê°€ì¥ í™œìš©ë„ê°€ ë†’ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;state mv&lt;/code&gt; ëª…ë ¹ì–´ì˜ ì˜ˆì‹œë“¤ì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.terraform.io/cli/commands/state/mv#example-rename-a-resource&quot;&gt;ë¦¬ì†ŒìŠ¤ ì´ë¦„ ì¬ì •ì˜&lt;/a&gt; : 
ë¦¬íŒ©í† ë§ ê³¼ì •ì—ì„œ ì •ì˜ëœ ë¦¬ì†ŒìŠ¤ ëª…ì„ ë³€ê²½í•˜ëŠ” ê²½ìš° &lt;br /&gt; 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state mv {ResourceType}.{ExistingName} {ResourceType}.{ChangedName}&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.terraform.io/cli/commands/state/mv#example-move-a-resource-into-a-module&quot;&gt;ë¦¬ì†ŒìŠ¤ë¥¼ ëª¨ë“ˆë¡œ ì´ë™&lt;/a&gt; : 
ë£¨íŠ¸ì— ìœ„ì¹˜í•œ ë¦¬ì†ŒìŠ¤ë¥¼ child ëª¨ë“ˆì— í¬í•¨ì‹œì¼œ ë¦¬íŒ©í† ë§ í•˜ëŠ” ê²½ìš° &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state mv {Type}.{Name} module.{ModuleName}.{Type}.{Name}&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.terraform.io/cli/commands/state/mv#example-move-a-module-into-a-module&quot;&gt;ëª¨ë“ˆì„ ë‹¤ë¥¸ ëª¨ë“ˆë¡œ ì´ë™&lt;/a&gt; &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state mv module.{ModuleName} module.{ParentModuleName}.module.{ModuleName}&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.terraform.io/cli/commands/state/mv#example-move-a-particular-instance-of-a-resource-using-count&quot;&gt;meta-argument &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;for_each&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;count&lt;/code&gt;ë¡œ ì •ì˜ëœ íŠ¹ì • ë¦¬ì†ŒìŠ¤ êµì²´&lt;/a&gt; &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state mv {ResourceType}.{Before}[0] {ResourceType}.{After}[0]&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ï¸-moved-statements&quot;&gt;ğŸƒï¸ Moved statements&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://heuristicwave.github.io/TerraformTips3&quot;&gt;ì§€ë‚œ 3í¸&lt;/a&gt;ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;refresh&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;taint&lt;/code&gt;ê°€ ê°€ì§„ í•œê³„ì ìœ¼ë¡œ ì¸í•˜ì—¬
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--refresh-only&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace&lt;/code&gt;ê°€ ë‚˜ì™”ë“¯ì´, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;state mv&lt;/code&gt;ë„ í•œê³„ì ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform taint&lt;/code&gt; command informs Terraform that a particular object has become degraded or damaged. &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;problems-with-terraform-state-mv&quot;&gt;&lt;a href=&quot;https://youtu.be/bDgoGBusX0k?t=178&quot;&gt;Problems with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state mv&lt;/code&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;ìœ„ ë§í¬ë¡œ ì²¨ë¶€í•œ Terraform 1.1 ë²„ì „ì´ ì¶œì‹œí•˜ë©´ì„œ ë°œí‘œí•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Move&lt;/code&gt; ê¸°ëŠ¥ì— ëŒ€í•œ ë°œí‘œ ìë£Œë¥¼ ë³´ë©´ ì•„ë˜ 3ê°€ì§€ ì´ìœ ë¡œ í•œê³„ì ì„ ë‹¤ë£¹ë‹ˆë‹¤.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Risky and error prone&lt;/li&gt;
  &lt;li&gt;Terraform Cloud users couldnâ€™t refactor within core workflows&lt;/li&gt;
  &lt;li&gt;Module authors couldnâ€™t coordinate changes themselves&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;3ê°€ì§€ì˜ í•œê³„ì ì´ ì–¸ê¸‰ë˜ì—ˆì§€ë§Œ, ê²°êµ­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;refresh&lt;/code&gt; ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt;ì„ í†µí•œ ì˜ˆì¸¡ ê³¼ì •ì´ ì—†ëŠ” ë™ì¼í•œ ì´ìœ ë¡œ ìœ„ì™€ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;refactoring&quot;&gt;&lt;a href=&quot;https://www.terraform.io/language/modules/develop/refactoring&quot;&gt;Refactoring&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;ì•ì„œ ì–¸ê¸‰í•œ í•œê³„ì ë“¤ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt; ê¸°ëŠ¥ì´ ì—†ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mv&lt;/code&gt; ëª…ë ¹ì–´ ëŒ€ì‹  ê¸°ì¡´ì˜ í…Œë¼í¼ ë¬¸ë²•ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;moved&lt;/code&gt; blockì´ ì¶”ê°€ë˜ë©° í•´ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.
ì•„ë˜ ì˜ˆì‹œëŠ” &lt;a href=&quot;https://www.terraform.io/language/modules/develop/refactoring#moved-block-syntax&quot;&gt;ê³µì‹ ë¬¸ì„œ&lt;/a&gt;ì— ê¸°ì¬ëœ ì˜ˆì œì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;locals&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;instances&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;tomap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;big&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;instance_type&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;m3.large&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;small&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;instance_type&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;t2.medium&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;resource&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aws_instance&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;instances&lt;/span&gt;

  &lt;span class=&quot;nx&quot;&gt;instance_type&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;instance_type&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# (other resource-type-specific configuration)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;moved&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;to&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;small&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;moved&lt;/code&gt; blockì— ë³€ê²½ ì „í›„ ìƒíƒœë¥¼ ì„ ì–¸í•˜ì—¬, ê¸°ì¡´ ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” ëª…ë ¹ì¡°ì°¨ë„ ì½”ë“œë¡œ ì„ ì–¸í•˜ì—¬ ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” í–‰ìœ„ë¥¼ ì½”ë“œí™”í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;ï¸-ê³ ë ¤ì‚¬í•­&quot;&gt;â‰ï¸ ê³ ë ¤ì‚¬í•­&lt;/h3&gt;

&lt;p&gt;í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ìš´ì˜ì„ í•˜ë‹¤ ë³´ë©´ ìµœì í™” ê³¼ì • ì¤‘ ë¦¬ì†ŒìŠ¤ ìŠ¤í™(ì¸ìŠ¤í„´ìŠ¤ ì¢…ë¥˜, íƒ€ì…)ì´ ìì£¼ ë³€ê²½ë©ë‹ˆë‹¤.
ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;moved&lt;/code&gt; ë¸”ë¡ì´ ì²´ì¸ê³¼ ê°™ì´ ê¸¸ì–´ì§€ê²Œ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Block 1&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;moved&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;to&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Block 2&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;moved&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;to&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aws_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì´ëŠ” ì˜¤íˆë ¤ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í˜¹ì€ &lt;em&gt;ì¤‘ë³µëœ ì½”ë“œë¥¼ ì§€ìš°ê³  ë¡œì§ì„ ì´í•´í•˜ê¸° ì‰½ê²Œ ë””ìì¸&lt;/em&gt;í•´ì•¼ í•˜ëŠ” &lt;strong&gt;ë¦¬íŒ©í† ë§ê³¼ëŠ” ë©€ì–´ì§€ê²Œ&lt;/strong&gt; ë©ë‹ˆë‹¤.
ê·¸ëŸ¬ë¯€ë¡œ AWS ë¦¬ì†ŒìŠ¤ì˜ ê²½ìš° &lt;strong&gt;ë‹¨ìˆœ ìŠ¤í™ ë³€ê²½&lt;/strong&gt;ê³¼ ê°™ì€ ì‘ì—…ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Launch templates&lt;/code&gt;ì„ ì‚¬ìš©í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.
ì´ì²˜ëŸ¼ AWS ì„œë¹„ìŠ¤ ë‚´ì—ì„œ &lt;strong&gt;í˜•ìƒ ê´€ë¦¬&lt;/strong&gt; ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•´, moved ë¸”ë¡ì„ ìƒì„±í•˜ëŠ” ì‘ì—…ì„ ìµœì†Œí™”í•´ì•¼ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outro&quot;&gt;Outro&lt;/h2&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ë¦¬íŒ©í† ë§ ì‘ì—…ì„ ìœ„í•´ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;state mv&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;moved&lt;/code&gt; syntax ì‚¬ìš©ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Move&lt;/code&gt;ì˜ íƒ„ìƒ ê³¼ì •ì—ì„œ ì„ ì–¸í˜• ë„êµ¬ì¸ í…Œë¼í¼ì˜ ëª©ì ì— ë§ê²Œ ì§„í™”í•´ë‚˜ê°€ëŠ” ëª¨ìŠµê³¼ ì´ˆê¸° ì„¤ê³„ì˜ ì¤‘ìš”ì„±ì„ ê³ ë¯¼í•´ ë³¼ ìˆ˜ ìˆì—ˆë˜ ì¢‹ì€ ê¸°íšŒì˜€ìŠµë‹ˆë‹¤.
ì—¬ë‹´ìœ¼ë¡œ ì €ëŠ” í…Œë¼í¼ ë²„ì „ì´ 0.12ì¼ ë•Œ ë‹¤ë£¨ê¸° ì‹œì‘í–ˆëŠ”ë°, 2ë…„ ë§Œì— ë²„ì „ 1.2.2ì— ì´ë¥´ë©° ì •ì°©í•´ë‚˜ê°€ëŠ” ê³¼ì •ì„ ë³´ë‹ˆ
ì‚¬ìš©ìë„ IaC ë„êµ¬ì˜ ì² í•™ì„ ì´í•´í•˜ë©° í•¨ê»˜ ì„±ì¥í•˜ëŠ” ê¸°ë¶„ì— ê°ê²©ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ í…Œë¼í¼ ë” ìµìˆ™í•˜ê²Œ Move(Refactoring) í¸ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ ì£¼ì„¸ìš”! ğŸ˜ƒ&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Tips&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips1&quot;&gt;Module &amp;amp; Output&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips2&quot;&gt;Data &amp;amp; Index&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips3&quot;&gt;Refresh &amp;amp; Replace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips4&quot;&gt;Move (Refactoring)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips5&quot;&gt;Import&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraform ë” ìµìˆ™í•˜ê²Œ 4 - Move (Refactoring)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Terraform Tips 3 - Refresh &amp;amp; Replace</title>
      <link href="https://heuristicwave.github.io/TerraformTips3" rel="alternate" type="text/html" title="Terraform Tips 3 - Refresh &amp; Replace" />
      <published>2022-05-28T00:00:00+00:00</published>
      <updated>2022-05-28T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/TerraformTips3</id>
      <content type="html" xml:base="https://heuristicwave.github.io/TerraformTips3">&lt;p&gt;Terraform ë” ìµìˆ™í•˜ê²Œ 3 - Refresh &amp;amp; Replace&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p&gt;IaC(Infrastructure as Code)ë¥¼ ìš´ìš©í•˜ë©° ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” í¬ì¸íŠ¸ ì¤‘ í•˜ë‚˜ëŠ”, &lt;strong&gt;ì½”ë“œë¡œ ì •ì˜í•œ í˜•ìƒ&lt;/strong&gt;ê³¼ &lt;strong&gt;ì‹¤ì œ ì¸í”„ë¼ì˜ í˜•ìƒ&lt;/strong&gt;ì„ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
Terraformì—ì„œëŠ” &lt;strong&gt;Configuration Drift&lt;/strong&gt;(ì •ì˜í•œ í˜•ìƒê³¼ ë‹¬ë¼ì§€ëŠ” ê²½ìš°)ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ëª…ë ¹ì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” í˜•ìƒì„ ìœ ì§€í•˜ëŠ” ë‹¤ì–‘í•œ ê¸°ë²• ì¤‘ í•˜ë‚˜ì¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Refresh&lt;/code&gt;ì™€ ë¹„ìŠ·í•˜ë©´ì„œë„ í—·ê°ˆë¦¬ëŠ” ê°œë…ì¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Replace&lt;/code&gt;ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ï¸-refresh&quot;&gt;â™»ï¸ Refresh&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;refresh&lt;/code&gt; ëª…ë ¹ì–´ëŠ” Configuration Driftê°€ ë°œìƒí–ˆì„ ë•Œ, í˜„ì¬ ìƒíƒœë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform.tfstate&lt;/code&gt;ì— ë°˜ì˜í•´ í˜„ì¬ ì¸í”„ë¼ì˜ ìƒíƒœë¡œ ìµœì‹ í™”ì‹œí‚¤ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.
ë¬¸ì„œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê¸°ì¬ë˜ì–´ ìˆì§€ë§Œ, ì²˜ìŒ ì ‘í•œë‹¤ë©´ ë¬´ì—‡ì„ ë§í•˜ëŠ”ì§€ ì‰½ê²Œ ì™€ë‹¿ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform refresh&lt;/code&gt; command reads the current settings from all managed remote objects and updates the Terraform state to match. &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform refresh&lt;/code&gt; ëª…ë ¹ì–´ëŠ” ì›ê²© ê°ì²´ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì½ì–´ Terraform stateì™€ ì¼ì¹˜ì‹œí‚µë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Refresh ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤. í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ í´ëŸ¬ìŠ¤í„°ë¥¼ ìš´ìš©í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤ì˜ Scaleì´ ë³€í™”í•¨ì— ë”°ë¼ ì¸ìŠ¤í„´ìŠ¤ ID ê°’ë„ ë³€í•©ë‹ˆë‹¤.
ì´ ê²½ìš° ì½”ë“œë¡œ ì •ì˜í•œ ìƒíƒœëŠ” í”„ë¡œë¹„ì €ë‹ ë‹¹ì‹œ ì‹œì ì„ ê¸°ì–µí•˜ì§€ë§Œ, ì‹¤ì œ ì¸í”„ë¼ì˜ í˜„ìƒì€ ìµœì‹  ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ Driftê°€ ë°œìƒí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/terraform/state.png&quot; alt=&quot;state&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ìœ„ ìƒí™©ì—ì„œ Refresh ëª…ë ¹ì–´ë¡œ &lt;em&gt;ì½”ë“œì˜ ìƒíƒœì™€ ì¸í”„ë¼ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì¼ì¹˜&lt;/em&gt;ì‹œí‚¬ ìˆ˜ ìˆì§€ë§Œ, í•´ë‹¹ ëª…ë ¹ì–´ëŠ” &lt;strong&gt;deprecate&lt;/strong&gt; ë˜ì—ˆìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ê´€ë¦¬ìê°€ ë¬´ì—‡ì´ ë³€ê²½ë˜ëŠ”ì§€ ì•Œì§€ ëª»í•˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tfstate&lt;/code&gt;ê°€ ìµœì‹ í™”ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ê·¸ë˜ì„œ í…Œë¼í¼ v0.15.4.ì—ì„œë¶€í„°ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt;ê³¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apply&lt;/code&gt;ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-refresh-only&lt;/code&gt; ì˜µì…˜ì„ ì œê³µí•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;refresh-only&quot;&gt;â€“refresh-only&lt;/h3&gt;

&lt;p&gt;ì™¼ìª½ì€ í”„ë¡œë¹„ì €ë‹ ë‹¹ì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt;ì…ë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì€ í•´ë‹¹ í™˜ê²½ì„ ì½˜ì†”ì—ì„œ health checkë¥¼ í•˜ëŠ” ê°„ê²©ì„ 120ì´ˆë¡œ ë³€ê²½í•œ í™”ë©´ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/terraform/refresh.png&quot; alt=&quot;refresh&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ì˜ë„ì ìœ¼ë¡œ Drfit ìƒí™©ì„ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform plan --refresh-only&lt;/code&gt; ëª…ë ¹ì–´ë¡œ ì ê²€í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì–´ë–¤ ë¦¬ì†ŒìŠ¤ ê°ì²´ê°€ ë³€ê²½ë  ê²ƒì¸ì§€ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/terraform/refresh-only.png&quot; alt=&quot;refresh-only&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ìœ„ ì‚¬ì§„ì—ì„œëŠ” elbì˜ AutoScalingGroup ë‚´ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë°”ë€Œì–´ ìµœì‹ í™”ë¨ê³¼, ì œê°€ ì˜ë„ì ìœ¼ë¡œ ì½˜ì†”ì—ì„œ ë³€ê²½í•œ health_check ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ì²˜ëŸ¼ í•­ìƒ IaCì˜ í˜•ìƒì„ ë³€ê²½í•˜ê¸° ì „, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt;ì„ í†µí•œ ì‚¬ì „ ê²€í†  ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--refresh-only&lt;/code&gt; ì˜µì…˜ì´ ì œê³µë˜ì—ˆìŠµë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt;ìœ¼ë¡œ ë¬¸ì œì—†ìŒì„ í™•ì¸í–ˆë‹¤ë©´, ì´ì–´ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply --refresh-only&lt;/code&gt; ëª…ë ¹ì–´ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt;ë¥¼ ìµœì‹ í™” ì‹œí‚µë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;ï¸-ì£¼ì˜&quot;&gt;âš ï¸ ì£¼ì˜&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.tfstate&lt;/code&gt;ëŠ” Refreshë¡œ ìµœì‹ í™”ë˜ì—ˆì§€ë§Œ, ì—¬ì „íˆ ì½”ë“œë¡œ ì •ì˜í•œ interval ê°’ì€ 180ì…ë‹ˆë‹¤.
ê·¸ëŸ¬ë¯€ë¡œ ì½”ë“œë¡œ ì •ì˜ëœ ë¶€ë¶„ì„ ë³€ê²½í•˜ì§€ ì•Šì€ ìƒí™©ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt; ëª…ë ì–´ë¥¼ ì¹˜ë©´, í˜„ì¬ 120ì˜ interval ê°’ì´ 180ìœ¼ë¡œ ì›ë³µ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ï¸-taint&quot;&gt;â˜ ï¸ Taint&lt;/h2&gt;

&lt;p&gt;Replaceë¥¼ ì„¤ëª…í•˜ê¸° ì•ì„œ, ê¸°ì¡´ í…Œë¼í¼ì—ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;taint&lt;/code&gt;ë¼ëŠ” ëª…ë ¹ì–´ê°€ ìˆìŠµë‹ˆë‹¤. ë¬¸ì„œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê¸°ì¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform taint&lt;/code&gt; command informs Terraform that a particular object has become degraded or damaged. &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform taint&lt;/code&gt; ëª…ë ¹ì–´ëŠ” íŠ¹ì • ê°ì²´ê°€ ì €í•˜ë˜ê±°ë‚˜ ì†ìƒë˜ì—ˆìŒì„ Terraformì— ì•Œë¦½ë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Taint ëª…ë ¹ì–´ëŠ” &lt;strong&gt;ì¸í”„ë¼ë¥¼ ì •ì˜í•œ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ&lt;/strong&gt;ì¸ ìƒíƒœì—ì„œ &lt;strong&gt;ë¦¬ì†ŒìŠ¤ë§Œ êµì²´&lt;/strong&gt;í•  ê²½ìš°ì— ì‚¬ìš©í•©ë‹ˆë‹¤.
ì €ì˜ ê²½ìš° ìŠ¤íŒŒì´í¬ì„± íŠ¸ë˜í”½ì„ ê°‘ìê¸° ë°›ì•„ ë¡œë“œë°¸ëŸ°ì„œì˜ ì„±ëŠ¥ì´ ì €í•˜ë˜ì—ˆì„ ë•Œ, ELBë¥¼ êµì²´í•œ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ëŸ° ìƒí™©ì—ì„œ ì„±ëŠ¥ì´ ì €í•˜ëœ í˜¹ì€ &lt;strong&gt;êµì²´ê°€ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤&lt;/strong&gt; ê°ì²´ë§Œì„ on/off ë°©ì‹ìœ¼ë¡œ &lt;strong&gt;ì£¼ì„ ì²˜ë¦¬ ë° í•´ì œ&lt;/strong&gt;í•˜ë©° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apply&lt;/code&gt; ëª…ë ¹ì–´ë¡œ êµì²´í•  ìˆ˜ ìˆì§€ë§Œ,
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;taint(êµì²´ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ˆí‚¹)&lt;/code&gt; ëª…ë ¹ì–´ë¡œ êµì²´í•˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;untaint(êµì²´ ë¦¬ì†ŒìŠ¤ ë§ˆí‚¹ í•´ì œ)&lt;/code&gt; ëª…ë ¹ì–´ë¡œ êµì²´í•  í•„ìš”ê°€ ì—†ë‹¤ê³  ëª…ë ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê·¸ëŸ¬ë‚˜ ìœ„ì™€ ê°™ì€ ì›Œí¬í”Œë¡œìš°ëŠ” í…Œë¼í¼ v0.15.2.ì—ì„œ deprecate ë˜ì—ˆê³ , &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-replace&lt;/code&gt; ì˜µì…˜ì„ ì œê³µí•˜ë©° ë” ì§ê´€ì ì¸ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•˜ê²Œ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;--replace&quot;&gt;ğŸŒ— -replace&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-replace&lt;/code&gt; ì˜µì…˜ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;taint&lt;/code&gt; ëª…ë ¹ì–´ì™€ ë™ì¼í•˜ê²Œ ì‘ìš©í•˜ë©°, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;untaint&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì¹  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
ì½”ë“œëŠ” ê·¸ëŒ€ë¡œì§€ë§Œ ë¦¬ì†ŒìŠ¤ ê°ì²´ê°€ ë³€ê²½ë˜ëŠ” Replace ëª…ë ¹ì–´ ì‚¬ìš©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform apply &lt;span class=&quot;nt&quot;&gt;-replace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;aws_instance.example[0]&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;êµì²´í•  ë¦¬ì†ŒìŠ¤ ì¸ìê°’ë¥¼ ì°¾ê¸° ìœ„í•´, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt; ëª…ë ¹ì–´ë¡œ targetì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/terraform/replace.png&quot; alt=&quot;replace&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ğŸ’¡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-replace&lt;/code&gt; ì˜µì…˜ ì—­ì‹œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--refresh-only&lt;/code&gt; ì˜µì…˜ê³¼ ë™ì¼í•˜ê²Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan&lt;/code&gt; ëª…ë ¹ì–´ì™€ í•¨ê»˜ ì ìš©í•˜ì—¬ ë³€ê²½ ì§€ì ì„ ë¯¸ë¦¬ íŒŒì•…í•˜ê³ 
ë³€ê²½ë˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê²€í† ë¥¼ í•˜ëŠ” ìŠµê´€ì„ ë“¤ì…ì‹œë‹¤!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outro&quot;&gt;Outro&lt;/h2&gt;

&lt;p&gt;Refreshì™€ Replace ë¹„ìŠ·í•˜ë©´ì„œë„ ì „í˜€ ë‹¤ë¥¸ ë‘ ëª…ë ¹ì–´ì˜ ë³€ì²œì‚¬ë¥¼ í™•ì¸í•˜ë©° ì¸í”„ë¼ì˜ ë™ì¼í•œ í˜•ìƒì„ ìœ ì§€í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ì–¸ê¸‰í•œ ë°©ë²• ì™¸ì—ë„ í˜•ìƒì„ ì¼ì¹˜ì‹œí‚¤ëŠ” ë°©ë²•ë“¤ì´ ì¡´ì¬í•˜ì§€ë§Œ, ìœ„ 2ê°€ì§€ ëª…ë ¹ì–´ë§Œ ì œëŒ€ë¡œ í™œìš©í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ì¸í”„ë¼ì˜ í˜•ìƒì´ ë‹¬ë¼ì§€ëŠ” ì‚¬íƒœë¥¼ ì˜ˆë°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
IaCì—ì„œëŠ” í•­ìƒ í˜•ìƒì„ ë³€ê²½í•˜ê¸° ì „, ë³€ê²½ë˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê²€í† ë¥¼ í•˜ëŠ” ìŠµê´€ì´ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ê°•ì¡°í•˜ë©° ì´ë²ˆ 3í¸ì„ ë§ˆì¹©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ í…Œë¼í¼ ë” ìµìˆ™í•˜ê²Œ Refresh &amp;amp; Replace í¸ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ ì£¼ì„¸ìš”! ğŸ˜ƒ&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Tips&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips1&quot;&gt;Module &amp;amp; Output&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips2&quot;&gt;Data &amp;amp; Index&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips3&quot;&gt;Refresh &amp;amp; Replace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips4&quot;&gt;Move (Refactoring)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips5&quot;&gt;Import&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraform ë” ìµìˆ™í•˜ê²Œ 3 - Refresh &amp;amp; Replace</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Terraform Tips 2 - Data &amp;amp; Index</title>
      <link href="https://heuristicwave.github.io/TerraformTips2" rel="alternate" type="text/html" title="Terraform Tips 2 - Data &amp; Index" />
      <published>2022-01-02T00:00:00+00:00</published>
      <updated>2022-01-02T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/TerraformTips2</id>
      <content type="html" xml:base="https://heuristicwave.github.io/TerraformTips2">&lt;p&gt;Terraform ë” ìµìˆ™í•˜ê²Œ 2 - Data &amp;amp; Index &lt;br /&gt;
AWS ë¦¬ì†ŒìŠ¤ë¡œ ì•Œì•„ë³´ëŠ” terraform Data í™œìš© íŒ&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì€ Tipì´ë¼ í•˜ê¸°ì—ëŠ” ë¶€ë„ëŸ¬ìš´ ì‚¬ì†Œí•œ ì§€ì‹ì´ì§€ë§Œ, ì œê°€ ìì£¼ ìŠì–´ë²„ë¦¬ëŠ” ë‚´ìš©ì´ë¼ ê¸€ë¡œ ë‚¨ê¸°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. &lt;strong&gt;Terraform Data&lt;/strong&gt;ë¥¼ ì˜ í™œìš©í•˜ë©´ ë””ìŠ¤í¬ ì´ë¯¸ì§€, ì½”ë“œë¡œ ì •ì˜í•œ ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ ë° í´ë¼ìš°ë“œ ê³µê¸‰ì APIì—ì„œ ê°€ì ¸ì˜¨ ì •ë³´ë“¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ëª¨ë“  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Data Sources&lt;/code&gt;ê°€ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì¡°íšŒí•  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ì§€ë§Œ, ë§‰ìƒ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë©´ ì´ëŸ° ì €ëŸ° ë¬¸ì œë“¤ì„ ë§Œë‚˜ê²Œ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê³µì‹ë¬¸ì„œ(&lt;a href=&quot;https://learn.hashicorp.com/tutorials/terraform/data-sources&quot;&gt;Tutorial : Query Data Sources&lt;/a&gt;)ì—ì„œë„ Data í™œìš©ë°©ë²•ì„ ë°°ìš¸ ìˆ˜ ìˆì§€ë§Œ,
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” 3ê°€ì§€ ì˜ˆì œì™€ í•¨ê»˜ ë¦¬ì†ŒìŠ¤ë¥¼ Query í•˜ëŠ” ë°©ë²•ì„ ë°°ì›Œ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;query-ami&quot;&gt;Query AMI&lt;/h2&gt;

&lt;p&gt;AWSì˜ ìµœì‹  AMIëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´, í•­ìƒ ìµœì‹  AMIë¥¼ ì°¸ì¡°í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ”ë° ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;data &lt;span class=&quot;s2&quot;&gt;&quot;aws_ami&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;amazon_linux&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  most_recent &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true

  &lt;/span&gt;owners &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;amazon&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  filter &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;
    values &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;amzn2-ami-kernel-*-hvm-*-x86_64-gp2&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

output &lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  value &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; data.aws_ami.amazon_linux.id
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;owners&lt;/code&gt; ê°’ì„ ì¡°ì •í•˜ë©° ì–´ë–¤ ì´ë¯¸ì§€ë“ ì§€ id ê°’(output)ì„ ì–»ì–´ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ ECSì˜ Optimized AMIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ filter ê°’ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;values = [â€œamzn2-ami-ecs-hvm-*-x86_64-ebsâ€]&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ECSì™€ ë‹¬ë¦¬ EKSëŠ” AMI ëª…ëª… ê·œì¹™ì´ ì•½ê°„ ë‹¬ë¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter&lt;/code&gt; ê¸°ëŠ¥ì„ í™œìš©í•´ì•¼, ì¡°ê±´ì— ë§ëŠ” Optimized ì´ë¯¸ì§€ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
EKS ì´ë¯¸ì§€ì˜ ê²½ìš° ëª¨ë“  ì´ë¯¸ì§€ì˜ ì²« ë¬¸ìì—´ì´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;amazon-eks-&lt;/code&gt;ìœ¼ë¡œ ì‹œì‘í•˜ê¸° ë•Œë¬¸ì—, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*&lt;/code&gt;ë¥¼ í•¨ê»˜ ë„£ì–´ Optimized AMIë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;data &lt;span class=&quot;s2&quot;&gt;&quot;aws_ami&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;amazon_linux_eks&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  most_recent &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true

  &lt;/span&gt;owners &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;amazon&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  filter &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;
    values &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;amazon-eks-*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  filter &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;architecture&quot;&lt;/span&gt;
    values &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;x86_64&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ê·¸ëŸ¬ë‚˜ ìœ„ Queryì˜ ê²°ê³¼ ê°’ì„ &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/eks-optimized-ami.html&quot;&gt;ê³µì‹ ë¬¸ì„œ&lt;/a&gt;ì— ê¸°ì¬ëœ AMI IDì™€ ë¹„êµí•´ ë³´ë©´,
&lt;strong&gt;x86&lt;/strong&gt; IDê°€ ì•„ë‹Œ, &lt;strong&gt;x86 ê°€ì†&lt;/strong&gt; ID ê°’ê³¼ ì¼ì¹˜í•œ ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.
ë¬¸ì„œì— ê¸°ì¬ëœ &lt;strong&gt;x86 ê°€ì†&lt;/strong&gt;ì€ gpuê°€ ì‚¬ìš© ê°€ëŠ¥í•œ Optimized AMIì…ë‹ˆë‹¤. gpuë¥¼ ì‚¬ìš©í•˜ëŠ” ë…¸ë“œì˜ ëª…ëª… ê·œì¹™ì´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;amazon-eks-gpu&lt;/code&gt;ë¡œ ì‹œì‘í•˜ê¸° ë•Œë¬¸ì— ìœ„ filter ì¡°ê±´ìœ¼ë¡œëŠ” gpu ë…¸ë“œê°€ ì¡°íšŒë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê·¸ë ‡ë‹¤ë©´ ì¼ë°˜ x86 ë…¸ë“œëŠ” ì–´ë–»ê²Œ ì¡°íšŒí•´ì•¼ í• ê¹Œìš”? ğŸ§ ì–´ëŠ ë¬¸ì„œì—ë„ ê¸°ì¬ë˜ì–´ ìˆì§€ ì•Šì§€ë§Œ,
ëŒ€ëµì ì¸ ëª…ëª… ê·œì¹™ì„ ìœ ì¶”í•˜ì—¬ ë³´ë‹ˆ ì¼ë°˜ EKS ë…¸ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•„í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;values = [â€œamazon-eks-node-1.22-*â€]&lt;/p&gt;

  &lt;p&gt;value ê°’ì˜ &lt;em&gt;prefix&lt;/em&gt; ê·œì¹™ì„ ë³´ë‹ˆ EKSì˜ ë²„ì „ë„ &lt;em&gt;prefix&lt;/em&gt; ì•ˆì— í¬í•¨ë˜ì–´, &lt;br /&gt;
ì´ ê°’ì„ ì‘ìš©í•˜ë©´ ë‹¤ì–‘í•œ ë²„ì „ì˜ EKS Optimized AMIë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì¶”ì¸¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ì´ì™¸ì—ë„ ë¦¬ì „ë§ˆë‹¤ ë‹¤ë¥¸ Optimized AMIëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt;ì—ëŠ” ëª…ì‹œí•˜ì§€ ì•Šì•˜ì§€ë§Œ, &lt;strong&gt;Providerì— ëª…ì‹œí•œ ë¦¬ì „ì— ì¢…ì†ì„±&lt;/strong&gt;ì„ ê°–ê²Œ ë©ë‹ˆë‹¤.
ë˜ í•˜ë‚˜ì˜ íŒì„ ë“œë¦¬ìë©´, ë§Œì•½ Filterì—ì„œ ì§€ì›í•˜ì§€ ì•ŠëŠ” ëª…ëª… ê·œì¹™ì„ ê°€ì§„ AMIë¼ë©´ ì •ê·œì‹ìœ¼ë¡œë„ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤!&lt;/p&gt;

&lt;p&gt;ì—¬ê¸°ê¹Œì§€ ì œê°€ ìì£¼ ì‚¬ìš©í•˜ëŠ” ë‹¤ì–‘í•œ AMI IDë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ì œ ì–´ë–¤ AMIë¼ë„ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ê² ì£ ? ğŸ˜&lt;/p&gt;

&lt;h2 id=&quot;query-az&quot;&gt;Query AZ&lt;/h2&gt;

&lt;p&gt;AWSì˜ ë¦¬ì „ë§ˆë‹¤ ì‚¬ìš©ê°€ëŠ¥í•œ azê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, ì¡°ê¸ˆ ë” ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì½”ë“œë¥¼ ì‚¬ìš©í•´ ì‚¬ìš©ê°€ëŠ¥í•œ azë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
ì´í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data.&amp;lt;NAME&amp;gt;.&amp;lt;ATTRIBUTE&amp;gt;.names&lt;/code&gt; ë¡œ ì‚¬ìš©ê°€ëŠ¥í•œ az ê°’ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;data &lt;span class=&quot;s2&quot;&gt;&quot;aws_availability_zones&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;available&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;available&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;output &lt;span class=&quot;s2&quot;&gt;&quot;azs&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
 value &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; data.aws_availability_zones.available.names
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;names&lt;/code&gt;ì—ëŠ” ì‚¬ìš©ê°€ëŠ¥í•œ azê°€ ë°°ì—´ í˜•íƒœë¡œ ë“¤ì–´ê°€ ìˆì–´, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;names[0]&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;names[1]&lt;/code&gt;ê³¼ ê°™ì´ Index ê°’ìœ¼ë¡œ íŠ¹ì • ê°’ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜, ëª¨ë“  dataê°€ Index ê°’ì„ ê°€ì§€ê³  ìˆëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;query-vpc_id&quot;&gt;Query vpc_id&lt;/h2&gt;

&lt;p&gt;ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì™€ AWS ì†”ë£¨ì…˜ë“¤ì„ ì—°ê³„í•˜ê¸° ìœ„í•´ì„œëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vpc_id&lt;/code&gt; ê°’ì´ í•„ìˆ˜ì ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.
vpcì˜ idë¥¼ êµ¬í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ idë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
(tags ê°’ì„ í™œìš©í•´ ì¼ì¢…ì˜ í•„í„°ë§ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.)&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;data &lt;span class=&quot;s2&quot;&gt;&quot;aws_vpcs&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;vpcs&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    tags &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        Name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; var.vpc_name
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

output &lt;span class=&quot;s2&quot;&gt;&quot;vpc_id&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    value &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; data.aws_vpcs.vpcs.ids
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìœ„ ì½”ë“œë¡œ ë‹¤ìŒê³¼ ê°™ì´ Output ê°’ì„ ì–»ì„ ìˆ˜ ìˆì§€ë§Œ, í•˜ë‚˜ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;az&lt;/code&gt; ê°’ì„ ì–»ì„ë•Œì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ids[0]&lt;/code&gt; í˜•ì‹ìœ¼ë¡œ ê°’ì„ ì¡°íšŒí•˜ë ¤ í•˜ë©´,
â€œThis value does not have any indices.â€ ë¼ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì¶œë ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Changes to Outputs:
  + vpc_id &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
      + &lt;span class=&quot;s2&quot;&gt;&quot;vpc-0x1234567890&quot;&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë„ëŒ€ì²´ ë¬´ì—‡ì´ ì˜ëª»ëœ ê²ƒì¼ê¹Œìš”? azì™€ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ì ‘ê·¼í–ˆì§€ë§Œ, ì™œ ì§€ì›í•˜ì§€ ì•ŠëŠ”ì§€ëŠ” ì•„ì§ê¹Œì§€ë„ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤â€¦
ëˆ„êµ¬ ì•„ì‹œëŠ” ë¶„ì´ ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì„¸ìš”.&lt;/p&gt;

&lt;h3 id=&quot;countë¡œ-index-ë¶€ì—¬í•˜ê¸°&quot;&gt;countë¡œ index ë¶€ì—¬í•˜ê¸°&lt;/h3&gt;

&lt;p&gt;ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” azë¥¼ ê²€ìƒ‰í•  ë•Œë³´ë‹¤ëŠ” ë¶ˆí¸í•˜ì§€ë§Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;count&lt;/code&gt;ë¥¼ ì‚¬ìš©í•´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;data &lt;span class=&quot;s2&quot;&gt;&quot;aws_vpc&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;target&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  count &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; length&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;data.aws_vpcs.vpcs.ids&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; tolist&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;data.aws_vpcs.vpcs.ids&lt;span class=&quot;o&quot;&gt;)[&lt;/span&gt;count.index]
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# sample code using vpc_id&lt;/span&gt;
resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_lb_target_group&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sample_resource&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  count &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; length&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;data.aws_vpcs.vpcs.ids&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;# Skip Config&lt;/span&gt;
  vpc_id      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; data.aws_vpc.target[count.index].id
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws_vpcs&lt;/code&gt;ê°€ ì•„ë‹Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws_vpc&lt;/code&gt;ë¥¼ ì¶”ê°€í•˜ê³  index ë¥¼ ë¶€ì—¬í•˜ê¸° ìœ„í•œ ë‚´ì¥ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•´ indexë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.
ì´í›„, ë¦¬ì†ŒìŠ¤ì—ì„œ data ê°’ë“¤ì„ ì‹ë³„í•˜ê¸° ìœ„í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;count&lt;/code&gt;ë¥¼ ê¸°ì…í•˜ê³  ìœ„ì™€ ê°™ì´ index ê°’ìœ¼ë¡œ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outro&quot;&gt;Outro&lt;/h2&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ Dataë¥¼ í™œìš©í•´ ê°ì¢… ë¦¬ì†ŒìŠ¤ë“¤ì„ ê²€ìƒ‰í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vpc_id&lt;/code&gt;ë„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;az&lt;/code&gt;ì™€ ê°™ì´ ë³„ë„ì˜ index ê³¼ì • ì—†ì´,
ê°„í¸í•œ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. (ì œê°€ ì•„ì§ ë°©ë²•ì„ ëª¨ë¥´ëŠ” ê²ƒì¼ ìˆ˜ë„ ìˆì–´ìš”!)&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ í…Œë¼í¼ ë” ìµìˆ™í•˜ê²Œ Data &amp;amp; Index í¸ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ ì£¼ì„¸ìš”! ğŸ˜ƒ&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Tips&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips1&quot;&gt;Module &amp;amp; Output&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips2&quot;&gt;Data &amp;amp; Index&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips3&quot;&gt;Refresh &amp;amp; Replace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips4&quot;&gt;Move (Refactoring)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips5&quot;&gt;Import&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraform ë” ìµìˆ™í•˜ê²Œ 2 - Data &amp;amp; Index AWS ë¦¬ì†ŒìŠ¤ë¡œ ì•Œì•„ë³´ëŠ” terraform Data í™œìš© íŒ</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Terraform Tips 1 - Module &amp;amp; Output</title>
      <link href="https://heuristicwave.github.io/TerraformTips1" rel="alternate" type="text/html" title="Terraform Tips 1 - Module &amp; Output" />
      <published>2022-01-01T00:00:00+00:00</published>
      <updated>2022-01-01T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/TerraformTips1</id>
      <content type="html" xml:base="https://heuristicwave.github.io/TerraformTips1">&lt;p&gt;Terraform ë” ìµìˆ™í•˜ê²Œ 1 - Module &amp;amp; Output &lt;br /&gt;
AWS ë¦¬ì†ŒìŠ¤ë¡œ ì•Œì•„ë³´ëŠ” terraform Module ì—°ê³„ íŒ&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Terraform Module&lt;/strong&gt;ì„ ì˜ í™œìš©í•˜ë©´ ë³¸ì¸ì´ ì›í•˜ëŠ” ëŒ€ë¡œ ì¸í”„ë¼ë¥¼ ë ˆê³ ì²˜ëŸ¼ ì¡°ë¦½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë ˆê³ ì²˜ëŸ¼ ì¸í”„ë¼ë¥¼ ì¡°ë¦½í•˜ê¸° ìœ„í•´ì„œëŠ” ëª¨ë“ˆ ê°„ì˜ ì—°ê³„ê°€ ì¤‘ìš”í•œë°ìš”,
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ëª¨ë“ˆ ë‚´ì— ì‘ì„±ëœ &lt;strong&gt;Output value&lt;/strong&gt;ë“¤ì„ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;í•´ë‹¹ í¬ìŠ¤íŒ…ì€ Outputì— ëŒ€í•œ ì´í•´ê°€ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ê¸°ìˆ í•˜ì˜€ìœ¼ë¯€ë¡œ, Outputì— ëŒ€í•œ ì„¤ëª…ì´ í•„ìš”í•˜ì‹œë©´ ì•„ë˜ ë§í¬ë“¤ì„ ì°¸ê³ í•´ ì£¼ì„¸ìš”!&lt;/p&gt;

&lt;p&gt;ğŸ¥² ì‚¬ì‹¤, ì•„ë˜ ë¬¸ì„œë³´ë‹¤ ë” ì˜ ì„¤ëª…í•  ìì‹ ì´ ì—†ì–´ì„œâ€¦ ì–¸ì œë‚˜ ê°€ì¥ ì¢‹ì€ êµì¬ëŠ” ê³µì‹ ë¬¸ì„œì…ë‹ˆë‹¤!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.terraform.io/docs/language/values/outputs.html&quot;&gt;Terraform Docs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.hashicorp.com/tutorials/terraform/outputs&quot;&gt;Tutorial : Output Data from Terraform&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;output-command-option&quot;&gt;Output Command Option&lt;/h2&gt;

&lt;p&gt;Outputì€ terraform apply ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ê³  ë‚œ í›„, ë§¨ ë§ˆì§€ë§‰ì— Value ë“¤ì´ ë Œë”ë§ ë˜ì–´ ë‚˜ì˜µë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜ í…Œë¼í¼ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ì¤‘ê°„ì¤‘ê°„ ì¸í”„ë¼ì˜ value ê°’ë“¤ì´ í•„ìš”í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê·¸ëŸ´ ë•Œ, outputì´ ì •ì˜ëœ ìƒí™©ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform output {label}&lt;/code&gt; ëª…ë ¹ì–´ë¡œ Ouput ê°’ì„ í™•ì¸í•©ë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-raw&lt;/code&gt; ì˜µì…˜ì„ í•¨ê»˜ ì£¼ë©´ ë¬¸ìì—´ í˜•íƒœê°€ ì•„ë‹Œ rawí•œ í…ìŠ¤íŠ¸ ê°’ë§Œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform output &lt;span class=&quot;nt&quot;&gt;-raw&lt;/span&gt; security_group_id
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;accessing-child-module-outputs&quot;&gt;Accessing Child Module Outputs&lt;/h2&gt;

&lt;p&gt;í•˜ìœ„ ëª¨ë“ˆì˜ ì•„ì›ƒí’‹ì— ì ‘ê·¼í•  ê²½ìš°ë„ ì¢…ì¢… ìˆëŠ”ë°ìš”, ì´ë•ŒëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;module.&amp;lt;ëª¨ë“ˆ ëª…&amp;gt;.&amp;lt;Output ëª…&amp;gt;&lt;/code&gt; ì´ëŸ° í˜•ì‹ìœ¼ë¡œ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
í•˜ìœ„ ëª¨ë“ˆ ì¶œë ¥ê°’ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´, ëª¨ë“ˆê³¼ ëª¨ë“ˆì€ ì—°ê³„í•˜ëŠ” ë°©ë²•ì´ê¸°ì— ì•„ë˜ ì˜ˆì‹œì—ì„œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;module &lt;span class=&quot;s2&quot;&gt;&quot;vpc&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;terraform-aws-modules/vpc/aws&quot;&lt;/span&gt;
  name   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sample_vpc&quot;&lt;/span&gt;

  cidr &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;10.10.0.0/16&quot;&lt;/span&gt;

  azs            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;us-west-2a&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  public_subnets &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;10.10.1.0/24&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  tags &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    Owner       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;me&quot;&lt;/span&gt;
    Environment &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;stage&quot;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìœ„ì™€ ê°™ì€ vpc ëª¨ë“ˆì€ security group ëª¨ë“ˆê³¼ ê±°ì˜ ë‹¨ì§ ìˆ˜ì¤€ìœ¼ë¡œ í•¨ê»˜ ì›€ì§ì´ëŠ”ë°ìš”,
security group ëª¨ë“ˆì„ í™œìš©í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vpc_id&lt;/code&gt; ê°’ì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ ê²½ìš°, vpcë¥¼ ë¨¼ì € ìƒì„±í•˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vpc_id&lt;/code&gt; ê°’ì„ ì•Œì•„ë‚´ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ëª¨ë“ˆì„ ì—°ê³„í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;module &lt;span class=&quot;s2&quot;&gt;&quot;security_group&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;terraform-aws-modules/security-group/aws&quot;&lt;/span&gt;
  name        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ssh&quot;&lt;/span&gt;
  description &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ssh from workstation&quot;&lt;/span&gt;
  vpc_id      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; module.vpc.vpc_id

  ingress_cidr_blocks &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0/0&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  ingress_rules       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ssh-tcp&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;find-module-output-label&quot;&gt;Find Module Output Label&lt;/h2&gt;

&lt;p&gt;ë°©ê¸ˆ ì „, ëª¨ë“ˆì„ ì—°ê³„í•˜ëŠ” ë°©ë²•ì„ ë°°ì›Œ ë³´ì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ°ë°, ëª¨ë“ˆì„ ì—°ê³„í•˜ê¸° ìœ„í•´ì„œëŠ” ë¯¸ë¦¬ ì‚¬ì „ì— ì‘ì„±ëœ ëª¨ë“ˆì˜ Output Labelì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ìš°ì„  ì—ë””í„°ì˜ Explorer íƒ­ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.terraform&lt;/code&gt; í´ë”ë¥¼ ì—´ì–´ë´…ì‹œë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/module.png&quot; alt=&quot;module.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;applyë¥¼ ì ìš©í•œ &lt;em&gt;security-group, vpc&lt;/em&gt; ëª¨ë“ˆì´ ë‚´ ë¡œì»¬ ë¨¸ì‹ ì— ìˆ¨ì–´ ìˆìŠµë‹ˆë‹¤.
í•´ë‹¹ ëª¨ë“ˆ í´ë” ì•ˆì— ë“¤ì–´ê°€ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;outputs.tf&lt;/code&gt; ê°€ ì •ì˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ Label ê°’ì„ ì–»ì–´ì˜¤ë©´ ë©ë‹ˆë‹¤!&lt;/p&gt;

&lt;h3 id=&quot;example&quot;&gt;Example&lt;/h3&gt;

&lt;p&gt;ìƒí™© : VPC ëª¨ë“ˆì„ ì‚¬ìš©í•´ VPCì™€ ì„œë¸Œë„·ì„ êµ¬ì¶•í•œ ìƒí™©ì—ì„œ, EFSë¥¼ ê° ì„œë¸Œë„·ì—ì„œ ì‚¬ìš©í•˜ë ¤ê³  í•©ë‹ˆë‹¤.
EFSì—ì„œ ëª¨ë“ˆë¡œ ìƒì„±í•œ Subnetsì„ ì–´ë–»ê²Œ ì°¸ì¡°í• ê¹Œìš”?&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;ğŸ– ì •ë‹µ ë³´ê¸°&lt;/summary&gt;

  &lt;p&gt;ìœ„ì—ì„œ ì–¸ê¸‰í•œëŒ€ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;modules/vpc/output.tf&lt;/code&gt; ì—ì„œ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ Labelì„ í™•ì¸í•´ë³´ë©´,
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;private_subnets&lt;/code&gt; ì´ë¼ ê¸°ì¬ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í™œìš©í•´ ì•„ë˜ì™€ ê°™ì´ ëª¨ë“ˆì„ ì°¸ì¡° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_efs_mount_target&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;mount&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  count &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; length&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;module.vpc.private_subnets&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

  file_system_id &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_efs_file_system.foo.id
  subnet_id      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; module.vpc.private_subnets[count.index]
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outro&quot;&gt;Outro&lt;/h2&gt;

&lt;p&gt;ì´ë ‡ê²Œ Moduleì˜ Output ê°’ì„ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œê²Œ ë˜ë‹ˆ, í…Œë¼í¼ ëª¨ë“ˆ ì¡°ë¦½ì— ëŒ€í•œ ìì‹ ê°ì´ ìƒê²¼ìŠµë‹ˆë‹¤. 
ì•ìœ¼ë¡œë„ í…Œë¼í¼ì— ë” ìµìˆ™í•˜ì§€ê¸° ìœ„í•œ ë°©ë²•ë“¤ì„ ì‹œë¦¬ì¦ˆë¡œ ì—°ì¬í•  ê³„íšì¸ë°, ì–¸ì œ ëë‚ ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. ğŸ˜‘&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ í…Œë¼í¼ ë” ìµìˆ™í•˜ê²Œ Module &amp;amp; Output í¸ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ ì£¼ì„¸ìš”! ğŸ˜ƒ&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Tips&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips1&quot;&gt;Module &amp;amp; Output&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips2&quot;&gt;Data &amp;amp; Index&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips3&quot;&gt;Refresh &amp;amp; Replace&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips4&quot;&gt;Move (Refactoring)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./TerraformTips5&quot;&gt;Import&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraform ë” ìµìˆ™í•˜ê²Œ 1 - Module &amp;amp; Output AWS ë¦¬ì†ŒìŠ¤ë¡œ ì•Œì•„ë³´ëŠ” terraform Module ì—°ê³„ íŒ</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">ECR CodePipeline with Terraform â…¢</title>
      <link href="https://heuristicwave.github.io/CodePipeline" rel="alternate" type="text/html" title="ECR CodePipeline with Terraform â…¢" />
      <published>2021-04-09T00:00:00+00:00</published>
      <updated>2021-04-09T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/CodePipeline</id>
      <content type="html" xml:base="https://heuristicwave.github.io/CodePipeline">&lt;p&gt;Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 3 (CodePipeline)&lt;/p&gt;

&lt;h1 id=&quot;preview&quot;&gt;Preview&lt;/h1&gt;

&lt;p&gt;3í¸ì—ì„œëŠ” CodePipelineì„ ìƒì„±í•˜ê³  IAM ì •ì±…ê³¼ ì—­í• ì„ ë¶€ì—¬í•˜ëŠ” ë²•ì„ ë°°ì›Œë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codepipeline&quot;&gt;ë¬¸ì„œ&lt;/a&gt;ë¥¼ í™•ì¸í•˜ë©´ artifactê°€ ë‹´ê¸°ëŠ” ë²„í‚·, pipelineì„ ìƒì„±í•˜ëŠ” ë¦¬ì†ŒìŠ¤, ê´€ë ¨ëœ IAM Roleê³¼ Policyê°€ ë³´ì…ë‹ˆë‹¤.
í…Œë¼í¼ì€ ì„ ì–¸í˜• ì–¸ì–´ì´ë¯€ë¡œ Roleê³¼ Resourceì˜ ì‘ì„± ìˆœì„œê°€ ë°”ë€Œì–´ë„ ìƒê´€ì´ ì—†ì§€ë§Œ, ì½˜ì†”ì—ì„œ ì‘ì—…í•  ê²½ìš° Roleì„ ë¨¼ì € ì‘ì„±í•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ë‹ˆ 3í¸ì—ì„œëŠ” IAMì„ ë¨¼ì € ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;iam-role&quot;&gt;IAM Role&lt;/h3&gt;
&lt;p&gt;ì•„ë˜ Roleì„ ë°©ê¸ˆì „ ìƒì„±í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codepipeline.tf&lt;/code&gt;ì— ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_iam_role&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;codepipeline_role&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;terraform-codepipeline&quot;&lt;/span&gt;
  assume_role_policy &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;codepipeline.amazonaws.com&quot;
      },
      &quot;Effect&quot;: &quot;Allow&quot;
    }
  ]
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iam-policy&quot;&gt;IAM Policy&lt;/h3&gt;
&lt;p&gt;ë³¸ë˜ í•„ìš”í•œ ì •ì±…ë§Œì„ ê³¨ë¼ &lt;a href=&quot;https://awspolicygen.s3.amazonaws.com/policygen.html&quot;&gt;ì •ì±… ìƒì„±ê¸°&lt;/a&gt;ì—ì„œ ìƒìƒëœ ì •ì±…ì„ í™œìš©í•˜ëŠ” ë°©ë²•ì´ ìˆì§€ë§Œ, ì–´ë–¤ ì •ì±…ì´ í•„ìš”í•œì§€ í•œë²ˆì— ë§ì¶”ê¸°ëŠ” ë„ˆë¬´ ì–´ë µìŠµë‹ˆë‹¤.
(ì €ì˜ ê²½ìš° ì¸í„°ë„·ì—ì„œ íƒ€ì¸ì´ ì‘ì„±í•œ ì •ì±…ê³¼ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë§ì•„ê°€ë©° ì •ì±…ì„ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤ ğŸ˜…)&lt;br /&gt;
â• ì•„ë˜ Policyë¥¼ ë°©ê¸ˆì „ ìƒì„±í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codepipeline.tf&lt;/code&gt;ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &quot;aws_iam_policy&quot; &quot;codepipeline_policy&quot; {
  description = &quot;Codepipeline Execution Policy&quot;
  policy      = &amp;lt;&amp;lt;EOF
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: [
        &quot;s3:GetObject&quot;, &quot;s3:GetObjectVersion&quot;, &quot;s3:PutObject&quot;,
        &quot;s3:GetBucketVersioning&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;${aws_s3_bucket.artifact_bucket.arn}/*&quot;
    },
    {
      &quot;Action&quot; : [
        &quot;codebuild:StartBuild&quot;, &quot;codebuild:BatchGetBuilds&quot;,
        &quot;iam:PassRole&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;*&quot;
    },
    {
      &quot;Action&quot; : [
        &quot;codecommit:CancelUploadArchive&quot;,
        &quot;codecommit:GetBranch&quot;,
        &quot;codecommit:GetCommit&quot;,
        &quot;codecommit:GetUploadArchiveStatus&quot;,
        &quot;codecommit:UploadArchive&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;${aws_codecommit_repository.test.arn}&quot;
    }
  ]
}
EOF
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ğŸš© ì´ì–´ì„œ ìƒì„±í•œ &lt;strong&gt;Policyë¥¼ Roleì— ë¶€ì—¬&lt;/strong&gt;í•©ë‹ˆë‹¤. ì´ê²ƒ ì—­ì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_iam_role_policy_attachment&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;codepipeline-attach&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  role       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_iam_role.codepipeline_role.name
  policy_arn &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_iam_policy.codepipeline_policy.arn
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;codepipeline&quot;&gt;CodePipeline&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws_codepipeline&lt;/code&gt;ë¦¬ì†ŒìŠ¤ì˜ configì—ëŠ” artifact storeì™€ ì•”í˜¸í™” í‚¤, Source-Build-Deployë¡œ ì´ì–´ì§€ëŠ” ê° Stageê°€ ì„ ì–¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ë¦¬ì†ŒìŠ¤ ì•ˆì— ê¸°ì¬ëœ ì„¤ì •ë“¤ì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” deploy stageì™€ ì•”í˜¸í™” configëŠ” ì œì™¸í•˜ê³  ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_codepipeline&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;pipeline&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  name     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.source_repo_name&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.source_repo_branch&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-Pipeline&quot;&lt;/span&gt;
  role_arn &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_iam_role.codepipeline_role.arn
  artifact_store &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_s3_bucket.artifact_bucket.bucket
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;S3&quot;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  stage &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Source&quot;&lt;/span&gt;
    action &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      name             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Source&quot;&lt;/span&gt;
      category         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Source&quot;&lt;/span&gt;
      owner            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;AWS&quot;&lt;/span&gt;
      version          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
      provider         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CodeCommit&quot;&lt;/span&gt;
      output_artifacts &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SourceOutput&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      run_order        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
      configuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        RepositoryName       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; var.source_repo_name
        BranchName           &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; var.source_repo_branch
        PollForSourceChanges &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  stage &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build&quot;&lt;/span&gt;
    action &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      name             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build&quot;&lt;/span&gt;
      category         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build&quot;&lt;/span&gt;
      owner            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;AWS&quot;&lt;/span&gt;
      version          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
      provider         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CodeBuild&quot;&lt;/span&gt;
      input_artifacts  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SourceOutput&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      output_artifacts &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;BuildOutput&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      run_order        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
      configuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        ProjectName &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_codebuild_project.codebuild.id
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;1í¸ì—ì„œ ì‘ì„±í•œ CodeCommitì„ Stageì˜ Source, 2í¸ì—ì„œ ì‘ì„±í•œ CodeBuildë¥¼ Buildë‹¨ê³„ ì§€ì •í–ˆìŠµë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply, plan&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì°¨ë¡€ë¡œ ë°˜ì˜í•´ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ì‘ì„±ëœ ì¸í”„ë¼ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ í†µí•´ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ terraform state list
aws_codebuild_project.codebuild
aws_codecommit_repository.test
aws_codepipeline.pipeline
aws_ecr_repository.image_repo
aws_iam_policy.codebuild_policy
aws_iam_policy.codepipeline_policy
aws_iam_role.codebuild_role
aws_iam_role.codepipeline_role
aws_iam_role_policy_attachment.codebuild-attach
aws_iam_role_policy_attachment.codepipeline-attach
aws_s3_bucket.artifact_bucket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://console.aws.amazon.com/codepipeline&quot;&gt;CodePipeline ì½˜ì†”&lt;/a&gt;ì—ì„œ í™•ì¸í•˜ë©´ ê¶Œí•œì´ ì—†ì–´ ì‹¤íŒ¨í•œ í™”ë©´ì´ ë‚˜ì˜¬ ê²ƒ ì…ë‹ˆë‹¤.
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë˜ ë‹¤ë¥¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;codepipeline-trigger&quot;&gt;CodePipeline Trigger&lt;/h2&gt;
&lt;p&gt;CodeCommitì—ì„œ ë°œìƒí•œ ì´ë²¤íŠ¸ê°€ CodePipelineìœ¼ë¡œ íŠ¸ë¦¬ê±°ë˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ ì •ì˜ëœ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;â• ì•„ë˜ ì½”ë“œë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codepipeline.tf&lt;/code&gt;ì— ì¶”ê°€í•˜ê³  ì¸í”„ë¼ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.&lt;/p&gt;
&lt;noscript&gt;
  &lt;pre&gt;resource &amp;quot;aws_iam_role&amp;quot; &amp;quot;trigger_role&amp;quot; {
  name               = &amp;quot;terraform-trigger&amp;quot;
  assume_role_policy = &amp;lt;&amp;lt;EOF
{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot;,
      &amp;quot;Principal&amp;quot;: {
        &amp;quot;Service&amp;quot;: &amp;quot;events.amazonaws.com&amp;quot;
      },
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Sid&amp;quot;: &amp;quot;&amp;quot;
    }
  ]
}
EOF
}

resource &amp;quot;aws_iam_policy&amp;quot; &amp;quot;trigger_policy&amp;quot; {
  description = &amp;quot;CodePipeline Trigger Execution Policy&amp;quot;
  policy      = &amp;lt;&amp;lt;EOF
{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;codepipeline:StartPipelineExecution&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;${aws_codepipeline.pipeline.arn}&amp;quot;
    }
  ]
}
EOF
}

resource &amp;quot;aws_iam_role_policy_attachment&amp;quot; &amp;quot;trigger-attach&amp;quot; {
  role       = aws_iam_role.trigger_role.name
  policy_arn = aws_iam_policy.trigger_policy.arn
}&lt;/pre&gt;
&lt;/noscript&gt;
&lt;script src=&quot;https://gist.github.com/heuristicwave/5b566b2cc70337501a4d60b71215930f.js&quot;&gt; &lt;/script&gt;

&lt;h2 id=&quot;result&quot;&gt;Result&lt;/h2&gt;
&lt;p&gt;Trigger ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ì ìš©í•˜ê³  í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í™œìš©í•  ì•„ë¬´ Dockerfileì„ CodeCommitì— Pushí•©ë‹ˆë‹¤.
ë‹¤ì‹œ &lt;a href=&quot;https://console.aws.amazon.com/codepipeline&quot;&gt;CodePipeline ì½˜ì†”&lt;/a&gt;ì— ì ‘ì†í•´ ìš°ìƒë‹¨ì— ìœ„ì¹˜í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ë³€ê²½ì‚¬í•­ ë¦´ë¦¬ìŠ¤&lt;/code&gt;ë¥¼ ëˆ„ë¥´ë©´,
ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ ì½”ë“œ íŒŒì´í”„ë¼ì¸ì´ ì‘ë™í•˜ì—¬ ìš´ì˜ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/ecr_terraform_demo.png&quot; alt=&quot;terraform_demo&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ë§ˆì§€ë§‰ìœ¼ë¡œ, ë¹Œë“œëœ ECR ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ì•„ ë¡œì»¬ì—ì„œ ì‹¤í–‰ì‹œì¼œë³´ë©° ì •ìƒì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ECRì— ì˜¬ë¼ì˜¨ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í™˜ê²½ë³€ìˆ˜ ì„¸íŒ… ğŸ”¨
    &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tf_image_repo_url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;terraform output &lt;span class=&quot;nt&quot;&gt;-raw&lt;/span&gt; image_repo_url&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;AWSCLIë¡œ ECR ë¡œê·¸ì¸ (Regionëª… ì£¼ì˜!) ğŸ”‘
    &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aws ecr get-login-password &lt;span class=&quot;nt&quot;&gt;--region&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;YOUR_REGION&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; | docker login &lt;span class=&quot;nt&quot;&gt;--username&lt;/span&gt; AWS &lt;span class=&quot;nt&quot;&gt;--password-stdin&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tf_image_repo_url&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;ì´ë¯¸ì§€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Pull&lt;/code&gt; í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Run&lt;/code&gt; ëª…ë ¹ì–´ ì‹¤í–‰ ğŸ’»
    &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker pull &lt;span class=&quot;nv&quot;&gt;$tf_image_repo_url&lt;/span&gt;
docker run &lt;span class=&quot;nv&quot;&gt;$tf_image_repo_url&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ğŸµ Docker ì‹¤í–‰ í›„, Shellì—ì„œ &lt;em&gt;Hello, Go examples!&lt;/em&gt; ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì˜€ë‹¤ë©´ ì„±ê³µ!&lt;/p&gt;

&lt;h2 id=&quot;cleanup&quot;&gt;Cleanup&lt;/h2&gt;
&lt;p&gt;S3 bucketì€ ë¹ˆìƒíƒœì—¬ì•¼ ì œê±°ê°€ ê°€ëŠ¥í•˜ê¸°ì— &lt;a href=&quot;https://console.aws.amazon.com/s3/home&quot;&gt;S3 ì½˜ì†”&lt;/a&gt;ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ecr-pipeline&lt;/code&gt;ì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.
ì´ì–´ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destory&lt;/code&gt; ëª…ë ¹ì–´ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ íšŒìˆ˜í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ì´ 3í¸ì— ê±¸ì³ì„œ í…Œë¼í¼ìœ¼ë¡œ &lt;strong&gt;ìµœì†Œí•œì˜ ë¦¬ì†ŒìŠ¤&lt;/strong&gt;ë¡œ ECR Pipeline êµ¬ì¶•ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. (CloudWatch ê¸°ëŠ¥ì„ ì¶”ê°€í•´ CodePipelineì„ êµ¬ì¶•í•´ë³´ì„¸ìš” ğŸ‘)
í•´ë‹¹ ê³¼ì •ì„ í†µí•´ AWS ì¸í”„ë¼ ìƒì„±ë²•ê³¼, IAM í™œìš©ë²•, Variable, Output, tfvars ë“±ì„ í™œìš©í•´ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë²•ì„ ê³µë¶€í–ˆìŠµë‹ˆë‹¤.
ë‹¤ë¥¸ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ë²•ë„ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¬ ë°©ë²•ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šìœ¼ë‹ˆ, í•´ë‹¹ í¬ìŠ¤íŒ…ì´ ë„ì›€ì´ ë˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ğŸ˜&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./Packer&quot;&gt;Provision Infrastructure with Packer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 3 (CodePipeline)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">ECR CodePipeline with Terraform â…¡</title>
      <link href="https://heuristicwave.github.io/CodeBuild" rel="alternate" type="text/html" title="ECR CodePipeline with Terraform â…¡" />
      <published>2021-04-08T00:00:00+00:00</published>
      <updated>2021-04-08T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/CodeBuild</id>
      <content type="html" xml:base="https://heuristicwave.github.io/CodeBuild">&lt;p&gt;Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 2 (ECR, CodeBuild, IAM)&lt;/p&gt;

&lt;p&gt;2í¸ì—ì„œëŠ” &lt;strong&gt;ECR&lt;/strong&gt;ê³¼ &lt;strong&gt;CodeBuild&lt;/strong&gt;ë¥¼ ìƒì„±í•˜ê³  &lt;strong&gt;IAM ì—­í• , ì •ì±…ì„ ë¶€ì—¬&lt;/strong&gt;í•˜ëŠ” ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;ecr&quot;&gt;ECR&lt;/h2&gt;
&lt;p&gt;ECR ì—­ì‹œ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository&quot;&gt;ê³µì‹ ë¬¸ì„œ&lt;/a&gt;ì—ì„œ ì‚¬ìš©ë°©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
ê³µì‹ë¬¸ì„œì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;image_scanning_configuration&lt;/code&gt; configë¥¼ ì‚¬ìš©í•˜ë©´ ì·¨ì•½ì  ìŠ¤ìº”ì´ ê°€ëŠ¥í•˜ë‹¤ ì„¤ëª…ë˜ì–´ ìˆì§€ë§Œ, í•„ìš”í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì œì™¸í•˜ê² ìŠµë‹ˆë‹¤.
ë”ë¶ˆì–´, outputë„ í•¨ê»˜ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; ecr.tf
resource &quot;aws_ecr_repository&quot; &quot;image_repo&quot; {
  name                 = var.image_repo_name
  image_tag_mutability = &quot;MUTABLE&quot;
}

output &quot;image_repo_url&quot; {
  value = aws_ecr_repository.image_repo.repository_url
}

output &quot;image_repo_arn&quot; {
  value = aws_ecr_repository.image_repo.arn
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì´ì–´ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ecr.tf&lt;/code&gt;ì—ì„œ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ &lt;strong&gt;var.image_repo_name&lt;/strong&gt; ë¶€ë¶„ì´ ì‘ë™í•˜ë„ë¡ 1í¸ì—ì„œ ì‘ì„±í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;variables.tf&lt;/code&gt; ì•„ë˜ ê°’ì„ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;âœ… í¸ì˜ìƒ ì´ë²ˆ ë‹¨ê³„ì— í•„ìš”í•œ variableì„ í•¨ê»˜ í¬í•¨í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;variable &quot;image_repo_name&quot; {
  description = &quot;Image repo name&quot;
  type        = string
}

variable &quot;container_name&quot; {
  description = &quot;Container Name&quot;
  default     = &quot;my-container&quot;
}

variable &quot;source_repo_branch&quot; {
  description = &quot;Source repo branch&quot;
  type        = string
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ecr ì‘ì„±ì„ ì™„ë£Œí–‡ìœ¼ë‹ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan, apply&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì°¨ë¡€ë¡œ ì…ë ¥í•´ ì¸í”„ë¼ë¥¼ ìƒì„±í•˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ë‚˜ &lt;a href=&quot;https://console.aws.amazon.com/ecr/home&quot;&gt;ì½˜ì†”&lt;/a&gt;ì—ì„œ ìƒì„±ëœ ì¸í”„ë¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;codebuild&quot;&gt;CodeBuild&lt;/h2&gt;
&lt;p&gt;CodeBuildë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project&quot;&gt;Terraform ë„íë¨¼íŠ¸&lt;/a&gt;ì—ì„œ ì‚¬ìš©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
ê¸°ì¡´ê¹Œì§€ì˜ ì‘ì—…ê³¼ëŠ” ë‹¬ë¦¬ ìƒë‹¹íˆ ì–´ë ¤ì›Œ ë³´ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì“± í›ì–´ë³´ë©´ í¬ê²Œ 4ê°€ì§€(bucket, IAM Roleê³¼ Policy, Codebuild)ë¡œ ì •ë¦¬ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;bucket&quot;&gt;Bucket&lt;/h3&gt;
&lt;p&gt;ë„íë¨¼íŠ¸ì™€ ê°™ì´ ìš°ì„ ì ìœ¼ë¡œ S3ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. bucketì˜ ì´ë¦„ì€ ì„ íƒì´ì§€ë§Œ, ì—¬ëŸ¬ê°œì˜ ë²„í‚·ì„ ê°€ì§€ê³  ìˆëŠ” ì €ëŠ” ì‹ë³„ì„ ìœ„í•´ ì´ë¦„ì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; codebuild.tf
resource &quot;aws_s3_bucket&quot; &quot;artifact_bucket&quot; {
  bucket = &quot;ecr-pipeline&quot;
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iam-role&quot;&gt;IAM Role&lt;/h3&gt;
&lt;p&gt;ë„íë¨¼íŠ¸ë¥¼ ë”°ë¼ AssumeRoleì„ ì‚¬ìš©í•©ì‹œë‹¤. &lt;br /&gt;
â• S3ì„ ë§Œë“¤ë•Œ ì‚¬ìš©í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &quot;aws_iam_role&quot; &quot;codebuild_role&quot; {
  name = &quot;terraform-codebuild&quot;
  assume_role_policy = &amp;lt;&amp;lt;EOF
{
   &quot;Version&quot;: &quot;2012-10-17&quot;,
   &quot;Statement&quot;: [
      {
         &quot;Effect&quot;: &quot;Allow&quot;,
         &quot;Principal&quot;: {
            &quot;Service&quot;: &quot;codebuild.amazonaws.com&quot;
         },
         &quot;Action&quot;: &quot;sts:AssumeRole&quot;
      }
   ]
}
EOF
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iam-policy&quot;&gt;IAM Policy&lt;/h3&gt;
&lt;p&gt;ì •ì±…ì€ IAM ì½˜ì†”ì—ì„œ ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ ì •ì±…ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì•„ë˜ì™€ ê°™ì´ ì§ì ‘ ì‘ì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ë„íë¨¼íŠ¸ì—ì„œ EC2ì— ëŒ€í•œ ì •ì±…ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ìš°ë¦¬ëŠ” ECRì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì€ ì •ì±…ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;noscript&gt;
  &lt;pre&gt;resource &amp;quot;aws_iam_policy&amp;quot; &amp;quot;codebuild_policy&amp;quot; {
  description = &amp;quot;CodeBuild Execution Policy&amp;quot;
  policy      = &amp;lt;&amp;lt;EOF
{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;logs:CreateLogGroup&amp;quot;, &amp;quot;logs:CreateLogStream&amp;quot;, &amp;quot;logs:PutLogEvents&amp;quot;,
        &amp;quot;ecr:GetAuthorizationToken&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;*&amp;quot;
    },
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;s3:GetObject&amp;quot;, &amp;quot;s3:GetObjectVersion&amp;quot;, &amp;quot;s3:PutObject&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;${aws_s3_bucket.artifact_bucket.arn}/*&amp;quot;
    },
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;ecr:GetDownloadUrlForLayer&amp;quot;, &amp;quot;ecr:BatchGetImage&amp;quot;,
        &amp;quot;ecr:BatchCheckLayerAvailability&amp;quot;, &amp;quot;ecr:PutImage&amp;quot;,
        &amp;quot;ecr:InitiateLayerUpload&amp;quot;, &amp;quot;ecr:UploadLayerPart&amp;quot;,
        &amp;quot;ecr:CompleteLayerUpload&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;${aws_ecr_repository.image_repo.arn}&amp;quot;
    }
  ]
}
EOF
}&lt;/pre&gt;
&lt;/noscript&gt;
&lt;script src=&quot;https://gist.github.com/heuristicwave/09103b88af041153ccd206ec6d51b7c1.js&quot;&gt; &lt;/script&gt;

&lt;p&gt;20, 30ë¼ì¸ì—ì„œ ì•ì„œ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;${ì±„ì›€ì°¸ì¡°}&lt;/code&gt; ë¬¸ë²•ìœ¼ë¡œ ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ğŸš© ì´ì–´ì„œ ìƒì„±í•œ &lt;strong&gt;Policyë¥¼ Roleì— ë¶€ì—¬&lt;/strong&gt;í•©ë‹ˆë‹¤. ì´ê²ƒ ì—­ì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &quot;aws_iam_role_policy_attachment&quot; &quot;codebuild-attach&quot; {
  role       = aws_iam_role.codebuild_role.name
  policy_arn = aws_iam_policy.codebuild_policy.arn
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;codebuild-1&quot;&gt;CodeBuild&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project&quot;&gt;Terraform ë„íë¨¼íŠ¸&lt;/a&gt;ë¥¼ ë³´ì•„ë„ ì–´ë–»ê²Œ í•´ì•¼ ECRì— ì ìš©ì‹œí‚¬ ìˆ˜ ìˆëŠ”ì§€ ì•Œê¸° ì–´ë µìŠµë‹ˆë‹¤.
ìš°ì„  CodeBuildë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/codebuild/latest/userguide/sample-docker.html&quot;&gt;AWS docs&lt;/a&gt;ë¥¼ ì½ì–´ë´…ì‹œë‹¤.
ëŒ€ëµ ë¦¬ì†ŒìŠ¤ ì´ë¦„ì„ ì •í•˜ê³ , í™˜ê²½ì„ êµ¬ì„±í•˜ê³  ë¹Œë“œë¥¼ í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ì •ì˜í•´ì•¼ í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
CodeBuildê°€ ì •ì˜ëœ ì•„ë˜ ì½”ë“œë¥¼ í™œìš©í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;noscript&gt;
  &lt;pre&gt;resource &amp;quot;aws_codebuild_project&amp;quot; &amp;quot;codebuild&amp;quot; {
  name         = &amp;quot;codebuild-${var.source_repo_name}-${var.source_repo_branch}&amp;quot;
  service_role = aws_iam_role.codebuild_role.arn

  artifacts {
    type = &amp;quot;CODEPIPELINE&amp;quot;
  }
  
  environment {
    compute_type                = &amp;quot;BUILD_GENERAL1_MEDIUM&amp;quot;
    image                       = &amp;quot;aws/codebuild/standard:3.0&amp;quot;
    type                        = &amp;quot;LINUX_CONTAINER&amp;quot;
    privileged_mode             = true
    image_pull_credentials_type = &amp;quot;CODEBUILD&amp;quot;
    environment_variable {
      name  = &amp;quot;REPOSITORY_URI&amp;quot;
      value = aws_ecr_repository.image_repo.repository_url
    }
    environment_variable {
      name  = &amp;quot;AWS_DEFAULT_REGION&amp;quot;
      value = var.aws_region
    }
    environment_variable {
      name  = &amp;quot;CONTAINER_NAME&amp;quot;
      value = var.container_name
    }
  }
  source {
    type      = &amp;quot;CODEPIPELINE&amp;quot;
    buildspec = &amp;lt;&amp;lt;BUILDSPEC
${file(&amp;quot;buildspec.yml&amp;quot;)}
BUILDSPEC
  }
}&lt;/pre&gt;
&lt;/noscript&gt;
&lt;script src=&quot;https://gist.github.com/heuristicwave/2ebf79ce3cbdf4a87657b272f9e1d994.js&quot;&gt; &lt;/script&gt;

&lt;p&gt;31ë¼ì¸ì´ ì°¸ì¡°í•˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;buildspec.yml&lt;/code&gt;ì„ pre_build, build, post_buildì— ë§ì¶° ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; buildspec.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0.2&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;phases&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;install&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runtime-versions&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;pre_build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Logging in to Amazon ECR...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$(aws ecr get-login --region $AWS_DEFAULT_REGION --no-include-email)&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;COMMIT_HASH=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;IMAGE_TAG=${COMMIT_HASH:=latest}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Build started on `date`&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Building the Docker image...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker build -t $REPOSITORY_URI:latest .&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker tag $REPOSITORY_URI:latest $REPOSITORY_URI:$IMAGE_TAG&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;post_build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Build completed on `date`&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Pushing the Docker image...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker push $REPOSITORY_URI:latest&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker push $REPOSITORY_URI:$IMAGE_TAG&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Writing image definitions file...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;printf '[{&quot;name&quot;:&quot;%s&quot;,&quot;imageUri&quot;:&quot;%s&quot;}]' $CONTAINER_NAME $REPOSITORY_URI:$IMAGE_TAG &amp;gt; imagedefinitions.json&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;imagedefinitions.json&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;EOF&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ì‘ì„±ëœ ì¸í”„ë¼ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ í†µí•´ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ terraform state list
aws_codebuild_project.codebuild
aws_codecommit_repository.test
aws_ecr_repository.image_repo
aws_iam_policy.codebuild_policy
aws_iam_role.codebuild_role
aws_iam_role_policy_attachment.codebuild-attach
aws_s3_bucket.artifact_bucket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;details&gt;
  &lt;summary&gt;ìƒì„±í•œ ì¸í”„ë¼ê°€ ìœ„ì™€ ê°™ì§€ ì•Šì„ ê²½ìš°, ğŸ‘‰ Click&lt;/summary&gt;

  &lt;p&gt;ì‹¤ìˆ˜ë¡œ ì˜ë„ì¹˜ ì•Šì€ ì¸í”„ë¼ê°€ í”„ë¡œë¹„ì €ë‹ ë˜ì—ˆë‹¤ë©´ 2ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì› ìƒíƒœë¡œ ë³µêµ¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destroy&lt;/code&gt; ëª…ë ¹ì–´ë¡œ íŠ¹ì • ì¸í”„ë¼ë§Œ ë˜ëŒë¦¬ê±°ë‚˜ í”„ë¡œë¹„ì €ë‹ í•˜ê³ ì‹¶ì€ ê²½ìš°, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-target&lt;/code&gt; ì˜µì…˜ê³¼ í•¨ê»˜ resource ëª…ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. &lt;br /&gt;
&lt;em&gt;ì˜ˆì‹œ) terraform destory -target aws_vpc.main&lt;/em&gt;&lt;/li&gt;
    &lt;li&gt;ì˜ëª» ì‘ì„±í•œ ì½”ë“œë¥¼ ìˆ˜ì • í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ì—¬ ìµœì‹  ìƒíƒœì˜ ì¸í”„ë¼ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;/ol&gt;

&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./Packer&quot;&gt;Provision Infrastructure with Packer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 2 (ECR, CodeBuild, IAM)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">ECR CodePipeline with Terraform â… </title>
      <link href="https://heuristicwave.github.io/CodeCommit" rel="alternate" type="text/html" title="ECR CodePipeline with Terraform â… " />
      <published>2021-04-07T18:00:00+00:00</published>
      <updated>2021-04-07T18:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/CodeCommit</id>
      <content type="html" xml:base="https://heuristicwave.github.io/CodeCommit">&lt;p&gt;Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 1 (CodeCommit)&lt;/p&gt;

&lt;h1 id=&quot;overview&quot;&gt;Overview&lt;/h1&gt;

&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì»¤ë°‹ í›„, ë„ì»¤ì˜ ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ ë°°í¬í•˜ëŠ” ECR Pipelineì„ í…Œë¼í¼ìœ¼ë¡œ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.
AWSì—ì„œ ì €ì¥ì†Œ ì—­í• ì„ í•˜ëŠ” CodeCommit, ì½”ë“œë¥¼ ë¹Œë“œí•˜ëŠ” CodeBuild, íŒŒì´í”„ë¼ì¸ì„ ìë™í™” í•˜ëŠ” CodePipeline, ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ECRì„ í™œìš©í•´ êµ¬ì¶•í•©ë‹ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/CodePipeline.png&quot; alt=&quot;CodePipeline&quot; /&gt;
1í¸ì—ì„œëŠ” &lt;strong&gt;CodeCommit&lt;/strong&gt; êµ¬ì¶•ê³¼ &lt;strong&gt;terraformì˜ Output, Variables, tfvars&lt;/strong&gt; ë“±ì„ ë°°ì›Œ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ì¤€ë¹„-ì‘ì—…&quot;&gt;ì¤€ë¹„ ì‘ì—…&lt;/h2&gt;
&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì˜ ì‘ì—…ê³µê°„(~/terraform)ì„ ìƒì„±í•˜ê³  í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì•„ë˜ ì½”ë“œ ë¸”ëŸ­ì„ í„°ë¯¸ë„ì— ë³µì‚¬í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; provider.tf
provider &quot;aws&quot; {
  region  = var.aws_region
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì´í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform init&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ì„¸ìš”.&lt;/p&gt;

&lt;h2 id=&quot;codecommit&quot;&gt;CodeCommit&lt;/h2&gt;
&lt;p&gt;CodeCommitì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codecommit_repository&quot;&gt;Terraform ë„íë¨¼íŠ¸&lt;/a&gt;ì—ì„œ ì‚¬ìš©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
ë§í¬ì˜ Example Usageë¥¼ í™œìš©í•´ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì œ ë°©ì‹ëŒ€ë¡œì•„ë˜ ì½”ë“œë¥¼ í™œìš©í•´ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.
ë§í¬ì—ì„œ ì†Œê°œí•˜ëŠ” ì½”ë“œì™€ ë‹¤ë¥¸ ë¶€ë¶„ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;output&lt;/code&gt;ê³¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;variable&lt;/code&gt;ì˜ ì‚¬ìš© ì—¬ë¶€ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;âœ… ì•„ë˜ ì½”ë“œì™€ ë„íë¨¼íŠ¸ì˜ ì½”ë“œê°€ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ê¼­ í™•ì¸í•´ë³´ì„¸ìš”!&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; codecommit.tf
resource &quot;aws_codecommit_repository&quot; &quot;test&quot; {
  repository_name = var.source_repo_name
  description     = &quot;This is the Sample App Repository&quot;
}

output &quot;source_repo_clone_url_http&quot; {
  value = aws_codecommit_repository.test.clone_url_http
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Output&lt;/code&gt;ì€ í–¥í›„ cloneí•  ì›ê²© ì €ì¥ì†Œì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ ë„£ì–´ì¤ë‹ˆë‹¤. ë˜í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Variable&lt;/code&gt;ì„ ì‚¬ìš©í•´ ë³´ë‹¤ ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì¤€ë¹„ ì‘ì—…ì— ì •ì˜í•œ ë¦¬ì „ê³¼ CodeCommit Repo ì´ë¦„ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Variable&lt;/code&gt;ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; variables.tf
variable &quot;aws_region&quot; {
  description = &quot;The AWS region&quot;
  default     = &quot;ap-northeast-2&quot;
}

variable &quot;source_repo_name&quot; {
  description = &quot;Source repo name&quot;
  type        = string
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ìœ„ ì½”ë“œë¥¼ ë³µì‚¬í•œ í›„, terraform plan ëª…ë ¹ì–´ë¡œ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/plan.png&quot; alt=&quot;terraform plan&quot; /&gt;
ì•ì„œ ì‘ì„±í•œ variables.tfì˜ regionì€ default ê°’ì´ ìˆì§€ë§Œ, repositoryëŠ” variableì˜ í˜•ì‹ë§Œ ì •ì˜ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì¸í”„ë¼ë¥¼ ìƒì„±í•  ë•Œ í•„ìˆ˜ì ìœ¼ë¡œ ì´ë¦„ì„ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;âœ… variableì˜ inputê°’ì„ ìˆ˜ê¸°ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ í”¼í•˜ê³  ì‹¶ìœ¼ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tfvars&lt;/code&gt;ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í¸ì˜ìƒ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ê°’ë“¤ì„ ë¯¸ë¦¬ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; terraform.tfvars
aws_ecr=&quot;my-image&quot;
source_repo_name=&quot;my-pipeline&quot;
source_repo_branch=&quot;master&quot;
image_repo_name=&quot;my-pipeline&quot;
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tfvars&lt;/code&gt;ëŠ” ìœ„ì™€ ê°™ì´ ë³€ìˆ˜ì˜ ê°’ì„ ì§€ì •í•˜ê¸°ë„ í•˜ì§€ë§Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.env&lt;/code&gt;ì²˜ëŸ¼ &lt;strong&gt;ì™¸ë¶€ë¡œ ë…¸ì¶œí•˜ë©´ ì•ˆë˜ëŠ” ê°’ì„ ë„£ì–´ë‘ê³  gitì— ignoreì‹œì¼œ ì‚¬ìš©&lt;/strong&gt;í•˜ê¸°ë„ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ìœ„ ì‘ì—…ì„ ì§„í–‰ í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ë©´ â€œApply completeâ€ê³¼ í•¨ê»˜ Outputs ê°’ì´ ë‚˜ì˜µë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ ì´ì™¸ì—ë„, &lt;a href=&quot;https://console.aws.amazon.com/codecommit&quot;&gt;ì½˜ì†”&lt;/a&gt;ë¡œ ì´ë™í•˜ë©´ ìƒì„±ëœ ì¸í”„ë¼ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ìƒì„±ëœ ì›ê²©ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform output&lt;/code&gt;ì„ í™œìš©í•´ &lt;strong&gt;export í™˜ê²½ ë³€ìˆ˜&lt;/strong&gt;ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tf_source_repo_clone_url_http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;terraform output &lt;span class=&quot;nt&quot;&gt;-raw&lt;/span&gt; source_repo_clone_url_http&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tf_source_repo_clone_url_http&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# í™•ì¸&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;ìœˆë„ìš° í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë°©ë²•&lt;/strong&gt; &lt;br /&gt;
Powershell : &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$Env:Key=&quot;Value&quot;&lt;/code&gt; &lt;br /&gt;
CMD : &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set Key=&quot;Value&quot;&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;git-setting&quot;&gt;Git Setting&lt;/h2&gt;

&lt;p&gt;CodeCommitì˜ Repo í™œìš©ë²•ì„ ì•„ë˜ 2ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ê¸°ì¬í•˜ì˜€ì§€ë§Œ, í•´ë‹¹ ì‹¤ìŠµì—ì„œëŠ” 1ë²ˆë§Œ ë‹¤ë£¹ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;1-ë¡œì»¬ì—-ìœ„ì¹˜í•œ-ì½”ë“œë¥¼-codecommitì—-pushí•˜ê¸°-ì›ê²©ì €ì¥ì†Œê°€-ë¹„ì–´ìˆìŒ&quot;&gt;1. ë¡œì»¬ì— ìœ„ì¹˜í•œ ì½”ë“œë¥¼ CodeCommitì— pushí•˜ê¸° (ì›ê²©ì €ì¥ì†Œê°€ ë¹„ì–´ìˆìŒ)&lt;/h3&gt;

&lt;p&gt;ë¡œì»¬ì˜ ë¹ˆê³µê°„ì—ì„œ CodeCommit Repo ì‚¬ìš©ì„ ìœ„í•œ git remote ì§€ì •&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git init
git remote add origin &lt;span class=&quot;nv&quot;&gt;$tf_source_repo_clone_url_http&lt;/span&gt;
git remote &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# ì›ê²© ì €ì¥ì†Œ í™•ì¸&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;í•´ë‹¹ í¬ìŠ¤íŒ…ì˜ 2 &amp;amp; 3í¸ì—ì„œ ECRì— ì˜¬ë¦´ ì´ë¯¸ì§€ íŒŒì¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì•„ë˜ ìƒ˜í”Œ &lt;strong&gt;Dockerfile&lt;/strong&gt;ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-Dockerfile highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; Dockerfile
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; golang:1.12-alpine AS build&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Install git&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;apk add &lt;span class=&quot;nt&quot;&gt;--no-cache&lt;/span&gt; git
&lt;span class=&quot;c&quot;&gt;#Get the hello world package from a GitHub repository&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;go get github.com/golang/example/hello
&lt;span class=&quot;k&quot;&gt;WORKDIR&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; /go/src/github.com/golang/example/hello&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Build the project and send the output to /bin/HelloWorld &lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;go build &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; /bin/HelloWorld

&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; golang:1.12-alpine&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Copy the build's output binary from the previous build container&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;COPY&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; --from=build /bin/HelloWorld /bin/HelloWorld&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENTRYPOINT&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; [&quot;/bin/HelloWorld&quot;]&lt;/span&gt;
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì‘ì„±ëœ &lt;strong&gt;Dockerfile&lt;/strong&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Commit&lt;/code&gt;í•˜ê³ , CodeCommitì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Push&lt;/code&gt;í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git add Dockerfile
git commit &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Create Dockerfile&quot;&lt;/span&gt;
git status
git push origin &lt;span class=&quot;c&quot;&gt;# master branchë¡œ push&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìê²© ì¦ëª… ë¬¸ì œê°€ ìˆë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¡œ í•´ê²°í•©ë‹ˆë‹¤. &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/codecommit/latest/userguide/troubleshooting-ch.html&quot;&gt;ìê²© ì¦ëª… í—¬í¼ ë° AWS CodeCommitì— ëŒ€í•œ HTTPS ì—°ê²° ë¬¸ì œ í•´ê²°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git config &lt;span class=&quot;nt&quot;&gt;--global&lt;/span&gt; credential.helper &lt;span class=&quot;s1&quot;&gt;'!aws codecommit credential-helper $@'&lt;/span&gt;
git config &lt;span class=&quot;nt&quot;&gt;--global&lt;/span&gt; credential.UseHttpPath &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-ë¡œì»¬ì—-ì›ê²©ì €ì¥ì†Œì˜-ì½”ë“œë¥¼-cloneí•˜ê¸°-ì›ê²©ì €ì¥ì†Œê°€-ë¹„ì–´ìˆì§€-ì•ŠìŒ&quot;&gt;2. ë¡œì»¬ì— ì›ê²©ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ cloneí•˜ê¸° (ì›ê²©ì €ì¥ì†Œê°€ ë¹„ì–´ìˆì§€ ì•ŠìŒ)&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone &lt;span class=&quot;nv&quot;&gt;$tf_source_repo_clone_url_http&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ë„íë¨¼íŠ¸ë¥¼ í™œìš©í•´ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , variable, output, tfvarsì˜ í™œìš©ë²•ì„ ë°°ì›Œë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì•ì„œ ì‘ì„±ëœ ì‘ì—…ë“¤ì´ ì •ìƒì ìœ¼ë¡œ ì»¤ë°‹ê³¼ cloneì´ ê°€ëŠ¥í•˜ë©´, ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./Packer&quot;&gt;Provision Infrastructure with Packer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      
        <category term="terraform" />
      

      
        <summary type="html">Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 1 (CodeCommit)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">3-Tier VPC Architecture with Terraform</title>
      <link href="https://heuristicwave.github.io/3Tier" rel="alternate" type="text/html" title="3-Tier VPC Architecture with Terraform" />
      <published>2021-01-27T18:00:00+00:00</published>
      <updated>2021-01-27T18:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/3Tier</id>
      <content type="html" xml:base="https://heuristicwave.github.io/3Tier">&lt;p&gt;ë³¸ ê¸€ì€ &lt;a href=&quot;https://www.aws.training/Details/eLearning?id=61799&quot;&gt;Configure and Deploying VPCs with Multiple Subnets&lt;/a&gt;ì—ì„œ ë‹¤ë£¨ëŠ”
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Production-Ready: The 3-Tier VPC&lt;/code&gt; ê°•ì˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í…Œë¼í¼ìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” 3ê³„ì¸µ VPC ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;Multi-Tier VPC ë€?&lt;/summary&gt;
  &lt;p&gt;&lt;br /&gt;
VPCë¥¼ êµ¬ì¶•í•  ë•Œ ë‹¨ì¼ ê³„ì¸µ VPCì— ëª¨ë“  ìì›ì„ ë„£ëŠ”ë‹¤ë©´, ë„¤íŠ¸ì›Œí¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì ì¬ì  ê³µê²©ìì—ê²Œ ìì›ì´ ë…¸ì¶œë©ë‹ˆë‹¤. ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ ì„œë¸Œë„·ìœ¼ë¡œ
ë‹¤ì¤‘ ê³„ì¸µ VPC ì•„í‚¤í…ì²˜ë¥¼ ë§Œë“¤ì–´ ë°©ì–´ ê³„ì¸µì„ ì´ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

  &lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/Multi-tier VPC.png&quot; alt=&quot;multiTier&quot; /&gt;&lt;/p&gt;
&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;ë””ìì¸-íŒ¨í„´--3-tier-vpc-architecture&quot;&gt;ë””ìì¸ íŒ¨í„´ : 3 Tier VPC Architecture&lt;/h1&gt;

&lt;p&gt;&lt;em&gt;í…Œë¼í¼ ì½”ë“œëŠ” ëª¨ë“ˆë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ì§€ë§Œ, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” 3-tier ì•„í‚¤í…ì²˜ ì¤‘ ë„¤íŠ¸ì›Œí¬ì™€ ê´€ë ¨ëœ ë¶€ë¶„ë§Œì„ ë‹¤ë¤„ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì½”ë“œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;Step 0 (í…Œë¼í¼ì„ í™œìš©í•˜ì‹¤ ì¤„ ì•ˆë‹¤ë©´ ë„˜ì–´ê°€ì„¸ìš”)&lt;/summary&gt;

  &lt;h2 id=&quot;step-0&quot;&gt;Step 0&lt;/h2&gt;

  &lt;p&gt;ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•  í´ë”ë¥¼ ë§Œë“¤ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;provider&lt;/code&gt;ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mkdir &lt;/span&gt;architecture
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;architecture
terraform init
&lt;span class=&quot;nb&quot;&gt;touch &lt;/span&gt;threeTierVPC.tf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;threeTierVPC.tf&lt;/code&gt;ì— ë²¤ë” ì •ë³´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aws&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ap-northeast-2&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;ëª…ë ¹ì–´&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform plan&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ë¥¼ í†µí•´, ì˜¤ë¥˜ ì—†ì´ í†µê³¼í•˜ëŠ” í™”ë©´ì„ í™•ì¸í•˜ê³  ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€
&lt;br /&gt;&lt;/p&gt;
  &lt;blockquote&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ë¡œ ì¸í”„ë¼ë¥¼ ë°˜ì˜ í• ë•Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-auto-approve&lt;/code&gt;ì˜µì…˜ì„ ì£¼ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yes&lt;/code&gt;ì…ë ¥ ì—†ì´ ì§„í–‰ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yes&lt;/code&gt;ë¥¼ ì…ë ¥í•˜ê¸° ì „, í•œë²ˆ ë” ê²€í† í•  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ìˆìœ¼ë¯€ë¡œ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;/blockquote&gt;
&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ğŸ’¡ê° ì†Œì œëª© ë§í¬ì— ì²¨ë¶€ëœ ì½”ë“œë¥¼ í™œìš©í•´ Step 0 ì—ì„œ ë§Œë“  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;threeTierVPC.tf&lt;/code&gt;ì— ì´ì–´ì„œ ì‘ì„±í•˜ê±°ë‚˜, ë”°ë¡œ ìƒˆë¡œìš´ íŒŒì¼ì„ ë§Œë“¤ì–´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform plan&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì°¨ë¡€ë¡œ ì‘ì„±í•˜ë©° ê³„ì¸µì„ ìŒ“ì•„ ì˜¬ë¦½ë‹ˆë‹¤.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-1&quot;&gt;Step 1&lt;/h2&gt;
&lt;h3 id=&quot;layer-1ï¸âƒ£--public-subnet&quot;&gt;Layer 1ï¸âƒ£ : &lt;a href=&quot;https://github.com/heuristicwave/TIL-DevOps/blob/main/IaC/Terraform/code/3-Tier%20VPC/step1.tf&quot;&gt;Public subnet&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;í•˜ë‚˜ì˜ VPCì— 2ê°œì˜ AZë¥¼ ë§Œë“¤ê³  ê°ê°ì˜ Public ì„œë¸Œë„·ì„ ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step1.png&quot; alt=&quot;step1&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;í¼ë¸”ë¦­ ì„œë¸Œë„·ì€ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë³´ë‹¤ ì ì€ ìˆ˜ì˜ IP ì˜ˆì•½í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Step 1 ì½”ë“œë¥¼ ì ìš© í›„, ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform state list
data.aws_availability_zones.available
aws_internet_gateway.igw
aws_subnet.pub_sub_1
aws_subnet.pub_sub_2
aws_vpc.main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;details&gt;
  &lt;summary&gt;ìƒì„±í•œ ì¸í”„ë¼ê°€ ìœ„ì™€ ê°™ì§€ ì•Šì„ ê²½ìš°&lt;/summary&gt;

  &lt;p&gt;ì‹¤ìˆ˜ë¡œ ì˜ë„ì¹˜ ì•Šì€ ì¸í”„ë¼ê°€ í”„ë¡œë¹„ì €ë‹ ë˜ì—ˆë‹¤ë©´ 2ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì› ìƒíƒœë¡œ ë³µêµ¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destroy&lt;/code&gt; ëª…ë ¹ì–´ë¡œ íŠ¹ì • ì¸í”„ë¼ë§Œ ë˜ëŒë¦¬ê±°ë‚˜ í”„ë¡œë¹„ì €ë‹ í•˜ê³ ì‹¶ì€ ê²½ìš°, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-target&lt;/code&gt; ì˜µì…˜ê³¼ í•¨ê»˜ resource ëª…ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. &lt;br /&gt;
&lt;em&gt;ì˜ˆì‹œ) terraform destory -target aws_vpc.main&lt;/em&gt;&lt;/li&gt;
    &lt;li&gt;ì˜ëª» ì‘ì„±í•œ ì½”ë“œë¥¼ ìˆ˜ì • í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ì—¬ ìµœì‹  ìƒíƒœì˜ ì¸í”„ë¼ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;/ol&gt;

&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-2&quot;&gt;Step 2&lt;/h2&gt;
&lt;h3 id=&quot;layer-1ï¸âƒ£--internet-access-resources&quot;&gt;Layer 1ï¸âƒ£ : &lt;a href=&quot;https://github.com/heuristicwave/TIL-DevOps/blob/main/IaC/Terraform/code/3-Tier%20VPC/step2.tf&quot;&gt;Internet access resources&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;ì™¸ë¶€ ì¸í„°ë„·ê³¼ì˜ ë…¸ì¶œì„ ì œí•œí•˜ê³  ë‚˜ê°€ëŠ” íŠ¸ë˜í”½ì„ ìœ„í•´ NAT Gatewayë¥¼ í™œìš©í•©ë‹ˆë‹¤. ë˜í•œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì„ ìœ„í•´ ALBë¥¼ ìœ„ì¹˜ì‹œì¼°ìŠµë‹ˆë‹¤.
ë¡œë“œë°¸ëŸ°ì„œì™€ NAT GatewayëŠ” ê°€ìš©ì„±ì´ ë†’ì€ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ë¡œ ë³‘ëª© í˜„ìƒì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;ğŸ’¡Nat Gateway ì•Œì•„ë³´ê¸°&lt;/summary&gt;
  &lt;p&gt;&lt;br /&gt;
NAT(ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ ë³€í™˜) ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸í„°ë„· ë˜ëŠ” ê¸°íƒ€ AWS ì„œë¹„ìŠ¤ì— ì—°ê²°í•˜ëŠ” í•œí¸, ì¸í„°ë„·ì—ì„œ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì™€ì˜ ì—°ê²°ì„ ì‹œì‘í•˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ë§Œë“¤ë ¤ë©´ NAT ê²Œì´íŠ¸ì›¨ì´ê°€ ì†í•  í¼ë¸”ë¦­ ì„œë¸Œë„·ì„ ì§€ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— Step2ì—ì„œ ìš°ì„ ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-nat-gateway.html&quot;&gt;ë„íë¨¼íŠ¸ë¡œ ë” ì•Œì•„ë³´ê¸°&lt;/a&gt;&lt;/p&gt;

&lt;/details&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step2.png&quot; alt=&quot;step2&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ê·¸ë¦¼ì—ì„œëŠ” ë³´ì´ì§€ ì•Šì§€ë§Œ, VPCì—ëŠ” ì•”ì‹œì  ë¼ìš°í„°ê°€ ìˆìœ¼ë©° ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì´ ì „ë‹¬ë˜ëŠ” ìœ„ì¹˜ë¥¼ ì œì–´í•©ë‹ˆë‹¤.
VPCì˜ ê° ì„œë¸Œë„·ì„ ë¼ìš°íŒ… í…Œì´ë¸”ì— ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤. í…Œì´ë¸”ì—ì„œëŠ” ì„œë¸Œë„·ì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Step 2 ì½”ë“œë¥¼ ì ìš© í›„, ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform state list
data.aws_availability_zones.available
aws_eip.nat_1
aws_eip.nat_2
aws_internet_gateway.igw
aws_nat_gateway.nat_gateway_1
aws_nat_gateway.nat_gateway_2
aws_route_table.route_table_pub
aws_route_table_association.route_table_association_1
aws_route_table_association.route_table_association_2
aws_subnet.pub_sub_1
aws_subnet.pub_sub_2
aws_vpc.main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ALBì™€ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”í›„, ëª¨ë“ˆë¡œ í…Œë¼í¼ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì—ì„œ í•™ìŠµí•˜ê² ìŠµë‹ˆë‹¤.&lt;/em&gt; &lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-3&quot;&gt;Step 3&lt;/h2&gt;
&lt;h3 id=&quot;layer-2ï¸âƒ£ï¸--apps-in-a-private-subnet&quot;&gt;Layer 2ï¸âƒ£ï¸ : &lt;a href=&quot;https://github.com/heuristicwave/TIL-DevOps/blob/main/IaC/Terraform/code/3-Tier%20VPC/step3.tf&quot;&gt;Apps in a private subnet&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;2ê°œì˜ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë†“ìŠµë‹ˆë‹¤. ì´í›„, ë‘ í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ì—°ê²°ëœ ALBëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„· ë¦¬ì†ŒìŠ¤ ê°„ì˜ íŠ¸ë˜í”½ì„ ë¶„ì‚°ì‹œí‚µë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;â—ï¸ì˜ˆì œ ê·¸ë¦¼ì—ì„œëŠ” Private subnetì˜ cidr blockì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.2.0/22&lt;/code&gt;ë¡œ ê°€ì´ë“œ í•˜ì§€ë§Œ, ì´ëŠ” ì•ì„œ ë§Œë“  ì„œë¸Œë„·ê³¼ ë²”ìœ„ê°€ ê²¹ì¹˜ë¯€ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.4.0/22&lt;/code&gt;ë¡œ ë°”ê¿” ì§„í–‰í•©ë‹ˆë‹¤.&lt;/strong&gt;
&lt;a href=&quot;https://www.ipaddressguide.com/cidr&quot;&gt;CIDR ê³„ì‚°ê¸°&lt;/a&gt; ì—ì„œ ì •í™•í•˜ê²Œ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step3.png&quot; alt=&quot;step3&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Step3ì—ì„œë„ Step2ì™€ ê°™ì´ ê·¸ë¦¼ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠëŠ” ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ë§Œë“¤ê³  NAT ê²Œì´íŠ¸ì›¨ì´ì™€ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„ ì—°ê²°í•´ ì¤ë‹ˆë‹¤.
í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ìš”ì²­ì´ ì™¸ë¶€ë¡œ ë‚˜ê°ˆë•ŒëŠ” NAT ê²Œì´íŠ¸ì›¨ì´ì˜ ê³ ì • IPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
(í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ë¼ìš°íŠ¸ í…Œì´ë¸”ì€ í¼ë¸”ë¦­ê³¼ ë‹¬ë¦¬ 2ê°œë¥¼ ë§Œë“¤ì–´ ê°ê° ì—°ê²°í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Step 3 ì½”ë“œë¥¼ ì ìš© í›„, ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform state list
data.aws_availability_zones.available
aws_eip.nat_1
aws_eip.nat_2
aws_internet_gateway.igw
aws_nat_gateway.nat_gateway_1
aws_nat_gateway.nat_gateway_2
aws_route.private_nat_1
aws_route.private_nat_2
aws_route_table.route_table_pri_1
aws_route_table.route_table_pri_2
aws_route_table.route_table_pub
aws_route_table_association.route_table_association_1
aws_route_table_association.route_table_association_2
aws_route_table_association.route_table_pri_association_1
aws_route_table_association.route_table_pri_association_2
aws_subnet.pri_sub_1
aws_subnet.pri_sub_2
aws_subnet.pub_sub_1
aws_subnet.pub_sub_2
aws_vpc.main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ DBì™€ ì¸ìŠ¤í„´ìŠ¤ ì—°ê²°ì€ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”í›„, ëª¨ë“ˆë¡œ í…Œë¼í¼ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì—ì„œ í•™ìŠµí•˜ê² ìŠµë‹ˆë‹¤.&lt;/em&gt; &lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-4&quot;&gt;Step 4&lt;/h2&gt;
&lt;h3 id=&quot;layer-3ï¸âƒ£--data-in-a-second-private-subnet&quot;&gt;Layer 3ï¸âƒ£ : Data in a second private subnet&lt;/h3&gt;

&lt;p&gt;ì²« ë²ˆì§¸ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë’¤ì— ë‘ ë²ˆì§¸ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„ ë°°ì¹˜í•©ë‹ˆë‹¤. (ì½”ë“œ ìƒëµ) &lt;br /&gt;
ì¥ì• ê°€ ë°œìƒí•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ read-replica í˜¹ì€ standby êµ¬ì„±ìœ¼ë¡œ ë°°ì¹˜í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;â—Step4ì˜ ì„œë¸Œë„· ì‘ì„±ë²•ì€ Step3ì˜ ë°©ë²•ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ì•„ë˜ ì‚¬ì§„ì€ CIDRì˜ ë²”ìœ„ê°€ ê²¹ì¹˜ë¯€ë¡œ, Private subnetì˜ cidr blockì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.8.0/23&lt;/code&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.12.0/23&lt;/code&gt;ë¡œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.10.0/23&lt;/code&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.14.0/23&lt;/code&gt;ìœ¼ë¡œ ë°”ê¿” ì§„í–‰í•˜ì„¸ìš”.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step4.png&quot; alt=&quot;step4&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ë°ì´í„° ë¦¬ì†ŒìŠ¤(/23)ë³´ë‹¤ë¥¼ ì•± ë¦¬ì†ŒìŠ¤(/22)ë¥¼ í™•ì¥í•  ê°€ëŠ¥ì„±ì´ ì»¤, ë” í° ì„œë¸Œë„· ë§ˆìŠ¤í¬ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-5&quot;&gt;Step 5&lt;/h2&gt;
&lt;h3 id=&quot;leave-extra-ips-available&quot;&gt;Leave extra IPs available&lt;/h3&gt;

&lt;p&gt;ë°°í¬ëœ ì¸í”„ë¼ê°€ í™•ì¥ë˜ì–´ ì•„í‚¤í…ì²˜ê°€ ë³€ê²½ë  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì—¬ìœ ë¶„ì˜ IPë¥¼ ì˜ˆì•½ì„ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. (ì½”ë“œ ìƒëµ)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step5.png&quot; alt=&quot;step5&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ìœ„ì™€ ê°™ì€ ë‹¨ê³„ë“¤ì„ í†µí•´ &lt;strong&gt;3 Tier VPC Architecture&lt;/strong&gt;ë¥¼ í•™ìŠµí•´ë³´ì•˜ìŠµë‹ˆë‹¤.
Terraformìœ¼ë¡œ ìƒì„±ëœ ìì›ë“¤ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destory&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ í†µí•´ í•™ìŠµì„ ì‹œì‘í•˜ê¸° ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ì„¸ìš”.
ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ìƒëµí–ˆë˜ ì¸ìŠ¤í„´ìŠ¤, DB, LB ë“±ì„ ëª¨ë“ˆë¡œ ê´€ë¦¬í•˜ë©° ë‹¤ë¤„ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./Packer&quot;&gt;Provision Infrastructure with Packer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="aws" />
      
        <category term="terraform" />
      

      
        <summary type="html">ë³¸ ê¸€ì€ Configure and Deploying VPCs with Multiple Subnetsì—ì„œ ë‹¤ë£¨ëŠ” Production-Ready: The 3-Tier VPC ê°•ì˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í…Œë¼í¼ìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” 3ê³„ì¸µ VPC ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.</summary>
      

      
      
    </entry>
  
</feed>
