<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" >
  <generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator>
  <link href="https://heuristicwave.github.io/author/HeuristicWave/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://heuristicwave.github.io/" rel="alternate" type="text/html" />
  <updated>2021-06-22T01:46:50+00:00</updated>
  <id>https://heuristicwave.github.io/author/HeuristicWave/feed.xml</id>

  
  
  

  
    <title type="html">Heuristic Wave Blog | </title>
  

  
    <subtitle>I wanna be a technical writer</subtitle>
  

  

  
    
      
    
  

  
  

  
    <entry>
      <title type="html">Look into EKS max pods</title>
      <link href="https://heuristicwave.github.io/EKS_Max_Pods" rel="alternate" type="text/html" title="Look into EKS max pods" />
      <published>2021-06-19T18:00:00+00:00</published>
      <updated>2021-06-19T18:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/EKS_Max_Pods</id>
      <content type="html" xml:base="https://heuristicwave.github.io/EKS_Max_Pods">&lt;p&gt;EKS ë…¸ë“œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ Podì˜ ê°œìˆ˜ëŠ” ëª‡ ê°œì¼ê¹Œ?&lt;/p&gt;

&lt;h1 id=&quot;preview&quot;&gt;Preview&lt;/h1&gt;

&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” EKSì˜ ë…¸ë“œ ê·¸ë£¹ì—ì„œëŠ” ìµœëŒ€ ëª‡ ê°œì˜ í¬ë“œ(Private IP)ê°€ í• ë‹¹ ê°€ëŠ¥í•˜ê³  ì–´ë– í•œ ë°©ë²•ìœ¼ë¡œ ìµœëŒ€ í¬ë“œì˜ ê°œìˆ˜ë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;build-up&quot;&gt;Build Up&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/best-practices/cluster-large/&quot;&gt;ì¿ ë²„ë„¤í‹°ìŠ¤ ë„ê·œë¨¼íŠ¸&lt;/a&gt; ì— ë”°ë¥´ë©´ ë…¸ë“œë‹¹ 110ê°œì˜ í¬ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ë…¸ë“œëŠ” 5000ê°œê¹Œì§€ ìƒì„± ê°€ëŠ¥í•´ ì´ 15ë§Œ ê°œì˜ í¬ë“œê°€ ìƒì„± ê°€ëŠ¥í•˜ë‹¤ê³  í•œë‹¤. &lt;br /&gt;
&lt;a href=&quot;https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=en#cidr_ranges_for_clusters&quot;&gt;GCPì˜ GKE ê°€ì´ë“œ&lt;/a&gt; ì— ë”°ë¥´ë©´ ê¸°ë³¸ í´ëŸ¬ìŠ¤í„° ë…¸ë“œ í•˜ë‚˜ì— ìµœëŒ€ 110ê°œì˜ í¬ë“œê°€ ìƒì„± ê°€ëŠ¥í•˜ë‹¤ê³  í•œë‹¤. &lt;br /&gt;
êµ¬ê¸€ë§ì„ í†µí•´ í™•ì¸í•˜ë‹ˆ, ë…¸ë“œì—ì„œ í¬ë“œì˜ ê°¯ìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ kubelet, cAdvisor ë“±ê³¼ ê°™ì€ K8s ì—ì´ì „íŠ¸ì— ì˜¤ë²„í—¤ë“œë¥¼ ë°œìƒì‹œí‚¤ë¯€ë¡œ 110ê°œ ì •ë„ë¥¼ ê¶Œì¥í•œë‹¤ê³  í•œë‹¤.
ê·¸ë˜ì„œ ê·¸ëŸ°ì§€ &lt;a href=&quot;https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/&quot;&gt;kubelet docs&lt;/a&gt; ì—ì„œë„ ì•„ë˜ì™€ ê°™ì€ max-podsê°€ 110ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ê°€ì§„ë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;--max-pods&lt;/span&gt; int32     Default: 110
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;eks-eni-max-pods&quot;&gt;EKS eni max pods&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI&quot;&gt;IP addresses per network interface per instance type&lt;/a&gt; ì„ í™•ì¸í•´ë³´ë©´ AWSì˜ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ë³„ ENI ê°œìˆ˜ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.
&lt;a href=&quot;https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html&quot;&gt;EKS ì„¤ëª…ì„œ&lt;/a&gt; ë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê³µì‹ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. &lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(# of network interfaces for the instance type Ã— (# of IPv4 per network interface - 1)) + 2&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ENIì˜ ì²« ë²ˆì§¸ IPëŠ” í¬ë“œê°€ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ 1ì„ ë¹¼ê³  AWS CNIì™€ kube-proxyê°€ ì°¨ì§€í•˜ëŠ” 2ê°œì˜ IPë¥¼ ë§ˆì§€ë§‰ ìˆ˜ì‹ì— ë”í•´ ìµœì¢… ì‚¬ìš© ê°€ëŠ¥í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max-pod&lt;/code&gt; ê°’ì„ ì•Œ ìˆ˜ ìˆë‹¤. &lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ì„¤ëª…í•œ ê³µì‹ ì´ì™¸ì—ë„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kubectl&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ í†µí•´ Maximum Podsë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl get nodes &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt;
NAME                                            STATUS   ROLES    AGE   VERSION
ip-10-0-0-178.ap-northeast-2.compute.internal   Ready    &amp;lt;none&amp;gt;   18h   v1.19.6-eks-49a6c0
ip-10-0-1-143.ap-northeast-2.compute.internal   Ready    &amp;lt;none&amp;gt;   18h   v1.19.6-eks-49a6c0
â¯ kubectl describe nodes ip-10-0-0-178.ap-northeast-2.compute.internal | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; pods
  pods:                        17
  pods:                        17
Non-terminated Pods:          &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;17 &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;total&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;-labs-1&quot;&gt;ğŸ‘€ Labs 1&lt;/h3&gt;

&lt;p&gt;kubectlì˜ ëª…ë ¹ì–´ì—ì„œ ë…¸ë“œ(t3.medium)ë‹¹ 17ê°œì˜ í¬ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  í–ˆëŠ”ë°, ì§ì ‘ ë…¸ë“œê·¸ë£¹ ë‚´ì—ì„œ í¬ë“œë¥¼ ìµœëŒ€ë¡œ ë„ì›Œ í™•ì¸í•´ë³´ì. ë…¸ë“œê·¸ë£¹ ë‚´ì— nginx 32ê°œë¥¼ ì˜¬ë ¤ë³´ì•˜ë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/maxPodsTest.png&quot; alt=&quot;EKSMaxPods&quot; /&gt;&lt;/p&gt;

&lt;p&gt;K9s ì‰˜ì„ í†µí•´ ì´ 38ê°œì˜ í¬ë“œê°€ í™•ì¸ë˜ì—ˆê³  38ê°œ ì¤‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws-node&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;coredns&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kube-proxy&lt;/code&gt;ê°€ ê°ê° 2ê°œì˜ ë…¸ë“œì— ìœ„ì¹˜í•˜ê³  4ê°œì˜ nginx í¬ë“œê°€ &lt;strong&gt;Pending&lt;/strong&gt; ìƒíƒœë¼ëŠ” ê²ƒì„ íŒŒì•…í–ˆë‹¤.
ì¦‰, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;38(Total) - 4(Pending) = 17(t3.medium Maximum Pods) * 2(# of Node)&lt;/code&gt; ì‹¤í—˜ ê²°ê³¼ì™€ ì•ì„œ ì•Œì•„ë³¸ Maximum Podsê°€ ë™ì¼í•˜ë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;maximum-pods-ë³€ê²½í•˜ê¸°&quot;&gt;Maximum Pods ë³€ê²½í•˜ê¸°&lt;/h2&gt;

&lt;p&gt;EKSì—ì„œ Maximum Podsë¥¼ ê²°ì • ì§“ëŠ” ìš”ì†ŒëŠ” ENIë‹¤. ê·¸ëŸ¬ë‚˜ í´ëŸ¬ìŠ¤í„°ì˜ ë…¸ë“œê·¸ë£¹ì„ ìƒì„±í•  ë•Œ kubeletì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max-pods&lt;/code&gt; ê°’ì„ ë³€ê²½í•´ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆë‹¤. 
&lt;a href=&quot;https://docs.aws.amazon.com/eks/latest/userguide/cni-custom-network.html&quot;&gt;AWS Docs&lt;/a&gt; ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ (ë¶ˆì¹œì ˆí•œ?) ì„¤ëª…ì„ í†µí•´ ENIì™€ ë³„ê°œë¡œ max-podsë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ” íŒíŠ¸ë¥¼ ì–»ì—ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/bootstrapArg.png&quot; alt=&quot;max-pods.png&quot; /&gt;
ê³µì‹ ë¬¸ì„œì—ì„œ ì„¤ëª…ì´ êµ‰ì¥íˆ ë¹ˆì•½í•˜ì§€ë§Œ, EKSì—ì„œ ë…¸ë“œ ê·¸ë£¹ì„ ì»¤ìŠ¤í…€ìœ¼ë¡œ ìƒì„±í•  ë•Œ &lt;strong&gt;Launch templates&lt;/strong&gt;ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UserData&lt;/code&gt;ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì •ì˜í•˜ë©´ Maximum Podsê°€ ë³€ê²½ëœë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;MIME-Version: 1.0
Content-Type: multipart/mixed&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;==MYBOUNDARY==&quot;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;MYBOUNDARY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;
Content-Type: text/x-shellscript&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;us-ascii&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
/etc/eks/bootstrap.sh &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;Cluster Name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--use-max-pods&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--kubelet-extra-args&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'--max-pods=10'&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;MYBOUNDARY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;details&gt;
  &lt;summary&gt;GCPì—ì„œ Max Podsë¥¼ ì œì–´í•˜ëŠ” ë°©ë²• ğŸ‘ˆ Click! &lt;/summary&gt;

  &lt;p&gt;&lt;a href=&quot;https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=en#configuring_maximum_pods_per_node&quot;&gt;GCPì—ì„œëŠ” í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ë•Œ&lt;/a&gt;
ì•„ë˜ ëª…ë ¹ì–´ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--default-max-pods-per-node&lt;/code&gt; íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max-pods&lt;/code&gt;(ğŸ‘† Build Up ë‹¨ê³„ì—ì„œ default 110 ğŸ‘†)ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆë‹¤.&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gcloud container clusters create CLUSTER_NAME &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;# ìƒëµ&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--default-max-pods-per-node&lt;/span&gt; MAXIMUM_PODS &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;# ìƒëµ&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-labs-2&quot;&gt;ğŸ‘€ Labs 2&lt;/h3&gt;

&lt;p&gt;ì•„ë˜ ì‚¬ì§„ì˜ ì™¼ìª½ì€ Labs 1ì˜ Pureí•œ t3.medium, ì˜¤ë¥¸ìª½ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max-pods&lt;/code&gt;ë¥¼ ì§€ì •í•œ Custom t3.mediumì´ë‹¤. ì½˜ì†”í™”ë©´ì—ì„œ ìŠ¤í™ì€ ê°™ì§€ë§Œ í• ë‹¹ëœ í¬ë“œì˜ ìˆ˜ê°€ ë‹¤ë¥´ë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/max10pods.png&quot; alt=&quot;max-pods-10.png&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;result&quot;&gt;Result&lt;/h2&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ë‹¤ì–‘í•œ ë°©ë²•ì„ í†µí•´ EKSì—ì„œ Maximum Podsë¥¼ íŒŒì•…í•˜ëŠ” ë°©ë²•ê³¼ ë³€ê²½í•˜ëŠ” ë°©ë²• ë°°ì› ë‹¤.
AWSì—ì„œëŠ” ENIë¼ëŠ” &lt;em&gt;ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ì¹´ë“œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë…¼ë¦¬ì  ë„¤íŠ¸ì›Œí¬ êµ¬ì„± ìš”ì†Œ&lt;/em&gt; ë•ë¶„ì— ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ë§ˆë‹¤ ìƒì„±ë  ìˆ˜ ìˆëŠ” í¬ë“œì˜ ìˆ˜ê°€ ë‹¬ëë‹¤.
ê·¸ ë°–ì—ë„ GCPì— ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì„¤ê³„ ì² í•™ì„ ê·¸ëŒ€ë¡œ ì´ì–´ë°›ì•„ kubeletì˜ max-pods ê°’ì´ ë™ì¼í•˜ê³  í´ëŸ¬ìŠ¤í„° ìƒì„± ìˆœê°„ì—ë„ max-pods ì„¤ì •ì— ëŒ€í•œ ììœ ë„ê°€ ë†’ë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì–´ë– í•œ ë°©ë²•ì´ ë” ìš°ìœ„ì— ìˆëŠ”ì§€ ê²°ë¡ ì§“ê¸° ì–´ë µì§€ë§Œ, CSPì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ max-pods ìƒì„± ì›ë¦¬ë¥¼ íŒŒì•…í•˜ì—¬ ìµœì ì˜ IP í• ë‹¹ì— ë„ì›€ì´ ë˜ë©´ ì¢‹ê² ë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ì†Œì¤‘í•œ ì‹œê°„ì„ ë‚´ì–´ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ì£¼ì„¸ìš”! ğŸ˜ƒ&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;EKS Series&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./EKSMaxPods&quot;&gt;Look into EKS max pods&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      
        <category term="backend" />
      

      
        <summary type="html">EKS ë…¸ë“œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ Podì˜ ê°œìˆ˜ëŠ” ëª‡ ê°œì¼ê¹Œ?</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">ECR CodePipeline with Terraform â…¢</title>
      <link href="https://heuristicwave.github.io/CodePipeline" rel="alternate" type="text/html" title="ECR CodePipeline with Terraform â…¢" />
      <published>2021-04-09T00:00:00+00:00</published>
      <updated>2021-04-09T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/CodePipeline</id>
      <content type="html" xml:base="https://heuristicwave.github.io/CodePipeline">&lt;p&gt;Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 3 (CodePipeline)&lt;/p&gt;

&lt;h1 id=&quot;preview&quot;&gt;Preview&lt;/h1&gt;

&lt;p&gt;3í¸ì—ì„œëŠ” CodePipelineì„ ìƒì„±í•˜ê³  IAM ì •ì±…ê³¼ ì—­í• ì„ ë¶€ì—¬í•˜ëŠ” ë²•ì„ ë°°ì›Œë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codepipeline&quot;&gt;ë¬¸ì„œ&lt;/a&gt;
ë¥¼ í™•ì¸í•˜ë©´ artifactê°€ ë‹´ê¸°ëŠ” ë²„í‚·, pipelineì„ ìƒì„±í•˜ëŠ” ë¦¬ì†ŒìŠ¤, ê´€ë ¨ëœ IAM Roleê³¼ Policyê°€ ë³´ì…ë‹ˆë‹¤.
í…Œë¼í¼ì€ ì„ ì–¸í˜• ì–¸ì–´ì´ë¯€ë¡œ Roleê³¼ Resourceì˜ ì‘ì„± ìˆœì„œê°€ ë°”ë€Œì–´ë„ ìƒê´€ì´ ì—†ì§€ë§Œ, ì½˜ì†”ì—ì„œ ì‘ì—…í•  ê²½ìš° Roleì„ ë¨¼ì € ì‘ì„±í•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ë‹ˆ 3í¸ì—ì„œëŠ” IAMì„ ë¨¼ì € ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;iam-role&quot;&gt;IAM Role&lt;/h3&gt;
&lt;p&gt;ì•„ë˜ Roleì„ ë°©ê¸ˆì „ ìƒì„±í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codepipeline.tf&lt;/code&gt;ì— ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_iam_role&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;codepipeline_role&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;terraform-codepipeline&quot;&lt;/span&gt;
  assume_role_policy &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;codepipeline.amazonaws.com&quot;
      },
      &quot;Effect&quot;: &quot;Allow&quot;
    }
  ]
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iam-policy&quot;&gt;IAM Policy&lt;/h3&gt;
&lt;p&gt;ë³¸ë˜ í•„ìš”í•œ ì •ì±…ë§Œì„ ê³¨ë¼ &lt;a href=&quot;https://awspolicygen.s3.amazonaws.com/policygen.html&quot;&gt;ì •ì±…ìƒì„±ê¸°&lt;/a&gt; ì—ì„œ ìƒìƒëœ ì •ì±…ì„ í™œìš©í•˜ëŠ” ë°©ë²•ì´ ìˆì§€ë§Œ, ì–´ë–¤ ì •ì±…ì´ í•„ìš”í•œì§€ í•œë²ˆì— ë§ì¶”ê¸°ëŠ” ë„ˆë¬´ ì–´ë µìŠµë‹ˆë‹¤.
(ì €ì˜ ê²½ìš° ì¸í„°ë„·ì—ì„œ íƒ€ì¸ì´ ì‘ì„±í•œ ì •ì±…ê³¼ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë§ì•„ê°€ë©° ì •ì±…ì„ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤ ğŸ˜…)&lt;br /&gt;
â• ì•„ë˜ Policyë¥¼ ë°©ê¸ˆì „ ìƒì„±í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codepipeline.tf&lt;/code&gt;ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &quot;aws_iam_policy&quot; &quot;codepipeline_policy&quot; {
  description = &quot;Codepipeline Execution Policy&quot;
  policy      = &amp;lt;&amp;lt;EOF
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: [
        &quot;s3:GetObject&quot;, &quot;s3:GetObjectVersion&quot;, &quot;s3:PutObject&quot;,
        &quot;s3:GetBucketVersioning&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;${aws_s3_bucket.artifact_bucket.arn}/*&quot;
    },
    {
      &quot;Action&quot; : [
        &quot;codebuild:StartBuild&quot;, &quot;codebuild:BatchGetBuilds&quot;,
        &quot;iam:PassRole&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;*&quot;
    },
    {
      &quot;Action&quot; : [
        &quot;codecommit:CancelUploadArchive&quot;,
        &quot;codecommit:GetBranch&quot;,
        &quot;codecommit:GetCommit&quot;,
        &quot;codecommit:GetUploadArchiveStatus&quot;,
        &quot;codecommit:UploadArchive&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;${aws_codecommit_repository.test.arn}&quot;
    }
  ]
}
EOF
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ğŸš© ì´ì–´ì„œ ìƒì„±í•œ &lt;strong&gt;Policyë¥¼ Roleì— ë¶€ì—¬&lt;/strong&gt;í•©ë‹ˆë‹¤. ì´ê²ƒ ì—­ì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_iam_role_policy_attachment&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;codepipeline-attach&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  role       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_iam_role.codepipeline_role.name
  policy_arn &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_iam_policy.codepipeline_policy.arn
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;codepipeline&quot;&gt;CodePipeline&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws_codepipeline&lt;/code&gt;ë¦¬ì†ŒìŠ¤ì˜ configì—ëŠ” artifact storeì™€ ì•”í˜¸í™” í‚¤, Source-Build-Deployë¡œ ì´ì–´ì§€ëŠ” ê° Stageê°€ ì„ ì–¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ë¦¬ì†ŒìŠ¤ ì•ˆì— ê¸°ì¬ëœ ì„¤ì •ë“¤ì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” deploy stageì™€ ì•”í˜¸í™” configëŠ” ì œì™¸í•˜ê³  ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &lt;span class=&quot;s2&quot;&gt;&quot;aws_codepipeline&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;pipeline&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  name     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.source_repo_name&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.source_repo_branch&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-Pipeline&quot;&lt;/span&gt;
  role_arn &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_iam_role.codepipeline_role.arn
  artifact_store &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_s3_bucket.artifact_bucket.bucket
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;S3&quot;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  stage &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Source&quot;&lt;/span&gt;
    action &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      name             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Source&quot;&lt;/span&gt;
      category         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Source&quot;&lt;/span&gt;
      owner            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;AWS&quot;&lt;/span&gt;
      version          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
      provider         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CodeCommit&quot;&lt;/span&gt;
      output_artifacts &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SourceOutput&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      run_order        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
      configuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        RepositoryName       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; var.source_repo_name
        BranchName           &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; var.source_repo_branch
        PollForSourceChanges &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  stage &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build&quot;&lt;/span&gt;
    action &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      name             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build&quot;&lt;/span&gt;
      category         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build&quot;&lt;/span&gt;
      owner            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;AWS&quot;&lt;/span&gt;
      version          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
      provider         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CodeBuild&quot;&lt;/span&gt;
      input_artifacts  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SourceOutput&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      output_artifacts &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;BuildOutput&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      run_order        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
      configuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        ProjectName &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; aws_codebuild_project.codebuild.id
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;1í¸ì—ì„œ ì‘ì„±í•œ CodeCommitì„ Stageì˜ Source, 2í¸ì—ì„œ ì‘ì„±í•œ CodeBuildë¥¼ Buildë‹¨ê³„ ì§€ì •í–ˆìŠµë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply, plan&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì°¨ë¡€ë¡œ ë°˜ì˜í•´ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ì‘ì„±ëœ ì¸í”„ë¼ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ í†µí•´ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ terraform state list
aws_codebuild_project.codebuild
aws_codecommit_repository.test
aws_codepipeline.pipeline
aws_ecr_repository.image_repo
aws_iam_policy.codebuild_policy
aws_iam_policy.codepipeline_policy
aws_iam_role.codebuild_role
aws_iam_role.codepipeline_role
aws_iam_role_policy_attachment.codebuild-attach
aws_iam_role_policy_attachment.codepipeline-attach
aws_s3_bucket.artifact_bucket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://console.aws.amazon.com/codepipeline&quot;&gt;CodePipe line ì½˜ì†”&lt;/a&gt; ì—ì„œ í™•ì¸í•˜ë©´ ê¶Œí•œì´ ì—†ì–´ ì‹¤íŒ¨í•œ í™”ë©´ì´ ë‚˜ì˜¬ ê²ƒ ì…ë‹ˆë‹¤.
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë˜ ë‹¤ë¥¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;codepipeline-trigger&quot;&gt;CodePipeline Trigger&lt;/h2&gt;
&lt;p&gt;CodeCommitì—ì„œ ë°œìƒí•œ ì´ë²¤íŠ¸ê°€ CodePipelineìœ¼ë¡œ íŠ¸ë¦¬ê±°ë˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ ì •ì˜ëœ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;â• ì•„ë˜ ì½”ë“œë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codepipeline.tf&lt;/code&gt;ì— ì¶”ê°€í•˜ê³  ì¸í”„ë¼ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.&lt;/p&gt;
&lt;noscript&gt;
  &lt;pre&gt;resource &amp;quot;aws_iam_role&amp;quot; &amp;quot;trigger_role&amp;quot; {
  name               = &amp;quot;terraform-trigger&amp;quot;
  assume_role_policy = &amp;lt;&amp;lt;EOF
{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot;,
      &amp;quot;Principal&amp;quot;: {
        &amp;quot;Service&amp;quot;: &amp;quot;events.amazonaws.com&amp;quot;
      },
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Sid&amp;quot;: &amp;quot;&amp;quot;
    }
  ]
}
EOF
}

resource &amp;quot;aws_iam_policy&amp;quot; &amp;quot;trigger_policy&amp;quot; {
  description = &amp;quot;CodePipeline Trigger Execution Policy&amp;quot;
  policy      = &amp;lt;&amp;lt;EOF
{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;codepipeline:StartPipelineExecution&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;${aws_codepipeline.pipeline.arn}&amp;quot;
    }
  ]
}
EOF
}

resource &amp;quot;aws_iam_role_policy_attachment&amp;quot; &amp;quot;trigger-attach&amp;quot; {
  role       = aws_iam_role.trigger_role.name
  policy_arn = aws_iam_policy.trigger_policy.arn
}&lt;/pre&gt;
&lt;/noscript&gt;
&lt;script src=&quot;https://gist.github.com/heuristicwave/5b566b2cc70337501a4d60b71215930f.js&quot;&gt; &lt;/script&gt;

&lt;h2 id=&quot;result&quot;&gt;Result&lt;/h2&gt;
&lt;p&gt;Trigger ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ì ìš©í•˜ê³  í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í™œìš©í•  ì•„ë¬´ Dockerfileì„ CodeCommitì— Pushí•©ë‹ˆë‹¤.
ë‹¤ì‹œ &lt;a href=&quot;https://console.aws.amazon.com/codepipeline&quot;&gt;CodePipeline ì½˜ì†”&lt;/a&gt; ì— ì ‘ì†í•´ ìš°ìƒë‹¨ì— ìœ„ì¹˜í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ë³€ê²½ì‚¬í•­ ë¦´ë¦¬ìŠ¤&lt;/code&gt;ë¥¼ ëˆ„ë¥´ë©´,
ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ ì½”ë“œ íŒŒì´í”„ë¼ì¸ì´ ì‘ë™í•˜ì—¬ ìš´ì˜ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/ecr_terraform_demo.png&quot; alt=&quot;terraform_demo&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cleanup&quot;&gt;Cleanup&lt;/h2&gt;
&lt;p&gt;S3 bucketì€ ë¹ˆìƒíƒœì—¬ì•¼ ì œê±°ê°€ ê°€ëŠ¥í•˜ê¸°ì— &lt;a href=&quot;https://console.aws.amazon.com/s3/home&quot;&gt;S3 ì½˜ì†”&lt;/a&gt; ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ecr-pipeline&lt;/code&gt;ì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.
ì´ì–´ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destory&lt;/code&gt; ëª…ë ¹ì–´ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ íšŒìˆ˜í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ì´ 3í¸ì— ê±¸ì³ì„œ í…Œë¼í¼ìœ¼ë¡œ &lt;strong&gt;ìµœì†Œí•œì˜ ë¦¬ì†ŒìŠ¤&lt;/strong&gt;ë¡œ ECR Pipeline êµ¬ì¶•ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. (CloudWatch ê¸°ëŠ¥ì„ ì¶”ê°€í•´ CodePipelineì„ êµ¬ì¶•í•´ë³´ì„¸ìš” ğŸ‘)
í•´ë‹¹ ê³¼ì •ì„ í†µí•´ AWS ì¸í”„ë¼ ìƒì„±ë²•ê³¼, IAM í™œìš©ë²•, Variable, Output, tfvars ë“±ì„ í™œìš©í•´ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë²•ì„ ê³µë¶€í–ˆìŠµë‹ˆë‹¤.
ë‹¤ë¥¸ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ë²•ë„ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¬ ë°©ë²•ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šìœ¼ë‹ˆ, í•´ë‹¹ í¬ìŠ¤íŒ…ì´ ë„ì›€ì´ ë˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ğŸ˜&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      

      
        <summary type="html">Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 3 (CodePipeline)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">ECR CodePipeline with Terraform â…¡</title>
      <link href="https://heuristicwave.github.io/CodeBuild" rel="alternate" type="text/html" title="ECR CodePipeline with Terraform â…¡" />
      <published>2021-04-08T00:00:00+00:00</published>
      <updated>2021-04-08T00:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/CodeBuild</id>
      <content type="html" xml:base="https://heuristicwave.github.io/CodeBuild">&lt;p&gt;Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 2 (ECR, CodeBuild, IAM)&lt;/p&gt;

&lt;p&gt;2í¸ì—ì„œëŠ” &lt;strong&gt;ECR&lt;/strong&gt;ê³¼ &lt;strong&gt;CodeBuild&lt;/strong&gt;ë¥¼ ìƒì„±í•˜ê³  &lt;strong&gt;IAM ì—­í• , ì •ì±…ì„ ë¶€ì—¬&lt;/strong&gt;í•˜ëŠ” ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;ecr&quot;&gt;ECR&lt;/h2&gt;
&lt;p&gt;ECR ì—­ì‹œ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository&quot;&gt;ê³µì‹ ë¬¸ì„œ&lt;/a&gt; ì—ì„œ ì‚¬ìš©ë°©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
ê³µì‹ë¬¸ì„œì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;image_scanning_configuration&lt;/code&gt; configë¥¼ ì‚¬ìš©í•˜ë©´ ì·¨ì•½ì  ìŠ¤ìº”ì´ ê°€ëŠ¥í•˜ë‹¤ ì„¤ëª…ë˜ì–´ ìˆì§€ë§Œ, í•„ìš”í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì œì™¸í•˜ê² ìŠµë‹ˆë‹¤.
ë”ë¶ˆì–´, outputë„ í•¨ê»˜ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; ecr.tf
resource &quot;aws_ecr_repository&quot; &quot;image_repo&quot; {
  name                 = var.image_repo_name
  image_tag_mutability = &quot;MUTABLE&quot;
}

output &quot;image_repo_url&quot; {
  value = aws_ecr_repository.image_repo.repository_url
}

output &quot;image_repo_arn&quot; {
  value = aws_ecr_repository.image_repo.arn
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì´ì–´ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ecr.tf&lt;/code&gt;ì—ì„œ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ &lt;strong&gt;var.image_repo_name&lt;/strong&gt; ë¶€ë¶„ì´ ì‘ë™í•˜ë„ë¡ 1í¸ì—ì„œ ì‘ì„±í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;variables.tf&lt;/code&gt; ì•„ë˜ ê°’ì„ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;âœ… í¸ì˜ìƒ ì´ë²ˆ ë‹¨ê³„ì— í•„ìš”í•œ variableì„ í•¨ê»˜ í¬í•¨í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;variable &quot;image_repo_name&quot; {
  description = &quot;Image repo name&quot;
  type        = string
}

variable &quot;container_name&quot; {
  description = &quot;Container Name&quot;
  default     = &quot;my-container&quot;
}

variable &quot;source_repo_branch&quot; {
  description = &quot;Source repo branch&quot;
  type        = string
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ecr ì‘ì„±ì„ ì™„ë£Œí–‡ìœ¼ë‹ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plan, apply&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì°¨ë¡€ë¡œ ì…ë ¥í•´ ì¸í”„ë¼ë¥¼ ìƒì„±í•˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ë‚˜ &lt;a href=&quot;https://console.aws.amazon.com/ecr/home&quot;&gt;ì½˜ì†”&lt;/a&gt; ì—ì„œ ìƒì„±ëœ ì¸í”„ë¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;codebuild&quot;&gt;CodeBuild&lt;/h2&gt;
&lt;p&gt;CodeBuildë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project&quot;&gt;Terraform ë„íë¨¼íŠ¸&lt;/a&gt; ì—ì„œ ì‚¬ìš©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
ê¸°ì¡´ê¹Œì§€ì˜ ì‘ì—…ê³¼ëŠ” ë‹¬ë¦¬ ìƒë‹¹íˆ ì–´ë ¤ì›Œ ë³´ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì“± í›ì–´ë³´ë©´ í¬ê²Œ 4ê°€ì§€(bucket, IAM Roleê³¼ Policy, Codebuild)ë¡œ ì •ë¦¬ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;bucket&quot;&gt;Bucket&lt;/h3&gt;
&lt;p&gt;ë„íë¨¼íŠ¸ì™€ ê°™ì´ ìš°ì„ ì ìœ¼ë¡œ S3ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. bucketì˜ ì´ë¦„ì€ ì„ íƒì´ì§€ë§Œ, ì—¬ëŸ¬ê°œì˜ ë²„í‚·ì„ ê°€ì§€ê³  ìˆëŠ” ì €ëŠ” ì‹ë³„ì„ ìœ„í•´ ì´ë¦„ì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; codebuild.tf
resource &quot;aws_s3_bucket&quot; &quot;artifact_bucket&quot; {
  bucket = &quot;ecr-pipeline&quot;
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iam-role&quot;&gt;IAM Role&lt;/h3&gt;
&lt;p&gt;ë„íë¨¼íŠ¸ë¥¼ ë”°ë¼ AssumeRoleì„ ì‚¬ìš©í•©ì‹œë‹¤. &lt;br /&gt;
â• S3ì„ ë§Œë“¤ë•Œ ì‚¬ìš©í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &quot;aws_iam_role&quot; &quot;codebuild_role&quot; {
  name = &quot;terraform-codebuild&quot;,
  assume_role_policy = &amp;lt;&amp;lt;EOF
{
   &quot;Version&quot;: &quot;2012-10-17&quot;,
   &quot;Statement&quot;: [
      {
         &quot;Effect&quot;: &quot;Allow&quot;,
         &quot;Principal&quot;: {
            &quot;Service&quot;: &quot;codebuild.amazonaws.com&quot;
         },
         &quot;Action&quot;: &quot;sts:AssumeRole&quot;
      }
   ]
}
EOF
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iam-policy&quot;&gt;IAM Policy&lt;/h3&gt;
&lt;p&gt;ì •ì±…ì€ IAM ì½˜ì†”ì—ì„œ ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ ì •ì±…ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì•„ë˜ì™€ ê°™ì´ ì§ì ‘ ì‘ì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ë„íë¨¼íŠ¸ì—ì„œ EC2ì— ëŒ€í•œ ì •ì±…ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ìš°ë¦¬ëŠ” ECRì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì€ ì •ì±…ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;noscript&gt;
  &lt;pre&gt;resource &amp;quot;aws_iam_policy&amp;quot; &amp;quot;codebuild_policy&amp;quot; {
  description = &amp;quot;CodeBuild Execution Policy&amp;quot;
  policy      = &amp;lt;&amp;lt;EOF
{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;logs:CreateLogGroup&amp;quot;, &amp;quot;logs:CreateLogStream&amp;quot;, &amp;quot;logs:PutLogEvents&amp;quot;,
        &amp;quot;ecr:GetAuthorizationToken&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;*&amp;quot;
    },
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;s3:GetObject&amp;quot;, &amp;quot;s3:GetObjectVersion&amp;quot;, &amp;quot;s3:PutObject&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;${aws_s3_bucket.artifact_bucket.arn}/*&amp;quot;
    },
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;ecr:GetDownloadUrlForLayer&amp;quot;, &amp;quot;ecr:BatchGetImage&amp;quot;,
        &amp;quot;ecr:BatchCheckLayerAvailability&amp;quot;, &amp;quot;ecr:PutImage&amp;quot;,
        &amp;quot;ecr:InitiateLayerUpload&amp;quot;, &amp;quot;ecr:UploadLayerPart&amp;quot;,
        &amp;quot;ecr:CompleteLayerUpload&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;${aws_ecr_repository.image_repo.arn}&amp;quot;
    }
  ]
}
EOF
}&lt;/pre&gt;
&lt;/noscript&gt;
&lt;script src=&quot;https://gist.github.com/heuristicwave/09103b88af041153ccd206ec6d51b7c1.js&quot;&gt; &lt;/script&gt;

&lt;p&gt;20, 30ë¼ì¸ì—ì„œ ì•ì„œ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;${ì±„ì›€ì°¸ì¡°}&lt;/code&gt; ë¬¸ë²•ìœ¼ë¡œ ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ğŸš© ì´ì–´ì„œ ìƒì„±í•œ &lt;strong&gt;Policyë¥¼ Roleì— ë¶€ì—¬&lt;/strong&gt;í•©ë‹ˆë‹¤. ì´ê²ƒ ì—­ì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;resource &quot;aws_iam_role_policy_attachment&quot; &quot;codebuild-attach&quot; {
  role       = aws_iam_role.codebuild_role.name
  policy_arn = aws_iam_policy.codebuild_policy.arn
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;codebuild-1&quot;&gt;CodeBuild&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project&quot;&gt;Terraform ë„íë¨¼íŠ¸&lt;/a&gt; ë¥¼ ë³´ì•„ë„ ì–´ë–»ê²Œ í•´ì•¼ ECRì— ì ìš©ì‹œí‚¬ ìˆ˜ ìˆëŠ”ì§€ ì•Œê¸° ì–´ë µìŠµë‹ˆë‹¤.
ìš°ì„  CodeBuildë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/codebuild/latest/userguide/sample-docker.html&quot;&gt;AWS docs&lt;/a&gt; ë¥¼ ì½ì–´ë´…ì‹œë‹¤.
ëŒ€ëµ ë¦¬ì†ŒìŠ¤ ì´ë¦„ì„ ì •í•˜ê³ , í™˜ê²½ì„ êµ¬ì„±í•˜ê³  ë¹Œë“œë¥¼ í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ì •ì˜í•´ì•¼ í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
CodeBuildê°€ ì •ì˜ëœ ì•„ë˜ ì½”ë“œë¥¼ í™œìš©í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;codebuild.tf&lt;/code&gt;ì— ì¶”ê°€í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;noscript&gt;
  &lt;pre&gt;resource &amp;quot;aws_codebuild_project&amp;quot; &amp;quot;codebuild&amp;quot; {
  name         = &amp;quot;codebuild-${var.source_repo_name}-${var.source_repo_branch}&amp;quot;
  service_role = aws_iam_role.codebuild_role.arn

  artifacts {
    type = &amp;quot;CODEPIPELINE&amp;quot;
  }
  
  environment {
    compute_type                = &amp;quot;BUILD_GENERAL1_MEDIUM&amp;quot;
    image                       = &amp;quot;aws/codebuild/standard:3.0&amp;quot;
    type                        = &amp;quot;LINUX_CONTAINER&amp;quot;
    privileged_mode             = true
    image_pull_credentials_type = &amp;quot;CODEBUILD&amp;quot;
    environment_variable {
      name  = &amp;quot;REPOSITORY_URI&amp;quot;
      value = aws_ecr_repository.image_repo.repository_url
    }
    environment_variable {
      name  = &amp;quot;AWS_DEFAULT_REGION&amp;quot;
      value = var.aws_region
    }
    environment_variable {
      name  = &amp;quot;CONTAINER_NAME&amp;quot;
      value = var.container_name
    }
  }
  source {
    type      = &amp;quot;CODEPIPELINE&amp;quot;
    buildspec = &amp;lt;&amp;lt;BUILDSPEC
${file(&amp;quot;buildspec.yml&amp;quot;)}
BUILDSPEC
  }
}&lt;/pre&gt;
&lt;/noscript&gt;
&lt;script src=&quot;https://gist.github.com/heuristicwave/2ebf79ce3cbdf4a87657b272f9e1d994.js&quot;&gt; &lt;/script&gt;

&lt;p&gt;31ë¼ì¸ì´ ì°¸ì¡°í•˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;buildspec.yml&lt;/code&gt;ì„ pre_build, build, post_buildì— ë§ì¶° ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; buildspec.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0.2&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;phases&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;install&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runtime-versions&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;pre_build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Logging in to Amazon ECR...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$(aws ecr get-login --region $AWS_DEFAULT_REGION --no-include-email)&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;COMMIT_HASH=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;IMAGE_TAG=${COMMIT_HASH:=latest}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Build started on `date`&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Building the Docker image...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker build -t $REPOSITORY_URI:latest .&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker tag $REPOSITORY_URI:latest $REPOSITORY_URI:$IMAGE_TAG&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;post_build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Build completed on `date`&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Pushing the Docker image...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker push $REPOSITORY_URI:latest&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker push $REPOSITORY_URI:$IMAGE_TAG&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo Writing image definitions file...&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;printf '[{&quot;name&quot;:&quot;%s&quot;,&quot;imageUri&quot;:&quot;%s&quot;}]' $CONTAINER_NAME $REPOSITORY_URI:$IMAGE_TAG &amp;gt; imagedefinitions.json&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;imagedefinitions.json&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;EOF&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ì‘ì„±ëœ ì¸í”„ë¼ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ í†µí•´ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ terraform state list
aws_codebuild_project.codebuild
aws_codecommit_repository.test
aws_ecr_repository.image_repo
aws_iam_policy.codebuild_policy
aws_iam_role.codebuild_role
aws_iam_role_policy_attachment.codebuild-attach
aws_s3_bucket.artifact_bucket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;details&gt;
  &lt;summary&gt;ìƒì„±í•œ ì¸í”„ë¼ê°€ ìœ„ì™€ ê°™ì§€ ì•Šì„ ê²½ìš°, ğŸ‘‰ Click&lt;/summary&gt;

  &lt;p&gt;ì‹¤ìˆ˜ë¡œ ì˜ë„ì¹˜ ì•Šì€ ì¸í”„ë¼ê°€ í”„ë¡œë¹„ì €ë‹ ë˜ì—ˆë‹¤ë©´ 2ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì› ìƒíƒœë¡œ ë³µêµ¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destroy&lt;/code&gt; ëª…ë ¹ì–´ë¡œ íŠ¹ì • ì¸í”„ë¼ë§Œ ë˜ëŒë¦¬ê±°ë‚˜ í”„ë¡œë¹„ì €ë‹ í•˜ê³ ì‹¶ì€ ê²½ìš°, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-target&lt;/code&gt; ì˜µì…˜ê³¼ í•¨ê»˜ resource ëª…ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. &lt;br /&gt;
&lt;em&gt;ì˜ˆì‹œ) terraform destory -target aws_vpc.main&lt;/em&gt;&lt;/li&gt;
    &lt;li&gt;ì˜ëª» ì‘ì„±í•œ ì½”ë“œë¥¼ ìˆ˜ì • í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ì—¬ ìµœì‹  ìƒíƒœì˜ ì¸í”„ë¼ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;/ol&gt;

&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      

      
        <summary type="html">Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 2 (ECR, CodeBuild, IAM)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">ECR CodePipeline with Terraform â… </title>
      <link href="https://heuristicwave.github.io/CodeCommit" rel="alternate" type="text/html" title="ECR CodePipeline with Terraform â… " />
      <published>2021-04-07T18:00:00+00:00</published>
      <updated>2021-04-07T18:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/CodeCommit</id>
      <content type="html" xml:base="https://heuristicwave.github.io/CodeCommit">&lt;p&gt;Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 1 (CodeCommit)&lt;/p&gt;

&lt;h1 id=&quot;overview&quot;&gt;Overview&lt;/h1&gt;

&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì»¤ë°‹ í›„, ë„ì»¤ì˜ ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ ë°°í¬í•˜ëŠ” ECR Pipelineì„ í…Œë¼í¼ìœ¼ë¡œ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.
AWSì—ì„œ ì €ì¥ì†Œ ì—­í• ì„ í•˜ëŠ” CodeCommit, ì½”ë“œë¥¼ ë¹Œë“œí•˜ëŠ” CodeBuild, íŒŒì´í”„ë¼ì¸ì„ ìë™í™” í•˜ëŠ” CodePipeline, ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ECRì„ í™œìš©í•´ êµ¬ì¶•í•©ë‹ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/CodePipeline.png&quot; alt=&quot;CodePipeline&quot; /&gt;
1í¸ì—ì„œëŠ” &lt;strong&gt;CodeCommit&lt;/strong&gt; êµ¬ì¶•ê³¼ &lt;strong&gt;terraformì˜ Output, Variables, tfvars&lt;/strong&gt; ë“±ì„ ë°°ì›Œ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ì¤€ë¹„-ì‘ì—…&quot;&gt;ì¤€ë¹„ ì‘ì—…&lt;/h2&gt;
&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì˜ ì‘ì—…ê³µê°„(~/terraform)ì„ ìƒì„±í•˜ê³  í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì•„ë˜ ì½”ë“œ ë¸”ëŸ­ì„ í„°ë¯¸ë„ì— ë³µì‚¬í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; provider.tf
provider &quot;aws&quot; {
  region  = var.aws_region
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì´í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform init&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ì„¸ìš”.&lt;/p&gt;

&lt;h2 id=&quot;codecommit&quot;&gt;CodeCommit&lt;/h2&gt;
&lt;p&gt;CodeCommitì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;a href=&quot;https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codecommit_repository&quot;&gt;Terraform ë„íë¨¼íŠ¸&lt;/a&gt; ì—ì„œ ì‚¬ìš©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
ë§í¬ì˜ Example Usageë¥¼ í™œìš©í•´ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì œ ë°©ì‹ëŒ€ë¡œì•„ë˜ ì½”ë“œë¥¼ í™œìš©í•´ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.
ë§í¬ì—ì„œ ì†Œê°œí•˜ëŠ” ì½”ë“œì™€ ë‹¤ë¥¸ ë¶€ë¶„ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;output&lt;/code&gt;ê³¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;variable&lt;/code&gt;ì˜ ì‚¬ìš© ì—¬ë¶€ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;âœ… ì•„ë˜ ì½”ë“œì™€ ë„íë¨¼íŠ¸ì˜ ì½”ë“œê°€ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ê¼­ í™•ì¸í•´ë³´ì„¸ìš”!&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; codecommit.tf
resource &quot;aws_codecommit_repository&quot; &quot;test&quot; {
  repository_name = var.source_repo_name
  description     = &quot;This is the Sample App Repository&quot;
}

output &quot;source_repo_clone_url_http&quot; {
  value = aws_codecommit_repository.test.clone_url_http
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Output&lt;/code&gt;ì€ í–¥í›„ cloneí•  ì›ê²© ì €ì¥ì†Œì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ ë„£ì–´ì¤ë‹ˆë‹¤. ë˜í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Variable&lt;/code&gt;ì„ ì‚¬ìš©í•´ ë³´ë‹¤ ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì¤€ë¹„ ì‘ì—…ì— ì •ì˜í•œ ë¦¬ì „ê³¼ CodeCommit Repo ì´ë¦„ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Variable&lt;/code&gt;ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; variables.tf
variable &quot;aws_region&quot; {
  description = &quot;The AWS region&quot;
  default     = &quot;ap-northeast-2&quot;
}

variable &quot;source_repo_name&quot; {
  description = &quot;Source repo name&quot;
  type        = string
}
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ìœ„ ì½”ë“œë¥¼ ë³µì‚¬í•œ í›„, terraform plan ëª…ë ¹ì–´ë¡œ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
&lt;img src=&quot;../../assets/built/images/post/plan.png&quot; alt=&quot;terraform plan&quot; /&gt;
ì•ì„œ ì‘ì„±í•œ variables.tfì˜ regionì€ default ê°’ì´ ìˆì§€ë§Œ, repositoryëŠ” variableì˜ í˜•ì‹ë§Œ ì •ì˜ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì¸í”„ë¼ë¥¼ ìƒì„±í•  ë•Œ í•„ìˆ˜ì ìœ¼ë¡œ ì´ë¦„ì„ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;âœ… variableì˜ inputê°’ì„ ìˆ˜ê¸°ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ í”¼í•˜ê³  ì‹¶ìœ¼ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tfvars&lt;/code&gt;ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í¸ì˜ìƒ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ê°’ë“¤ì„ ë¯¸ë¦¬ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; &amp;gt; terraform.tfvars
aws_ecr=&quot;my-image&quot;
source_repo_name=&quot;my-pipeline&quot;
source_repo_branch=&quot;master&quot;
image_repo_name=&quot;my-pipeline&quot;
&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EOF
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tfvars&lt;/code&gt;ëŠ” ìœ„ì™€ ê°™ì´ ë³€ìˆ˜ì˜ ê°’ì„ ì§€ì •í•˜ê¸°ë„ í•˜ì§€ë§Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.env&lt;/code&gt;ì²˜ëŸ¼ &lt;strong&gt;ì™¸ë¶€ë¡œ ë…¸ì¶œí•˜ë©´ ì•ˆë˜ëŠ” ê°’ì„ ë„£ì–´ë‘ê³  gitì— ignoreì‹œì¼œ ì‚¬ìš©&lt;/strong&gt;í•˜ê¸°ë„ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ìœ„ ì‘ì—…ì„ ì§„í–‰ í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ë©´ â€œApply completeâ€ê³¼ í•¨ê»˜ Outputs ê°’ì´ ë‚˜ì˜µë‹ˆë‹¤.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform state list&lt;/code&gt;ëª…ë ¹ì–´ ì´ì™¸ì—ë„, &lt;a href=&quot;https://console.aws.amazon.com/codecommit&quot;&gt;ì½˜ì†”&lt;/a&gt; ë¡œ ì´ë™í•˜ë©´ ìƒì„±ëœ ì¸í”„ë¼ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ìƒì„±ëœ ì›ê²©ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform output&lt;/code&gt;ì„ í™œìš©í•´ &lt;strong&gt;export í™˜ê²½ ë³€ìˆ˜&lt;/strong&gt;ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tf_source_repo_clone_url_http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;terraform output source_repo_clone_url_http&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tf_source_repo_clone_url_http&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# í™•ì¸&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;git-setting&quot;&gt;Git Setting&lt;/h2&gt;

&lt;p&gt;CodeCommitì˜ Repo í™œìš©ë²•ì€ ì•„ë˜ 2ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;1-ë¡œì»¬ì—-ìœ„ì¹˜í•œ-ì½”ë“œë¥¼-codecommitì—-pushí•˜ê¸°-ì›ê²©ì €ì¥ì†Œê°€-ë¹„ì–´ìˆìŒ&quot;&gt;1. ë¡œì»¬ì— ìœ„ì¹˜í•œ ì½”ë“œë¥¼ CodeCommitì— pushí•˜ê¸° (ì›ê²©ì €ì¥ì†Œê°€ ë¹„ì–´ìˆìŒ)&lt;/h3&gt;

&lt;p&gt;ë¡œì»¬ì˜ ë¹ˆê³µê°„ì—ì„œ CodeCommit Repo ì‚¬ìš©ì„ ìœ„í•œ git remote ì§€ì •&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git init
git remote add origin &lt;span class=&quot;nv&quot;&gt;$tf_source_repo_clone_url_http&lt;/span&gt;
git remote &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# ì›ê²© ì €ì¥ì†Œ í™•ì¸&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  CodeCommitì— Pushí•˜ê¸°&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git add &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
git commit &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;First commit&quot;&lt;/span&gt;
git status
git push origin &lt;span class=&quot;c&quot;&gt;# master branchë¡œ push&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìê²© ì¦ëª… ë¬¸ì œê°€ ìˆë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¡œ í•´ê²°í•©ë‹ˆë‹¤. &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/codecommit/latest/userguide/troubleshooting-ch.html&quot;&gt;ìê²© ì¦ëª… í—¬í¼ ë° AWS CodeCommitì— ëŒ€í•œ HTTPS ì—°ê²° ë¬¸ì œ í•´ê²°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git config &lt;span class=&quot;nt&quot;&gt;--global&lt;/span&gt; credential.helper &lt;span class=&quot;s1&quot;&gt;'!aws codecommit credential-helper $@'&lt;/span&gt;
git config &lt;span class=&quot;nt&quot;&gt;--global&lt;/span&gt; credential.UseHttpPath &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-ë¡œì»¬ì—-ì›ê²©ì €ì¥ì†Œì˜-ì½”ë“œë¥¼-cloneí•˜ê¸°-ì›ê²©ì €ì¥ì†Œê°€-ë¹„ì–´ìˆì§€-ì•ŠìŒ&quot;&gt;2. ë¡œì»¬ì— ì›ê²©ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ cloneí•˜ê¸° (ì›ê²©ì €ì¥ì†Œê°€ ë¹„ì–´ìˆì§€ ì•ŠìŒ)&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone &lt;span class=&quot;nv&quot;&gt;$tf_source_repo_clone_url_http&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ì§€ê¸ˆê¹Œì§€ ë„íë¨¼íŠ¸ë¥¼ í™œìš©í•´ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , variable, output, tfvarsì˜ í™œìš©ë²•ì„ ë°°ì›Œë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì•ì„œ ì‘ì„±ëœ ì‘ì—…ë“¤ì´ ì •ìƒì ìœ¼ë¡œ ì»¤ë°‹ê³¼ cloneì´ ê°€ëŠ¥í•˜ë©´, ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="aws" />
      
        <category term="devops" />
      

      
        <summary type="html">Terraformìœ¼ë¡œ ECR íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸° 1 (CodeCommit)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">3-Tier VPC Architecture with Terraform</title>
      <link href="https://heuristicwave.github.io/3Tier" rel="alternate" type="text/html" title="3-Tier VPC Architecture with Terraform" />
      <published>2021-01-27T18:00:00+00:00</published>
      <updated>2021-01-27T18:00:00+00:00</updated>
      <id>https://heuristicwave.github.io/3Tier</id>
      <content type="html" xml:base="https://heuristicwave.github.io/3Tier">&lt;p&gt;ë³¸ ê¸€ì€ &lt;a href=&quot;https://www.aws.training/Details/eLearning?id=61799&quot;&gt;Configure and Deploying VPCs with Multiple Subnets&lt;/a&gt; ì—ì„œ ë‹¤ë£¨ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Production-Ready: The 3-Tier VPC&lt;/code&gt; ê°•ì˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í…Œë¼í¼ìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” 3ê³„ì¸µ VPC ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;Multi-Tier VPC ë€?&lt;/summary&gt;
  &lt;p&gt;&lt;br /&gt;
VPCë¥¼ êµ¬ì¶•í•  ë•Œ ë‹¨ì¼ ê³„ì¸µ VPCì— ëª¨ë“  ìì›ì„ ë„£ëŠ”ë‹¤ë©´, ë„¤íŠ¸ì›Œí¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì ì¬ì  ê³µê²©ìì—ê²Œ ìì›ì´ ë…¸ì¶œë©ë‹ˆë‹¤. ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ ì„œë¸Œë„·ìœ¼ë¡œ
ë‹¤ì¤‘ ê³„ì¸µ VPC ì•„í‚¤í…ì²˜ë¥¼ ë§Œë“¤ì–´ ë°©ì–´ ê³„ì¸µì„ ì´ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

  &lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/Multi-tier VPC.png&quot; alt=&quot;multiTier&quot; /&gt;&lt;/p&gt;
&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;ë””ìì¸-íŒ¨í„´--3-tier-vpc-architecture&quot;&gt;ë””ìì¸ íŒ¨í„´ : 3 Tier VPC Architecture&lt;/h1&gt;

&lt;p&gt;&lt;em&gt;í…Œë¼í¼ ì½”ë“œëŠ” ëª¨ë“ˆë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ì§€ë§Œ, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” 3-tier ì•„í‚¤í…ì²˜ ì¤‘ ë„¤íŠ¸ì›Œí¬ì™€ ê´€ë ¨ëœ ë¶€ë¶„ë§Œì„ ë‹¤ë¤„ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì½”ë“œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;Step 0 (í…Œë¼í¼ì„ í™œìš©í•˜ì‹¤ ì¤„ ì•ˆë‹¤ë©´ ë„˜ì–´ê°€ì„¸ìš”)&lt;/summary&gt;

  &lt;h2 id=&quot;step-0&quot;&gt;Step 0&lt;/h2&gt;

  &lt;p&gt;ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•  í´ë”ë¥¼ ë§Œë“¤ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;provider&lt;/code&gt;ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mkdir &lt;/span&gt;architecture
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;architecture
terraform init
&lt;span class=&quot;nb&quot;&gt;touch &lt;/span&gt;threeTierVPC.tf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;threeTierVPC.tf&lt;/code&gt;ì— ë²¤ë” ì •ë³´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aws&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ap-northeast-2&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;ëª…ë ¹ì–´&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform plan&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ë¥¼ í†µí•´, ì˜¤ë¥˜ ì—†ì´ í†µê³¼í•˜ëŠ” í™”ë©´ì„ í™•ì¸í•˜ê³  ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€
&lt;br /&gt;&lt;/p&gt;
  &lt;blockquote&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ë¡œ ì¸í”„ë¼ë¥¼ ë°˜ì˜ í• ë•Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-auto-approve&lt;/code&gt;ì˜µì…˜ì„ ì£¼ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yes&lt;/code&gt;ì…ë ¥ ì—†ì´ ì§„í–‰ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yes&lt;/code&gt;ë¥¼ ì…ë ¥í•˜ê¸° ì „, í•œë²ˆ ë” ê²€í† í•  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ìˆìœ¼ë¯€ë¡œ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;/blockquote&gt;
&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ğŸ’¡ê° ì†Œì œëª© ë§í¬ì— ì²¨ë¶€ëœ ì½”ë“œë¥¼ í™œìš©í•´ Step 0 ì—ì„œ ë§Œë“  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;threeTierVPC.tf&lt;/code&gt;ì— ì´ì–´ì„œ ì‘ì„±í•˜ê±°ë‚˜, ë”°ë¡œ ìƒˆë¡œìš´ íŒŒì¼ì„ ë§Œë“¤ì–´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform plan&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt; ëª…ë ¹ì–´ë¥¼ ì°¨ë¡€ë¡œ ì‘ì„±í•˜ë©° ê³„ì¸µì„ ìŒ“ì•„ ì˜¬ë¦½ë‹ˆë‹¤.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-1&quot;&gt;Step 1&lt;/h2&gt;
&lt;h3 id=&quot;layer-1ï¸âƒ£--public-subnet&quot;&gt;Layer 1ï¸âƒ£ : &lt;a href=&quot;https://github.com/heuristicwave/TIL-DevOps/blob/main/IaC/Terraform/code/3-Tier%20VPC/step1.tf&quot;&gt;Public subnet&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;í•˜ë‚˜ì˜ VPCì— 2ê°œì˜ AZë¥¼ ë§Œë“¤ê³  ê°ê°ì˜ Public ì„œë¸Œë„·ì„ ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step1.png&quot; alt=&quot;step1&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;í¼ë¸”ë¦­ ì„œë¸Œë„·ì€ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë³´ë‹¤ ì ì€ ìˆ˜ì˜ IP ì˜ˆì•½í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Step 1 ì½”ë“œë¥¼ ì ìš© í›„, ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform state list
data.aws_availability_zones.available
aws_internet_gateway.igw
aws_subnet.pub_sub_1
aws_subnet.pub_sub_2
aws_vpc.main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;details&gt;
  &lt;summary&gt;ìƒì„±í•œ ì¸í”„ë¼ê°€ ìœ„ì™€ ê°™ì§€ ì•Šì„ ê²½ìš°&lt;/summary&gt;

  &lt;p&gt;ì‹¤ìˆ˜ë¡œ ì˜ë„ì¹˜ ì•Šì€ ì¸í”„ë¼ê°€ í”„ë¡œë¹„ì €ë‹ ë˜ì—ˆë‹¤ë©´ 2ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì› ìƒíƒœë¡œ ë³µêµ¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destroy&lt;/code&gt; ëª…ë ¹ì–´ë¡œ íŠ¹ì • ì¸í”„ë¼ë§Œ ë˜ëŒë¦¬ê±°ë‚˜ í”„ë¡œë¹„ì €ë‹ í•˜ê³ ì‹¶ì€ ê²½ìš°, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-target&lt;/code&gt; ì˜µì…˜ê³¼ í•¨ê»˜ resource ëª…ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. &lt;br /&gt;
&lt;em&gt;ì˜ˆì‹œ) terraform destory -target aws_vpc.main&lt;/em&gt;&lt;/li&gt;
    &lt;li&gt;ì˜ëª» ì‘ì„±í•œ ì½”ë“œë¥¼ ìˆ˜ì • í›„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform apply&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ì—¬ ìµœì‹  ìƒíƒœì˜ ì¸í”„ë¼ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;/ol&gt;

&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-2&quot;&gt;Step 2&lt;/h2&gt;
&lt;h3 id=&quot;layer-1ï¸âƒ£--internet-access-resources&quot;&gt;Layer 1ï¸âƒ£ : &lt;a href=&quot;https://github.com/heuristicwave/TIL-DevOps/blob/main/IaC/Terraform/code/3-Tier%20VPC/step2.tf&quot;&gt;Internet access resources&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;ì™¸ë¶€ ì¸í„°ë„·ê³¼ì˜ ë…¸ì¶œì„ ì œí•œí•˜ê³  ë‚˜ê°€ëŠ” íŠ¸ë˜í”½ì„ ìœ„í•´ NAT Gatewayë¥¼ í™œìš©í•©ë‹ˆë‹¤. ë˜í•œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì„ ìœ„í•´ ALBë¥¼ ìœ„ì¹˜ì‹œì¼°ìŠµë‹ˆë‹¤.
ë¡œë“œë°¸ëŸ°ì„œì™€ NAT GatewayëŠ” ê°€ìš©ì„±ì´ ë†’ì€ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ë¡œ ë³‘ëª© í˜„ìƒì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;ğŸ’¡Nat Gateway ì•Œì•„ë³´ê¸°&lt;/summary&gt;
  &lt;p&gt;&lt;br /&gt;
NAT(ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ ë³€í™˜) ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸í„°ë„· ë˜ëŠ” ê¸°íƒ€ AWS ì„œë¹„ìŠ¤ì— ì—°ê²°í•˜ëŠ” í•œí¸, ì¸í„°ë„·ì—ì„œ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì™€ì˜ ì—°ê²°ì„ ì‹œì‘í•˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ë§Œë“¤ë ¤ë©´ NAT ê²Œì´íŠ¸ì›¨ì´ê°€ ì†í•  í¼ë¸”ë¦­ ì„œë¸Œë„·ì„ ì§€ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— Step2ì—ì„œ ìš°ì„ ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-nat-gateway.html&quot;&gt;ë„íë¨¼íŠ¸ë¡œ ë” ì•Œì•„ë³´ê¸°&lt;/a&gt;&lt;/p&gt;

&lt;/details&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step2.png&quot; alt=&quot;step2&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ê·¸ë¦¼ì—ì„œëŠ” ë³´ì´ì§€ ì•Šì§€ë§Œ, VPCì—ëŠ” ì•”ì‹œì  ë¼ìš°í„°ê°€ ìˆìœ¼ë©° ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì´ ì „ë‹¬ë˜ëŠ” ìœ„ì¹˜ë¥¼ ì œì–´í•©ë‹ˆë‹¤.
VPCì˜ ê° ì„œë¸Œë„·ì„ ë¼ìš°íŒ… í…Œì´ë¸”ì— ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤. í…Œì´ë¸”ì—ì„œëŠ” ì„œë¸Œë„·ì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Step 2 ì½”ë“œë¥¼ ì ìš© í›„, ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform state list
data.aws_availability_zones.available
aws_eip.nat_1
aws_eip.nat_2
aws_internet_gateway.igw
aws_nat_gateway.nat_gateway_1
aws_nat_gateway.nat_gateway_2
aws_route_table.route_table_pub
aws_route_table_association.route_table_association_1
aws_route_table_association.route_table_association_2
aws_subnet.pub_sub_1
aws_subnet.pub_sub_2
aws_vpc.main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ALBì™€ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”í›„, ëª¨ë“ˆë¡œ í…Œë¼í¼ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì—ì„œ í•™ìŠµí•˜ê² ìŠµë‹ˆë‹¤.&lt;/em&gt; &lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-3&quot;&gt;Step 3&lt;/h2&gt;
&lt;h3 id=&quot;layer-2ï¸âƒ£ï¸--apps-in-a-private-subnet&quot;&gt;Layer 2ï¸âƒ£ï¸ : &lt;a href=&quot;https://github.com/heuristicwave/TIL-DevOps/blob/main/IaC/Terraform/code/3-Tier%20VPC/step3.tf&quot;&gt;Apps in a private subnet&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;2ê°œì˜ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë†“ìŠµë‹ˆë‹¤. ì´í›„, ë‘ í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ì—°ê²°ëœ ALBëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„· ë¦¬ì†ŒìŠ¤ ê°„ì˜ íŠ¸ë˜í”½ì„ ë¶„ì‚°ì‹œí‚µë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;â—ï¸ì˜ˆì œ ê·¸ë¦¼ì—ì„œëŠ” Private subnetì˜ cidr blockì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.2.0/22&lt;/code&gt;ë¡œ ê°€ì´ë“œ í•˜ì§€ë§Œ, ì´ëŠ” ì•ì„œ ë§Œë“  ì„œë¸Œë„·ê³¼ ë²”ìœ„ê°€ ê²¹ì¹˜ë¯€ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.4.0/22&lt;/code&gt;ë¡œ ë°”ê¿” ì§„í–‰í•©ë‹ˆë‹¤.&lt;/strong&gt;
&lt;a href=&quot;https://www.ipaddressguide.com/cidr&quot;&gt;CIDR ê³„ì‚°ê¸°&lt;/a&gt; ì—ì„œ ì •í™•í•˜ê²Œ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step3.png&quot; alt=&quot;step3&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Step3ì—ì„œë„ Step2ì™€ ê°™ì´ ê·¸ë¦¼ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠëŠ” ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ë§Œë“¤ê³  NAT ê²Œì´íŠ¸ì›¨ì´ì™€ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„ ì—°ê²°í•´ ì¤ë‹ˆë‹¤.
í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ìš”ì²­ì´ ì™¸ë¶€ë¡œ ë‚˜ê°ˆë•ŒëŠ” NAT ê²Œì´íŠ¸ì›¨ì´ì˜ ê³ ì • IPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
(í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ë¼ìš°íŠ¸ í…Œì´ë¸”ì€ í¼ë¸”ë¦­ê³¼ ë‹¬ë¦¬ 2ê°œë¥¼ ë§Œë“¤ì–´ ê°ê° ì—°ê²°í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Step 3 ì½”ë“œë¥¼ ì ìš© í›„, ëª…ë ¹ì–´ë¡œ ì¸í”„ë¼ ìƒíƒœë¥¼ ì ê²€í•´ ì•„ë˜ì™€ ê°™ë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸš€&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;terraform state list
data.aws_availability_zones.available
aws_eip.nat_1
aws_eip.nat_2
aws_internet_gateway.igw
aws_nat_gateway.nat_gateway_1
aws_nat_gateway.nat_gateway_2
aws_route.private_nat_1
aws_route.private_nat_2
aws_route_table.route_table_pri_1
aws_route_table.route_table_pri_2
aws_route_table.route_table_pub
aws_route_table_association.route_table_association_1
aws_route_table_association.route_table_association_2
aws_route_table_association.route_table_pri_association_1
aws_route_table_association.route_table_pri_association_2
aws_subnet.pri_sub_1
aws_subnet.pri_sub_2
aws_subnet.pub_sub_1
aws_subnet.pub_sub_2
aws_vpc.main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ DBì™€ ì¸ìŠ¤í„´ìŠ¤ ì—°ê²°ì€ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”í›„, ëª¨ë“ˆë¡œ í…Œë¼í¼ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì—ì„œ í•™ìŠµí•˜ê² ìŠµë‹ˆë‹¤.&lt;/em&gt; &lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-4&quot;&gt;Step 4&lt;/h2&gt;
&lt;h3 id=&quot;layer-3ï¸âƒ£--data-in-a-second-private-subnet&quot;&gt;Layer 3ï¸âƒ£ : Data in a second private subnet&lt;/h3&gt;

&lt;p&gt;ì²« ë²ˆì§¸ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë’¤ì— ë‘ ë²ˆì§¸ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„ ë°°ì¹˜í•©ë‹ˆë‹¤. (ì½”ë“œ ìƒëµ) &lt;br /&gt;
ì¥ì• ê°€ ë°œìƒí•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ read-replica í˜¹ì€ standby êµ¬ì„±ìœ¼ë¡œ ë°°ì¹˜í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;â—Step4ì˜ ì„œë¸Œë„· ì‘ì„±ë²•ì€ Step3ì˜ ë°©ë²•ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ì•„ë˜ ì‚¬ì§„ì€ CIDRì˜ ë²”ìœ„ê°€ ê²¹ì¹˜ë¯€ë¡œ, Private subnetì˜ cidr blockì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.8.0/23&lt;/code&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.12.0/23&lt;/code&gt;ë¡œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.10.0/23&lt;/code&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.14.0/23&lt;/code&gt;ìœ¼ë¡œ ë°”ê¿” ì§„í–‰í•˜ì„¸ìš”.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step4.png&quot; alt=&quot;step4&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ë°ì´í„° ë¦¬ì†ŒìŠ¤(/23)ë³´ë‹¤ë¥¼ ì•± ë¦¬ì†ŒìŠ¤(/22)ë¥¼ í™•ì¥í•  ê°€ëŠ¥ì„±ì´ ì»¤, ë” í° ì„œë¸Œë„· ë§ˆìŠ¤í¬ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-5&quot;&gt;Step 5&lt;/h2&gt;
&lt;h3 id=&quot;leave-extra-ips-available&quot;&gt;Leave extra IPs available&lt;/h3&gt;

&lt;p&gt;ë°°í¬ëœ ì¸í”„ë¼ê°€ í™•ì¥ë˜ì–´ ì•„í‚¤í…ì²˜ê°€ ë³€ê²½ë  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì—¬ìœ ë¶„ì˜ IPë¥¼ ì˜ˆì•½ì„ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. (ì½”ë“œ ìƒëµ)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/post/vpc-step5.png&quot; alt=&quot;step5&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ìœ„ì™€ ê°™ì€ ë‹¨ê³„ë“¤ì„ í†µí•´ &lt;strong&gt;3 Tier VPC Architecture&lt;/strong&gt;ë¥¼ í•™ìŠµí•´ë³´ì•˜ìŠµë‹ˆë‹¤.
Terraformìœ¼ë¡œ ìƒì„±ëœ ìì›ë“¤ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;terraform destory&lt;/code&gt;ëª…ë ¹ì–´ë¥¼ í†µí•´ í•™ìŠµì„ ì‹œì‘í•˜ê¸° ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ì„¸ìš”.
ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ìƒëµí–ˆë˜ ì¸ìŠ¤í„´ìŠ¤, DB, LB ë“±ì„ ëª¨ë“ˆë¡œ ê´€ë¦¬í•˜ë©° ë‹¤ë¤„ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;span class=&quot;table-of-contents-list&quot;&gt;Terraform Courses&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;table-of-contents-list&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;./3Tier&quot;&gt;3-Tier VPC Architecture with Terraform&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeCommit&quot;&gt;ECR Pipeline with Terraform â…  (CodeCommit)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodeBuild&quot;&gt;ECR Pipeline with Terraform â…¡ (ECR, CodeBuild, IAM)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;./CodePipeline&quot;&gt;ECR Pipeline with Terraform â…¢ (CodePipeline)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="devops" />
      
        <category term="aws" />
      

      
        <summary type="html">ë³¸ ê¸€ì€ Configure and Deploying VPCs with Multiple Subnets ì—ì„œ ë‹¤ë£¨ëŠ” Production-Ready: The 3-Tier VPC ê°•ì˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í…Œë¼í¼ìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” 3ê³„ì¸µ VPC ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Pipenv, Nginx, Gunicorn ì„œë²„ ìš´ì˜í•˜ê¸°</title>
      <link href="https://heuristicwave.github.io/pipenv01" rel="alternate" type="text/html" title="Pipenv, Nginx, Gunicorn ì„œë²„ ìš´ì˜í•˜ê¸°" />
      <published>2021-01-04T00:40:00+00:00</published>
      <updated>2021-01-04T00:40:00+00:00</updated>
      <id>https://heuristicwave.github.io/pipenv01</id>
      <content type="html" xml:base="https://heuristicwave.github.io/pipenv01">&lt;p&gt;&lt;strong&gt;Virtualenv&lt;/strong&gt; í™˜ê²½ì´ ì•„ë‹Œ &lt;strong&gt;Pipenv&lt;/strong&gt;ë¥¼ ì‚¬ìš©í•˜ë©° ë§Œë‚œ ì—ëŸ¬ í•´ê²° ê³¼ì • ì •ë¦¬&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ì‚¬ì „-ì‘ì—…&quot;&gt;ì‚¬ì „ ì‘ì—…&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;ìì„¸í•œ ë°©ë²•ì€ í•˜ë‹¨ ì°¸ê³ ìë£Œë¥¼ í†µí•´ í™•ì¸ í•  ìˆ˜ ìˆë‹¤&lt;/em&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;gunicorn, nginx ì„¤ì¹˜&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ec2ì—ì„œ nginx ì„¤ì¹˜í•˜ê¸° : &lt;a href=&quot;https://holjjack.tistory.com/114&quot;&gt;CentOS 7 Nginx ì„¤ì¹˜ ë°©ë²•&lt;/a&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;gunicorn ì‘ë™í™•ì¸&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;gunicorn-&quot;&gt;Gunicorn ğŸ¦„&lt;/h2&gt;

&lt;h3 id=&quot;ì„œë¹„ìŠ¤-ë“±ë¡-ìŠ¤í¬ë¦½íŠ¸-ìƒì„±&quot;&gt;ì„œë¹„ìŠ¤ ë“±ë¡ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/systemd/system/gunicorn.service&lt;/code&gt; íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì€ ë‚´ìš©ìœ¼ë¡œ ìƒì„±.
pipenvëŠ” venvì™€ &lt;strong&gt;ExecStart&lt;/strong&gt; ê²½ë¡œê°€ ë‹¤ë¥´ë‹¤ëŠ” ì ì„ ìœ ë…í•´ ì‘ì„±í•˜ì&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=ec2-user
Group=ec2-user
WorkingDirectory=/home/ec2-user/django/repo
ExecStart=/usr/local/bin/pipenv run gunicorn --workers 3 \
        &amp;lt;wsgiê°€ ìœ„ì¹˜í•œ í´ë”&amp;gt;.wsgi:application --bind 0.0.0.0:8000

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ë³¸ë˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--bind&lt;/code&gt;ë¶€ë¶„ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unix:/home/ec2-user/django/gunicorn.sock&lt;/code&gt; ë¥¼ ë„£ì–´ êµ¬ë™í•˜ë©´ repoì˜ ìƒìœ„ í´ë”ì—  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gunicorn.sock&lt;/code&gt;ê°€ ìƒê¸´ë‹¤.
&lt;br /&gt;
nginxì˜ proxy_pass ë¶€ë¶„ë„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://unix:/{$PATH}/gunicorn.sock&lt;/code&gt;ì„ ê¸°ì¬í•´ sockë¡œ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ë§ëŠ” ë°©ë²• ê°™ì€ë°â€¦ ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” í•™ìŠµì´ í•„ìš”í•˜ë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;ì„œë¹„ìŠ¤-ë“±ë¡&quot;&gt;ì„œë¹„ìŠ¤ ë“±ë¡&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl start gunicorn
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;gunicorn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ì„œë¹„ìŠ¤-êµ¬ë™-í™•ì¸&quot;&gt;ì„œë¹„ìŠ¤ êµ¬ë™ í™•ì¸&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl status gunicorn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;nginx&quot;&gt;Nginx&lt;/h2&gt;

&lt;h3 id=&quot;ì‚¬ì´íŠ¸-ì„¤ì •-ì¶”ê°€&quot;&gt;ì‚¬ì´íŠ¸ ì„¤ì • ì¶”ê°€&lt;/h3&gt;

&lt;p&gt;ec2ì— nginxë¥¼ ë°›ì•˜ì„ ë•Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc/nginx/sites-enabled&lt;/code&gt; ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc/nginx/sites-availabe&lt;/code&gt; ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. í•´ë‹¹ ê²½ë¡œì— ì—†ë‹¤ë©´ ë§Œë“¤ì–´ì£¼ê³  ìˆìœ¼ë©´ default íŒŒì¼ì„ ì‚­ì œí•˜ì.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server {
        listen 80;
        server_name &amp;lt;IP or ë„ë©”ì¸&amp;gt;;
        charset utf-8;

        location / {
                include proxy_params;
                proxy_pass http://0.0.0.0:8000
        }

        location /static/ {
                root /home/ec2-user/django/repo;
        }
        
        location /media/ {
                root /home/ec2-user/django/repo;
        }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://velog.io/@yvvyoon/flask-nginx-gunicorn-1&quot;&gt;nginx ì£¼ìš” ê°œë…&lt;/a&gt;, nginx : &lt;a href=&quot;https://ohgyun.com/556&quot;&gt;root vs alias&lt;/a&gt;
&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;include proxy_params&lt;/code&gt;ì˜ ê²½ìš° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/proxy_params&lt;/code&gt; ì— í”„ë¡ì‹œ í—¤ë”ë¥¼ ê¸°ì¬ í•´ì•¼ í•œë‹¤. (ë‹¤ìŒ ë§í¬ ì°¸ê³ ) 
&lt;a href=&quot;https://m.blog.naver.com/PostView.nhn?blogId=93immm&amp;amp;logNo=221304593384&amp;amp;proxyReferer=https:%2F%2Fwww.google.com%2F&quot;&gt;nginx &amp;amp; aws&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;ì‚¬ì´íŠ¸-ì¶”ê°€&quot;&gt;ì‚¬ì´íŠ¸ ì¶”ê°€&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo ln&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; /etc/nginx/sites-available/django_test /etc/nginx/sites-enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ê¸°ë™&quot;&gt;ê¸°ë™&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl start nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ê¸°íƒ€-ë„ì›€ì´-ë˜ëŠ”-ëª…ë ¹ì–´&quot;&gt;ê¸°íƒ€ ë„ì›€ì´ ë˜ëŠ” ëª…ë ¹ì–´&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl daemon-reload
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl stop, restart nginx
ps &lt;span class=&quot;nt&quot;&gt;-ef&lt;/span&gt;
ps
pkill gunicorn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;dotenv ê´€ë ¨ ì—ëŸ¬ í•´ê²°í•˜ê¸°&lt;/summary&gt;

  &lt;ul&gt;
    &lt;li&gt;
      &lt;p&gt;gunicorn ì„ í™œìš©í•´ ì—°ê²° í•  ê²½ìš°&lt;/p&gt;

      &lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip uninstall dotenv
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;python-dotenv 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;      &lt;/div&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;docker + nginx + gunicorn ì„ í™œìš©í•  ê²½ìš°&lt;/p&gt;

      &lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip uninstall dotenv
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;python-dotenv 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;      &lt;/div&gt;
    &lt;/li&gt;
  &lt;/ul&gt;

&lt;/details&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;ì°¸ê³ ìë£Œ&quot;&gt;ì°¸ê³ ìë£Œ&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;gunicorn &lt;a href=&quot;https://wikidocs.net/6601#_7&quot;&gt;ì‚¬ì „ì‘ì—…&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://velog.io/@y1andyu/Nginx-gunicorn-Django-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0#3-%EC%8B%9C%EC%9E%91&quot;&gt;Nginx, Gunicorn, Django ì—°ë™í•˜ê¸°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>

      
      
      
      
      

      <author>
          <name>Heuristic Wave</name>
        
        
      </author>

      

      
        <category term="backend" />
      

      
        <summary type="html">Virtualenv í™˜ê²½ì´ ì•„ë‹Œ Pipenvë¥¼ ì‚¬ìš©í•˜ë©° ë§Œë‚œ ì—ëŸ¬ í•´ê²° ê³¼ì • ì •ë¦¬</summary>
      

      
      
    </entry>
  
</feed>
