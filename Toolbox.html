<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- Custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />
    
    <!-- TOC CSS - 포스트 페이지에서만 로드 -->
    
    <link rel="stylesheet" type="text/css" href="//assets/css/toc.css" />
    
    
    <!-- Inline Dark Theme CSS for immediate effect -->
    <style>
    /* Dark Theme Styles */
    [data-theme="dark"] body {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .site-main {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-card {
        background-color: #2a2d32 !important;
        border-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-card-title,
    [data-theme="dark"] .post-card-excerpt,
    [data-theme="dark"] .post-card-content-link,
    [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, 
    [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] h6,
    [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] div {
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-full-content {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] .post-template .site-main,
    [data-theme="dark"] .page-template .site-main {
        background-color: #15171a !important;
    }
    
    /* 포스트 카드 메타 영역 - 카드와 동일한 배경색 */
    [data-theme="dark"] .post-card-meta {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
        border-top: 1px solid #3a3d42 !important;
        margin: 0 !important;
        padding: 15px 25px !important;
    }
    
    /* 작성자 정보 통일감 있게 조정 - 더 구체적인 선택자 */
    [data-theme="dark"] .post-card-author,
    [data-theme="dark"] .author-card-name,
    [data-theme="dark"] .author-card-name a,
    [data-theme="dark"] .post-full-meta,
    [data-theme="dark"] .post-full-meta-date,
    [data-theme="dark"] .post-card-meta .post-card-author,
    [data-theme="dark"] .post-card-meta a {
        color: #ffffff !important;
    }
    
    /* 읽기 시간 정보 - 흰색으로 통일 */
    [data-theme="dark"] .reading-time {
        color: #ffffff !important;
    }
    
    /* 태그 정보 */
    [data-theme="dark"] .post-card-tags {
        color: #c5d2d9 !important;
    }
    
    /* 작성자 프로필 이미지 테두리 */
    [data-theme="dark"] .author-profile-image {
        border: 2px solid #3a3d42 !important;
    }
    
    /* 포스트 메타 정보 전체 - 카드와 완전히 통일 */
    [data-theme="dark"] .post-card-meta,
    [data-theme="dark"] .post-card-meta *:not(a) {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    /* 메타 영역의 모든 하위 요소들 */
    [data-theme="dark"] .post-card-meta *,
    [data-theme="dark"] .post-card-meta .post-card-author,
    [data-theme="dark"] .post-card-meta .reading-time,
    [data-theme="dark"] .post-card-meta span,
    [data-theme="dark"] .post-card-meta div {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    /* 메타 영역의 링크들 */
    [data-theme="dark"] .post-card-meta a {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
    }
    
    /* 메타 영역 구분선 스타일 */
    [data-theme="dark"] .post-card-meta {
        position: relative;
        border-radius: 0 0 8px 8px !important;
    }
    
    [data-theme="dark"] .post-card-meta::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background-color: #3a3d42;
    }
    
    /* 카테고리/태그 링크 */
    [data-theme="dark"] .post-card-tags a,
    [data-theme="dark"] .tag {
        color: #3eb0ef !important;
    }
    
    /* 댓글 시스템 스타일 개선 */
    [data-theme="dark"] .post-full-comments,
    [data-theme="dark"] .post-full-comments * {
        background-color: #15171a !important;
        color: #ffffff !important;
    }
    
    /* 댓글 입력 폼 */
    [data-theme="dark"] .post-full-comments input,
    [data-theme="dark"] .post-full-comments textarea,
    [data-theme="dark"] .post-full-comments button {
        background-color: #2a2d32 !important;
        color: #ffffff !important;
        border: 1px solid #3a3d42 !important;
    }
    
    /* 라이트 모드에서 댓글 부분 수정 */
    [data-theme="light"] .post-full-comments,
    [data-theme="light"] .post-full-comments *,
    body:not([data-theme="dark"]) .post-full-comments,
    body:not([data-theme="dark"]) .post-full-comments * {
        background-color: #ffffff !important;
        color: #15171a !important;
    }
    
    /* 더 구체적인 작성자 정보 선택자들 */
    [data-theme="dark"] .post-card-meta .post-card-author,
    [data-theme="dark"] .post-card-meta a[href*="author"],
    [data-theme="dark"] .post-card-meta span,
    [data-theme="dark"] .author-list .author-card-name,
    [data-theme="dark"] .byline-meta .author,
    [data-theme="dark"] .author-meta,
    [data-theme="dark"] .post-meta .author {
        color: #ffffff !important;
    }
    
    /* 읽기 시간 더 구체적으로 */
    [data-theme="dark"] .post-card-meta .reading-time,
    [data-theme="dark"] .reading-time,
    [data-theme="dark"] .post-meta .reading-time,
    [data-theme="dark"] [class*="reading"],
    [data-theme="dark"] [class*="min-read"] {
        color: #ffffff !important;
    }
    
    /* 모든 메타 정보를 강제로 흰색 처리 */
    [data-theme="dark"] .post-card-meta > *,
    [data-theme="dark"] .post-card-meta span,
    [data-theme="dark"] .post-card-meta div,
    [data-theme="dark"] .post-card-meta a:not([href*="tag"]) {
        color: #ffffff !important;
    }
    
    /* 전역적으로 모든 텍스트를 흰색으로 (네비게이션 제외) */
    [data-theme="dark"] body *:not(.site-nav *):not(.site-header *) {
        color: #ffffff !important;
    }
    
    /* 링크는 파란색으로 */
    [data-theme="dark"] a:not(.site-nav a):not(.site-header a) {
        color: #3eb0ef !important;
    }
    
    /* Copy 버튼 숨기기 */
    .copy-button,
    .copy-btn,
    [class*="copy"],
    button[title*="Copy"],
    button[aria-label*="Copy"],
    .highlight .copy,
    pre .copy,
    code .copy,
    .code-toolbar .toolbar,
    .code-toolbar .toolbar-item {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
    }
    
    /* 일반적인 Copy 텍스트가 포함된 요소들 숨기기 */
    *[class*="copy"]:not(.copyright),
    *[id*="copy"]:not(.copyright),
    button:contains("Copy"),
    span:contains("Copy -->"),
    div:contains("Copy -->") {
        display: none !important;
    }
    
    [data-theme="dark"] a:not(.site-nav a) {
        color: #3eb0ef !important;
    }
    
    /* Bold and Strong text - 더 밝은 색상으로 강조 */
    [data-theme="dark"] strong,
    [data-theme="dark"] b,
    [data-theme="dark"] .post-full-content strong,
    [data-theme="dark"] .post-full-content b {
        color: #ffffff !important;
        font-weight: 700 !important;
        text-shadow: 0 0 1px rgba(255, 255, 255, 0.3) !important;
    }
    
    /* Inline code blocks - 배경색과 테두리로 구분 */
    [data-theme="dark"] code,
    [data-theme="dark"] .post-full-content code {
        background-color: #2a2d32 !important;
        color: #a4d037 !important; /* 연두색으로 강조 */
        border: 1px solid #3a3d42 !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        font-weight: 500 !important;
    }
    
    /* Pre code blocks - 더 어두운 배경 */
    [data-theme="dark"] pre,
    [data-theme="dark"] .post-full-content pre {
        background-color: #1a1d20 !important;
        border: 1px solid #3a3d42 !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] pre code,
    [data-theme="dark"] .post-full-content pre code {
        background-color: transparent !important;
        border: none !important;
        color: #ffffff !important;
        padding: 0 !important;
    }
    
    /* Emphasis and italic text */
    [data-theme="dark"] em,
    [data-theme="dark"] i,
    [data-theme="dark"] .post-full-content em,
    [data-theme="dark"] .post-full-content i {
        color: #c5d2d9 !important;
        font-style: italic !important;
    }
    
    /* Blockquotes - 좌측 보더와 배경으로 구분 */
    [data-theme="dark"] blockquote,
    [data-theme="dark"] .post-full-content blockquote {
        background-color: #1f2124 !important;
        border-left: 4px solid #3eb0ef !important;
        color: #c5d2d9 !important;
        padding: 15px 20px !important;
        margin: 20px 0 !important;
        border-radius: 0 4px 4px 0 !important;
    }
    
    [data-theme="dark"] blockquote p,
    [data-theme="dark"] .post-full-content blockquote p {
        color: #c5d2d9 !important;
    }
    
    /* Lists - 리스트 마커 색상 */
    [data-theme="dark"] ul,
    [data-theme="dark"] ol,
    [data-theme="dark"] li {
        color: #ffffff !important;
    }
    
    /* Tables - 테이블 스타일 개선 */
    [data-theme="dark"] table,
    [data-theme="dark"] .post-full-content table {
        background-color: #2a2d32 !important;
        border: 1px solid #3a3d42 !important;
    }
    
    [data-theme="dark"] th,
    [data-theme="dark"] td,
    [data-theme="dark"] .post-full-content th,
    [data-theme="dark"] .post-full-content td {
        background-color: #2a2d32 !important;
        border: 1px solid #3a3d42 !important;
        color: #ffffff !important;
    }
    
    [data-theme="dark"] th,
    [data-theme="dark"] .post-full-content th {
        background-color: #1f2124 !important;
        font-weight: 700 !important;
    }
    
    /* Horizontal rules */
    [data-theme="dark"] hr {
        border-color: #3a3d42 !important;
        background-color: #3a3d42 !important;
    }
    
    /* Mark/highlight text */
    [data-theme="dark"] mark {
        background-color: #fecd35 !important;
        color: #15171a !important;
        padding: 2px 4px !important;
        border-radius: 2px !important;
    }
    
    /* Small text */
    [data-theme="dark"] small {
        color: #738a94 !important;
    }
    
    /* Theme Toggle Button Improvements */
    #theme-toggle {
        /* 다른 플로팅 요소들과 겹치지 않도록 */
        pointer-events: auto !important;
    }
    
    /* 플로팅 모드일 때만 적용되는 스타일 */
    #theme-toggle[data-mode="floating"] {
        /* 모바일에서 위치 조정 */
        @media (max-width: 768px) {
            top: 70px !important;
            right: 15px !important;
            width: 44px !important;
            height: 44px !important;
            font-size: 16px !important;
        }
        
        /* 태블릿에서 위치 조정 */
        @media (min-width: 769px) and (max-width: 1024px) {
            top: 75px !important;
            right: 20px !important;
        }
    }
    
    /* 네비게이션 모드 스타일 */
    .site-nav-right #theme-toggle {
        flex-shrink: 0;
    }
    
    /* 다크 테마에서 네비게이션 버튼 스타일 */
    [data-theme="dark"] .site-nav-right #theme-toggle {
        border-color: rgba(255, 255, 255, 0.3) !important;
        color: #fff !important;
    }
    
    [data-theme="dark"] .site-nav-right #theme-toggle:hover {
        border-color: rgba(255, 255, 255, 0.5) !important;
        background: rgba(255, 255, 255, 0.1) !important;
    }
    
    /* 플로팅 헤더와 겹치지 않도록 조정 */
    .floating-header {
        z-index: 9998 !important;
    }
    
    /* 공유 버튼들과 겹치지 않도록 */
    .floating-header-share {
        z-index: 9997 !important;
    }
    
    /* 스크롤 시 테마 토글 버튼 위치 조정 */
    body.floating-active #theme-toggle {
        top: 120px !important;
        transition: top 0.3s ease !important;
    }
    </style>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- webfont -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Careful Writer" />
    <link rel="shortcut icon" href="https://heuristicwave.github.io/assets/built/images/water-wave-48.png" type="image/png" />
    <link rel="canonical" href="https://heuristicwave.github.io/Toolbox" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Heuristic Wave Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)" />
    <meta property="og:description" content="이 포스팅에서는 Text-to-SQL의 기본 개념과 기존 접근 방법들의 한계를 살펴보고, Google Cloud Next 25에서 발표된 MCP Toolbox for Databases(구 Gen AI Toolbox for Databases)를 통해 이러한 문제를 어떻게 해결할 수 있는지 알아봅니다. 🗣️ Text-to-SQL이란? Text-to-SQL(혹은 NL2SQL, Natural Language to SQL)은 사용자의 자연어 질문을 SQL 쿼리로 자동 변환하는 기술입니다. 이를 통해" />
    <meta property="og:url" content="https://heuristicwave.github.io/Toolbox" />
    <meta property="og:image" content="https://heuristicwave.github.io/assets/built/images/background/toolbox.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2025-10-23T00:00:00+00:00" />
    <meta property="article:modified_time" content="2025-10-23T00:00:00+00:00" />
    <meta property="article:tag" content="Genai" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)" />
    <meta name="twitter:description" content="이 포스팅에서는 Text-to-SQL의 기본 개념과 기존 접근 방법들의 한계를 살펴보고, Google Cloud Next 25에서 발표된 MCP Toolbox for Databases(구 Gen AI Toolbox for Databases)를 통해 이러한 문제를 어떻게 해결할 수 있는지 알아봅니다. 🗣️ Text-to-SQL이란? Text-to-SQL(혹은 NL2SQL, Natural Language to SQL)은 사용자의 자연어 질문을 SQL 쿼리로 자동 변환하는 기술입니다. 이를 통해" />
    <meta name="twitter:url" content="https://heuristicwave.github.io/" />
    <meta name="twitter:image" content="https://heuristicwave.github.io/assets/built/images/background/toolbox.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Heuristic Wave Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Genai" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Heuristic Wave Blog",
        "logo": "https://heuristicwave.github.io/"
    },
    "url": "https://heuristicwave.github.io/Toolbox",
    "image": {
        "@type": "ImageObject",
        "url": "https://heuristicwave.github.io/assets/built/images/background/toolbox.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://heuristicwave.github.io/Toolbox"
    },
    "description": "이 포스팅에서는 Text-to-SQL의 기본 개념과 기존 접근 방법들의 한계를 살펴보고, Google Cloud Next 25에서 발표된 MCP Toolbox for Databases(구 Gen AI Toolbox for Databases)를 통해 이러한 문제를 어떻게 해결할 수 있는지 알아봅니다. 🗣️ Text-to-SQL이란? Text-to-SQL(혹은 NL2SQL, Natural Language to SQL)은 사용자의 자연어 질문을 SQL 쿼리로 자동 변환하는 기술입니다. 이를 통해"
}
    </script>
    <script data-ad-client="ca-pub-6093187208665634" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0FTXSPJZFY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-0FTXSPJZFY');
    </script>
    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)" href="https://heuristicwave.github.io/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://heuristicwave.github.io/">Heuristic Wave Blog</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-extracurricular" role="menuitem"><a href="/tag/uncategorized/">Uncategorized</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/ai/">AI</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/aws/">AWS</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/backend/">Back-end</a></li>
    <li class="nav-devops" role="menuitem"><a href="/tag/devops/">DevOps</a></li>
    <li class="nav-backend" role="menuitem"><a href="/tag/security/">Security</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#search">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-genai tag-database post tag-ai ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="23 October 2025">23 October 2025</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/genai/'>GENAI</a>,
                            
                        
                            
                               <a href='/tag/database/'>DATABASE</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/background/toolbox.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>이 포스팅에서는 Text-to-SQL의 기본 개념과 기존 접근 방법들의 한계를 살펴보고, Google Cloud Next 25에서 발표된 MCP Toolbox for Databases(구 Gen AI Toolbox for Databases)를 통해 이러한 문제를 어떻게 해결할 수 있는지 알아봅니다.</p>

<h2 id="️-text-to-sql이란"><a href="#text2sql">🗣️ Text-to-SQL이란?</a><a id="text2sql"></a></h2>

<p>Text-to-SQL(혹은 NL2SQL, Natural Language to SQL)은 사용자의 자연어 질문을 SQL 쿼리로 자동 변환하는 기술입니다. 이를 통해 SQL에 익숙하지 않은 사용자도 필요한 정보를 쉽게 조회할 수 있습니다.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>👤 사용자 질문: "2024년에 생성된 사용자가 몇 명인가요?"
             ↓
🤖 AI 변환
             ↓
💾 SQL 쿼리: SELECT COUNT(*) FROM users WHERE created_at &gt;= '2024-01-01' AND created_at &lt; '2025-01-01';
</code></pre></div></div>

<h3 id="기존-text-to-sql-구현-방법들">기존 Text-to-SQL 구현 방법들</h3>

<h4 id="1-직접-llm-호출-방식">1. 직접 LLM 호출 방식</h4>

<p>가장 단순한 방법은 LLM에 데이터베이스 스키마와 질문을 함께 전달하여 SQL을 생성하는 것입니다.</p>

<details>
  <summary>📍 LLM 기반 Text-to-SQL 예시</summary>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 데이터베이스 스키마 정보
</span><span class="n">schema</span> <span class="o">=</span> <span class="s">"""
CREATE TABLE users (
    id SERIAL PRIMARY KEY, email VARCHAR(255), created_at TIMESTAMP
);
"""</span>

<span class="c1"># LLM 호출
</span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s">"MODEL NAME"</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span>
        <span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span>
        <span class="s">"content"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"""
        다음 스키마를 참고하여 SQL 쿼리를 생성하세요: </span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s">
        
        질문: "2024년에 생성된 사용자가 몇 명인가요?"
        """</span>
    <span class="p">}]</span>
<span class="p">)</span>

<span class="n">sql_query</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">text</span>

<span class="c1"># 생성된 SQL을 직접 실행...
</span></code></pre></div>  </div>
</details>

<p>이 방식은 데이터베이스 연결 관리, 스키마 업데이트, 보안 대응 등 여러 문제점이 있지만, 그중에서도 핵심 문제는 <strong>LLM의 성능에 전적으로 의존</strong>한다는 점입니다. 복잡한 스키마나 비즈니스 로직이 있는 경우 모델이 정확한 SQL을 생성한다는 보장이 없습니다.</p>

<h4 id="2-모델-파인튜닝-방식">2. 모델 파인튜닝 방식</h4>

<p>1번 방식의 정확도 문제를 해결하기 위해 특정 DB 스키마와 도메인에 특화된 모델을 파인튜닝할 수 있습니다.</p>

<details>
  <summary>📍 학습에 사용할 SQL 쿼리 QA 데이터셋 수집 예시</summary>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">training_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">"messages"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span>
                <span class="s">"content"</span><span class="p">:</span> <span class="s">"스키마: users(id, email, created_at)</span><span class="se">\n\n</span><span class="s">질문: 2024년에 가입한 사용자 수는?"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">"role"</span><span class="p">:</span> <span class="s">"assistant"</span><span class="p">,</span> 
                <span class="s">"content"</span><span class="p">:</span> <span class="s">"SELECT COUNT(*) FROM users 
                WHERE created_at &gt;= '2024-01-01' AND created_at &lt; '2025-01-01';"</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">"messages"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span>
                <span class="s">"content"</span><span class="p">:</span> <span class="s">"스키마: orders(id, user_id, amount, order_date), users(id, name)
                </span><span class="se">\n\n</span><span class="s">질문: 지난 달 가장 많이 구매한 고객 5명은?"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">"role"</span><span class="p">:</span> <span class="s">"assistant"</span><span class="p">,</span>
                <span class="s">"content"</span><span class="p">:</span> <span class="s">"SELECT u.name, COUNT(o.id) as order_count, SUM(o.amount) as total_spent 
                FROM users u JOIN orders o ON u.id = o.user_id 
                WHERE o.order_date &gt;= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 month') 
                    AND o.order_date &lt; DATE_TRUNC('month', CURRENT_DATE) 
                GROUP BY u.id, u.name ORDER BY total_spent DESC LIMIT 5;"</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
    <span class="c1"># ... 수백~수천 개의 예시
</span><span class="p">]</span>
</code></pre></div>  </div>
</details>

<p>이 방식은 특정 스키마에 대한 높은 정확도와 추론 비용 절감의 장점이 있지만, 고품질 데이터셋 수집, 데이터 레이블링 비용, 스키마 변경 시 재학습 등 여러 문제점이 있습니다. 그중에서도 핵심 문제는 <strong>많은 리소스가 투입됨에도 불구하고 정확도를 보장받을 수 없다</strong>는 점입니다. 예상치 못한 질문이나 새로운 테이블에 대해서는 여전히 한계가 있습니다.</p>

<h4 id="3-메타데이터--예시-쿼리-rag-방식">3. 메타데이터 &amp; 예시 쿼리 RAG 방식</h4>

<p>1, 2번 방식이 전체 스키마 정보를 LLM에 직접 전달하거나 학습시키는 방식이었다면, 대규모 환경에서는 RAG(Retrieval Augmented Generation)를 활용하여 <strong>쿼리 작성에 필요한 관련 정보를 선택적으로 검색</strong>하는 방식을 고려할 수 있습니다.</p>

<p><strong>사전 준비 단계</strong></p>

<ol>
  <li>Knowledge Base 구성
    <ul>
      <li>테이블 메타데이터</li>
      <li>예시 SQL 쿼리</li>
      <li>비즈니스 용어 사전</li>
      <li>테이블 관계 설명</li>
      <li>데이터 활용 가이드</li>
    </ul>
  </li>
  <li>Knowledge Base의 모든 정보를 벡터로 변환하여 Vector DB에 저장</li>
</ol>

<p><strong>추론(Inference) 단계</strong></p>

<ol>
  <li>User Query : “지난 달 가장 많이 구매한 고객 5명은?”</li>
  <li>Semantic Search (Vector DB)
 질문과 유사도가 높은 관련 정보를 Vector DB에서 검색
    <ul>
      <li>“월별 고객 구매 분석” 예시 쿼리</li>
      <li>users, orders 테이블 관계 설명</li>
      <li>“구매” → purchase_date 컬럼 매핑 메타데이터</li>
    </ul>
  </li>
  <li>Context Builder : <code class="language-plaintext highlighter-rouge">Prompt</code> = <code class="language-plaintext highlighter-rouge">User Query + 검색된 관련 정보 + 필요한 스키마</code></li>
  <li>SQL 생성 및 실행 : LLM이 검색된 예시와 메타데이터를 참고하여 SQL 쿼리 생성</li>
</ol>

<p>이러한 RAG 기반 접근 방식은 널리 알려진 방법으로, 많은 기업들이 벡터 데이터베이스를 활용하여 다양한 쿼리 관련 지식(예시 쿼리, 데이터 사전, 활용 가이드 등)을 임베딩하고, 사용자 질문에 맞는 정보를 검색하여 Text-to-SQL의 정확도를 높이고 있습니다. 주요 CSP와 벤더들도 이러한 접근법을 활용하여 <strong>Managed Service</strong>로 제공하는 추세입니다. AWS에서는 <strong>Amazon Bedrock Knowledge Bases의 Structured Data Retrieval</strong> 기능으로 제공되며, Google Cloud, Azure 등 다른 주요 CSP와 벤더들도 동일한 원리로 Text-to-SQL을 지원하고 있습니다.</p>

<p>이 방식은 대규모 환경에서 관련 정보를 효율적으로 검색하고 LLM에 풍부한 컨텍스트를 제공할 수 있다는 장점이 있지만, 지식 베이스 구축 및 관리, 벡터DB 동기화, 임베딩 비용, 초기 설정 복잡도 등 여러 문제점이 있습니다. 그중에서도 핵심 문제는 <strong>여전히 LLM의 SQL 생성 능력에 의존</strong>하며, 검색된 정보의 품질과 관련성이 낮으면 잘못된 쿼리가 생성될 수 있다는 점입니다.</p>

<h4 id="4-data--analytics-mcp를-활용한-context-engineering">4. Data &amp; Analytics MCP를 활용한 Context Engineering</h4>

<p>이 방식은 1, 2, 3번과는 완전히 다른 접근 방식입니다. 이전 방식들이 <strong>사전에 준비한 컨텍스트</strong>를 활용해 SQL을 생성하는 방법이었다면, MCP는 <strong>별도의 Knowledge Base나 RAG 시스템 구축 없이</strong>, <strong>LLM 에이전트가 도구(Tool)</strong>를 사용하여 데이터베이스와 직접 상호작용합니다.</p>

<p><strong>MCP 기반 접근 방식</strong></p>

<p>오픈소스 커뮤니티에서는 다양한 데이터베이스와 분석 서비스를 위한 MCP 서버를 제공하고 있습니다.</p>

<ul>
  <li><strong>관계형 DB</strong>: PostgreSQL, MySQL, SQLite, Microsoft SQL Server</li>
  <li><strong>NoSQL</strong>: MongoDB, Redis, Cassandra, CouchDB</li>
  <li><strong>데이터 웨어하우스</strong>: Google BigQuery, Snowflake, Amazon Redshift</li>
  <li><strong>시계열 DB</strong>: InfluxDB, TimescaleDB</li>
  <li><strong>검색 엔진</strong>: Elasticsearch, OpenSearch</li>
  <li><strong>기타</strong>: ClickHouse, Neo4j, Supabase 등</li>
</ul>

<p>이러한 MCP 서버들은 데이터베이스의 <strong>CRUD(Create, Read, Update, Delete) 기능을 기본적으로 지원</strong>합니다. LLM이 SQL을 직접 생성하는 대신, MCP가 제공하는 도구(tools)를 사용하여 다음과 같이 동작합니다.</p>

<ol>
  <li><strong>스키마 탐색</strong>: <code class="language-plaintext highlighter-rouge">list_tables()</code>, <code class="language-plaintext highlighter-rouge">describe_table()</code> 등의 도구로 테이블 구조 파악</li>
  <li><strong>데이터 조회</strong>: <code class="language-plaintext highlighter-rouge">query_table()</code>, <code class="language-plaintext highlighter-rouge">get_item()</code> 등으로 필요한 데이터 조회</li>
  <li><strong>반복적 탐색</strong>: 사용자의 요청을 만족하는 정보를 얻기까지 <strong>N회 이상의 쿼리를 반복적으로 수행</strong></li>
  <li><strong>결과 종합</strong>: 여러 번의 조회 결과를 종합하여 최종 답변 생성</li>
</ol>

<p><strong>예시 시나리오:</strong> “지난 달 가장 많이 구매한 고객 5명은?”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1회차: list_tables() → users, orders, products 테이블 확인
2회차: describe_table("orders") → 컬럼 구조 파악
3회차: describe_table("users") → 컬럼 구조 파악
4회차: query_table("orders", filter="order_date &gt; ...") → 지난 달 주문 조회
5회차: query_table("users", filter="id IN (...)") → 고객 정보 조회
6회차: 데이터 집계 및 정렬
</code></pre></div></div>

<p>이 방식은 LLM이 데이터베이스와 직접 상호작용하므로 SQL 생성 오류 위험이 줄어드는 장점이 있지만, 다음과 같은 문제점이 있습니다.</p>

<p><strong>한계점</strong></p>
<ul>
  <li><strong>토큰 소모량 증가</strong>: 원하는 정보를 얻기 위해 여러 번의 도구 호출이 필요하며, 각 호출마다 토큰 소모</li>
  <li><strong>레이턴시 증가</strong>: N회의 왕복(round-trip)으로 인한 응답 시간 지연</li>
  <li><strong>비용 증가</strong>: 토큰 사용량과 API 호출 횟수에 비례하여 비용 상승</li>
  <li><strong>복잡한 쿼리 비효율</strong>: 조인이나 집계가 필요한 경우 여러 번의 조회 필요</li>
  <li><strong>데이터베이스 부하</strong>: 단일 SQL 쿼리로 해결할 수 있는 것을 여러 번의 쿼리로 나누어 실행하여 부하 증가</li>
</ul>

<p>그중에서도 핵심 문제는 <strong>효율성</strong>입니다. 단일 SQL 쿼리로 해결할 수 있는 질문에 대해 여러 번의 도구 호출과 토큰 소모가 발생하여, 특히 대규모 운영 환경에서는 비용과 성능 측면에서 비효율적일 수 있습니다.</p>

<p><br /></p>

<h2 id="-엔터프라이즈-환경에서의-추가-고려사항"><a href="#enterprise-challenges">🏢 엔터프라이즈 환경에서의 추가 고려사항</a><a id="enterprise-challenges"></a></h2>

<p>위에서 살펴본 1~4번 접근 방식은 각각의 고유한 한계를 가지고 있습니다. 하지만 실제 엔터프라이즈 프로덕션 환경에서는 이러한 기술적 한계 외에도 운영, 보안, 거버넌스 측면에서 추가적인 과제들을 해결해야 합니다.</p>

<table>
  <thead>
    <tr>
      <th>과제 영역</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>연결 관리</strong></td>
      <td>데이터베이스 연결 풀링, 타임아웃 처리, 재연결 로직을 직접 구현하고 관리</td>
    </tr>
    <tr>
      <td><strong>보안 및 인증</strong></td>
      <td>OAuth2/OIDC 통합, 역할 기반 접근 제어(RBAC), 파라미터 검증 등을 직접 구현</td>
    </tr>
    <tr>
      <td><strong>스키마 동기화</strong></td>
      <td>스키마 변경 시마다 코드 수정, 재배포 필요. 실시간 반영 어려움</td>
    </tr>
    <tr>
      <td><strong>관찰성</strong></td>
      <td>로깅, 메트릭, 분산 트레이싱을 별도로 구축. 디버깅과 모니터링 복잡</td>
    </tr>
    <tr>
      <td><strong>배포 및 유지보수</strong></td>
      <td>데이터베이스별로 드라이버 설치, 의존성 관리, 버전 호환성 처리 필요</td>
    </tr>
  </tbody>
</table>

<p>이러한 운영상의 복잡성으로 인해 <strong>Text-to-SQL을 프로덕션 환경에서 안전하고 효율적으로 운영하기가 매우 어렵습니다.</strong> 특히 엔터프라이즈 환경에서 요구되는 보안, 확장성, 유지보수성, 거버넌스 요구사항을 충족하려면 상당한 엔지니어링 리소스가 필요합니다.</p>

<p><br /></p>

<h2 id="-mcp-toolbox를-통한-해결"><a href="#toolbox">🔧 MCP Toolbox를 통한 해결</a><a id="toolbox"></a></h2>

<p>1번 방식은 모델 성능에만 의존하고, 2번 파인튜닝은 리소스가 많이 들뿐더러 정확도를 보장받을 수 없습니다. 3번 RAG 방식은 여전히 LLM의 SQL 생성 능력에 의존하며, 4번 MCP 방식은 토큰 소모와 레이턴시 문제가 있습니다. 게다가 모든 방식이 엔터프라이즈 프로덕션 환경에서는 연결 관리, 보안, 스키마 동기화, 관찰성 등의 복잡한 운영 과제에 직면하게 됩니다. 이러한 한계점들을 줄이기 위해 오픈소스 <strong>MCP Toolbox for Databases</strong>(이하, Toolbox)를 활용할 수 있습니다.</p>

<p>Toolbox는 MCP(Model Context Protocol) 표준을 활용하여 <strong>Text-to-SQL의 복잡성을 추상화</strong>하는 오픈소스 MCP 서버입니다
Text2SQL에 대한 은탄환은 아니지만, 기존 방식들의 문제점(토큰 소모, 레이턴시, SQL 생성 의존성 등)을 완화하고, 프로덕션 환경에서 필요한 연결 관리, 보안, 관찰성 등의 운영 과제를 단순화하는 데 도움을 줍니다.</p>

<p>물론, 앞서 언급한 엔터프라이즈 프로덕션 환경에서의 추가 고려사항(보안, 스케일링, 모니터링 등)은 더 깊이 있는 논의가 필요한 주제들입니다. 이러한 내용들은 후속 편을 통해 차차 풀어나갈 예정이니, 이번 편에서는 먼저 MCP Toolbox의 기본 개념과 구조부터 차근차근 살펴보겠습니다.</p>

<h3 id="overview">Overview</h3>

<p>Toolbox는 애플리케이션의 오케스트레이션 프레임워크(예: ADK, Strands Agents, LangGraph, LlamaIndex)와 데이터베이스 사이에 위치하여, 도구를 수정하고 배포하거나 호출하는 컨트롤 플레인을 제공합니다. 이를 통해 중앙화된 위치에서 도구를 저장하고 업데이트할 수 있으며, 에이전트와 애플리케이션 간에 도구를 공유하고 애플리케이션 재배포 없이 업데이트할 수 있습니다.</p>

<p><img src="../../assets/built/images/post/ai/Toolbox/architecture.png" alt="MCP Toolbox Architecture" /></p>

<h3 id="지원하는-데이터베이스">지원하는 데이터베이스</h3>

<p>MCP Toolbox는 다양한 <a href="https://googleapis.github.io/genai-toolbox/resources/sources/">Google Cloud 리소스 및 오픈소스 데이터베이스</a>를 지원합니다.</p>
<ul>
  <li><strong>Google Cloud</strong>: AlloyDB, Cloud SQL, Spanner, Bigtable 등</li>
  <li><strong>오픈소스</strong>: 자체 관리형 MySQL 및 PostgreSQL 등</li>
  <li><strong>서드파티</strong>: Neo4j, Dgraph 등 커뮤니티 기여 데이터베이스 등</li>
</ul>

<h3 id="빠르게-시작하기">빠르게 시작하기</h3>

<p>Toolbox를 사용하려면 먼저 <a href="https://github.com/googleapis/genai-toolbox?tab=readme-ov-file#installing-the-server">바이너리를 다운로드</a>하고,
<code class="language-plaintext highlighter-rouge">tools.yaml</code> 설정 파일을 작성한 후 다음 명령어로 <code class="language-plaintext highlighter-rouge">./toolbox --tools-file "tools.yaml"</code> 서버를 실행하면 됩니다.</p>

<p><strong>tools.yaml 기본 구조</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sources</span><span class="pi">:</span>                    <span class="c1"># 데이터베이스 연결 정보</span>
  <span class="na">my-database</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">database</span><span class="pi">:</span> <span class="s">mydb</span>

<span class="na">tools</span><span class="pi">:</span>                      <span class="c1"># 사용할 Tool 정의</span>
  <span class="na">search-users</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">postgres-sql</span>
    <span class="na">source</span><span class="pi">:</span> <span class="s">my-database</span>
    <span class="na">statement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SELECT</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">FROM</span><span class="nv"> </span><span class="s">users</span><span class="nv"> </span><span class="s">WHERE</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">$1"</span>
    <span class="na">parameters</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_name</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div>

<p>이렇게 간단한 설정만으로 Toolbox 서버가 시작됩니다. 하지만 이 뒤에서는 어떤 일들이 일어날까요?</p>

<p>Toolbox는 <strong>Plugin Architecture</strong>를 통해 32개의 Source와 120여 개 이상의 사전 정의된 Tool을 자동으로 인식합니다(v0.17.0 기준). <code class="language-plaintext highlighter-rouge">tools.yaml</code>에서 <code class="language-plaintext highlighter-rouge">kind: postgres-sql</code>처럼 지정하면 해당 Tool을 찾아 바로 사용할 수 있고, 파일을 수정하면 데이터베이스 연결부터 Tool 설정까지 자동으로 처리되며 서버 재시작 없이 즉시 반영됩니다. 간단해 보이지만, 내부적으로는 정교한 메커니즘이 동작하고 있습니다.</p>

<p><br /></p>

<h2 id="️-아키텍처-deep-dive"><a href="#architecture">🏗️ 아키텍처 Deep Dive</a><a id="architecture"></a></h2>

<p>Go 언어로 작성된 Toolbox는 AI 애플리케이션과 데이터베이스 사이에서 중간 계층으로 동작합니다.</p>

<h3 id="주요-컴포넌트">주요 컴포넌트</h3>

<details>
  <summary>📍 Toolbox Architecture</summary>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌────────────────────────────────────────────────────────┐
│              Client Layer (HTTP/MCP Protocol)          │
└────────────────────────────────────────────────────────┘
                            │                            
                            ▼
┌────────────────────────────────────────────────────────┐
│                    Toolbox Server (Go)                 │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Server Layer (internal/server/)                 │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Tools Layer (internal/tools/)                   │  │
│  │  - 120+ Tool                                     │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Sources Layer (internal/sources/)               │  │
│  │  - 32+ DB Driver &amp; Connection Pooling            │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Observability (internal/telemetry/, log/)       │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────┘
                            │                          
                            ▼
┌────────────────────────────────────────────────────────┐
│                     Database Layer                     │
└────────────────────────────────────────────────────────┘
</code></pre></div>  </div>
</details>

<p><strong>1. Client Layer (클라이언트 통신)</strong></p>
<ul>
  <li>프로토콜: HTTP/MCP Protocol, JSON-RPC 2.0</li>
  <li>클라이언트: AI 프레임워크(LlamaIndex, Strands Agents), IDE(Claude Desktop, Cursor)</li>
</ul>

<p><strong>2. Toolbox Server</strong></p>
<ul>
  <li>Server Layer: HTTP 서버와 MCP 프로토콜 핸들러를 제공하여 클라이언트 요청 처리</li>
  <li>Tools Layer: 각 데이터베이스에 특화된 120개 이상의 Tool 구현체를 포함하며, 파라미터 검증과 실행 로직 담당</li>
  <li>Sources Layer: 32개의 데이터베이스 드라이버와 연결 풀링, 인증 처리 제공</li>
  <li>Observability Layer: OpenTelemetry를 통한 메트릭, 트레이싱, 로깅을 제공하여 프로덕션 운영 지원</li>
</ul>

<p><strong>3. Database Layer (데이터베이스 통신)</strong></p>
<ul>
  <li>프로토콜: 각 데이터베이스의 네이티브 프로토콜 사용 (Wire Protocol, MySQL Protocol, gRPC 등)</li>
  <li>지원 DB: PostgreSQL, MySQL, BigQuery, MongoDB, Redis, Spanner, AlloyDB 등</li>
</ul>

<h3 id="configuration-flow">Configuration Flow</h3>

<p>앞서 간단히 살펴본 <code class="language-plaintext highlighter-rouge">tools.yaml</code> 파일이 Toolbox 서버 시작 시 어떻게 로딩되는지 자세히 알아보겠습니다.</p>

<table>
  <thead>
    <tr>
      <th>단계</th>
      <th>작업</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>CLI 시작 &amp; YAML 파일 로딩</td>
      <td><code class="language-plaintext highlighter-rouge">--tools-file</code> 등 플래그 파싱</td>
    </tr>
    <tr>
      <td>2</td>
      <td>환경 변수 치환</td>
      <td><code class="language-plaintext highlighter-rouge">${DB_HOST:localhost}</code> → <code class="language-plaintext highlighter-rouge">"localhost"</code></td>
    </tr>
    <tr>
      <td>3</td>
      <td>YAML 파싱</td>
      <td>Sources(DB 연결), AuthServices(인증), Tools(Tool 정의), Toolsets(그룹화) 파싱</td>
    </tr>
    <tr>
      <td>4</td>
      <td>리소스 초기화</td>
      <td>Connection Pool 생성, 인증 서비스 설정, Tool 인스턴스 생성</td>
    </tr>
    <tr>
      <td>5</td>
      <td>서버 시작</td>
      <td>HTTP Server &amp; MCP Protocol Handler 시작</td>
    </tr>
    <tr>
      <td>6</td>
      <td>동적 리로딩</td>
      <td>fsnotify로 파일 변경 감지하여 무중단 리로드</td>
    </tr>
  </tbody>
</table>

<h3 id="tool-execution-flow">Tool Execution Flow</h3>

<p>Toolbox 서버가 실행된 후, 실제 사용자의 자연어 질문이 쿼리로 변환되는 과정은 다음과 같습니다.</p>

<table>
  <thead>
    <tr>
      <th>단계</th>
      <th>작업</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>클라이언트 요청</td>
      <td>HTTP API: POST <code class="language-plaintext highlighter-rouge">/tool/{toolName}/invoke</code> 또는 MCP Protocol: <code class="language-plaintext highlighter-rouge">tools/call</code></td>
    </tr>
    <tr>
      <td>2</td>
      <td>인증 &amp; 권한 검증</td>
      <td>Authorization Header 추출, Auth Service 검증, Tool 접근 권한 확인</td>
    </tr>
    <tr>
      <td>3</td>
      <td>파라미터 파싱</td>
      <td>JSON Body 디코딩, 파라미터 검증 &amp; 타입 변환</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Tool 실행</td>
      <td>Template 파라미터 처리, 표준 파라미터 추출, DB 쿼리 실행, 결과를 JSON 형태로 변환</td>
    </tr>
    <tr>
      <td>5</td>
      <td>응답 반환</td>
      <td>성공 시 JSON 형태로 결과 반환, 실패 시 에러 메시지 및 상태 코드 반환</td>
    </tr>
    <tr>
      <td>6</td>
      <td>텔레메트리 기록</td>
      <td>Tracing(요청 시작부터 종료까지 추적), Metrics(Tool 호출 횟수, 레이턴시 등) 기록</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h2 id="-다음-편-안내"><a href="#next">📖 다음 편 안내</a><a id="next"></a></h2>

<p>지금까지 Text-to-SQL의 다양한 접근 방법과 그 한계를 살펴보았고, MCP Toolbox의 아키텍처와 핵심 컴포넌트를 이해했습니다. Plugin Architecture를 통한 확장성, Configuration Flow를 통한 유연한 설정 관리, 그리고 Tool Execution Flow를 통한 체계적인 실행 과정을 배웠습니다. 이제 이러한 지식을 바탕으로 <strong><a href="./Toolbox-2.html">2편</a></strong>에서는 Strands Agents와 통합하여 자연어로 데이터를 분석하는 실전 AI 에이전트를 구축하는 방법을 다룹니다.</p>

<p><br /></p>

<p>📚 더 알아보기:</p>
<ul>
  <li><a href="https://googleapis.github.io/genai-toolbox/getting-started/introduction/">MCP Toolbox for Databases 공식 문서</a></li>
  <li><a href="https://cloud.google.com/blog/products/ai-machine-learning/mcp-toolbox-for-databases-now-supports-model-context-protocol">MCP Toolbox for Databases: Simplify AI Agent Access to Enterprise Data</a></li>
  <li><a href="https://codelabs.developers.google.com/travel-agent-mcp-toolbox-adk">Build a Travel Agent using MCP Toolbox for Databases and ADK</a></li>
</ul>

<p><br /></p>

<hr />

                </div>
            </section>

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/myGopher.png" alt="HeuristicWave" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/HeuristicWave">Jihun Lim</a></h4>
                                
                                    <p><a href="https://feedly.com/i/subscription/feed/https://heuristicwave.github.io/feed.xml">Follow my blog</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/HeuristicWave">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- Email subscribe form at the bottom of the page
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Heuristic Wave Blog</h3>
                    <p>Get the latest posts delivered right via RSS</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm" />
    <input class="location" type="hidden" name="location" />
    <input class="referrer" type="hidden" name="referrer" />

    <div class="form-group">
        <input class="subscribe-email" type="url" name="rss url" value="https://heuristicwave.github.io" readonly />
    </div>
    <!--To Do Rss Web Font <i class="fas fa-rss"></i> -->
    <button class="" type="submit" disabled><span>Copy</span></button>
    <script
        type="text/javascript">(function (g, h, o, s, t) { h[o]('.location')[s] = h[o]('.location')[s] || g.location.href; h[o]('.referrer')[s] = h[o]('.referrer')[s] || h.referrer; })(window, document, 'querySelector', 'value');</script>
</form>
                </section>
             -->

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://heuristicwave.github.io/Toolbox';
                            this.page.identifier = '/Toolbox';
                            this.page.title = 'Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://heuristicwave-github-io.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Heuristic Wave Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/genai/">Genai</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Fine-tuning-Nova">Amazon Nova Vision 기능 모델 증류 하기: Fine-Tuning Text-Image-to-Text</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Kendra2">Exploring Amazon Kendra GenAI Index with Amazon Bedrock Knowledge Bases</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/BedrockOpenAI">OpenAI-Compatible RESTful APIs</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/genai/">
                                
                                    See all 10 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Fine-tuning-Nova">
                <div class="post-card-image" style="background-image: url(/assets/built/images/background/AmazonNova.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Fine-tuning-Nova">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Aws</span>
                            
                        
                            
                                <span class="post-card-tags">Genai</span>
                            
                        
                    

                    <h2 class="post-card-title">Amazon Nova Vision 기능 모델 증류 하기: Fine-Tuning Text-Image-to-Text</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/myGopher.png" alt="Jihun Lim" />
                        
                        <span class="post-card-author">
                            <a href="/author/HeuristicWave/">Jihun Lim</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://heuristicwave.github.io/">
            
            <span>Heuristic Wave Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Text-to-SQL, 왜 프로덕션에선 어려울까? (1편 - MCP Toolbox 소개)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Text-to-SQL%2C+%EC%99%9C+%ED%94%84%EB%A1%9C%EB%8D%95%EC%85%98%EC%97%90%EC%84%A0+%EC%96%B4%EB%A0%A4%EC%9A%B8%EA%B9%8C%3F+%281%ED%8E%B8+-+MCP+Toolbox+%EC%86%8C%EA%B0%9C%29&amp;url=https://heuristicwave.github.ioToolbox"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://heuristicwave.github.ioToolbox"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://heuristicwave.github.io/">Heuristic Wave Blog</a> &copy; 2025</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="search" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">블로그 검색</h1>
                <p class="subscribe-overlay-description">원하는 글을 빠르게 찾아보세요</p>
                
                <div class="modal-search-container">
                    <div class="modal-search-form">
                        <input type="text" id="modal-search-input" placeholder="검색어를 입력하세요..." class="modal-search-input">
                        <button type="button" id="modal-search-button" class="modal-search-button">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="modal-search-status" id="modal-search-status"></div>
                    <div class="modal-search-results" id="modal-search-results"></div>
                    
                    <div class="modal-search-footer">
                        <a href="/search.html" class="modal-search-link">고급 검색 페이지로 이동 →</a>
                    </div>
                </div>
            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>
    
    <!-- Modal Search Script -->
    
    <script src="/assets/js/lunr.js"></script>
    <script src="/assets/js/modal-search.js"></script>
    

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Theme Toggle Script - Inline for immediate execution -->
    <script>
    (function() {
        'use strict';
        
        console.log('Theme toggle script loaded');
        
        // Theme constants
        const THEMES = {
            LIGHT: 'light',
            DARK: 'dark'
        };
        
        const STORAGE_KEY = 'heuristic-wave-theme';
        const html = document.documentElement;
        
        function getCurrentTheme() {
            const savedTheme = localStorage.getItem(STORAGE_KEY);
            if (savedTheme && Object.values(THEMES).includes(savedTheme)) {
                return savedTheme;
            }
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return THEMES.DARK;
            }
            
            return THEMES.LIGHT;
        }
        
        function applyTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem(STORAGE_KEY, theme);
            console.log('Theme applied:', theme);
            
            // Force comprehensive theme changes for immediate visual feedback
            if (theme === THEMES.DARK) {
                // Apply dark theme styles
                document.body.style.backgroundColor = '#15171a';
                document.body.style.color = '#ffffff';
                
                // Main content areas
                const siteMain = document.querySelector('.site-main');
                if (siteMain) {
                    siteMain.style.backgroundColor = '#15171a';
                    siteMain.style.color = '#ffffff';
                }
                
                // Post cards
                const postCards = document.querySelectorAll('.post-card');
                postCards.forEach(card => {
                    card.style.backgroundColor = '#2a2d32';
                    card.style.borderColor = '#2a2d32';
                    card.style.color = '#ffffff';
                });
                
                // All text content
                const textElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div, a, .post-card-title, .post-card-excerpt, .post-full-title, .post-full-content');
                textElements.forEach(element => {
                    if (!element.closest('.site-nav')) { // Skip navigation elements
                        element.style.color = '#ffffff';
                    }
                });
                
                // 작성자 정보와 메타 정보들 통일감 있게 처리
                const authorElements = document.querySelectorAll('.post-card-author, .author-card-name, .author-card-name a, .post-full-meta, .post-full-meta-date');
                authorElements.forEach(element => {
                    element.style.color = '#ffffff';
                });
                
                // 메타 정보들 강력하게 처리 - 배경색과 텍스트 색상 모두
                const metaElements = document.querySelectorAll('.post-card-meta, .post-card-meta *, .reading-time, .post-card-tags, .post-card-author');
                metaElements.forEach(element => {
                    element.style.setProperty('background-color', '#2a2d32', 'important');
                    element.style.setProperty('color', '#ffffff', 'important');
                });
                
                // 메타 영역 자체 스타일링
                const metaContainers = document.querySelectorAll('.post-card-meta');
                metaContainers.forEach(meta => {
                    meta.style.setProperty('background-color', '#2a2d32', 'important');
                    meta.style.setProperty('border-top', '1px solid #3a3d42', 'important');
                    meta.style.setProperty('border-radius', '0 0 8px 8px', 'important');
                    meta.style.setProperty('margin', '0', 'important');
                });
                
                // 특별히 작성자 이름 강제 적용
                const authorNames = document.querySelectorAll('.post-card-author, [class*="author"]');
                authorNames.forEach(element => {
                    element.style.setProperty('color', '#ffffff', 'important');
                });
                
                // 읽기 시간도 강제 적용
                const readingTimes = document.querySelectorAll('.reading-time, [class*="reading"]');
                readingTimes.forEach(element => {
                    element.style.setProperty('color', '#ffffff', 'important');
                });
                
                // 프로필 이미지 테두리
                const profileImages = document.querySelectorAll('.author-profile-image');
                profileImages.forEach(img => {
                    img.style.border = '2px solid #3a3d42';
                });
                
                // 댓글 시스템 다크 모드 적용
                const commentElements = document.querySelectorAll('.post-full-comments, .post-full-comments *');
                commentElements.forEach(element => {
                    element.style.backgroundColor = '#15171a';
                    element.style.color = '#ffffff';
                });
                
                // 댓글 입력 폼들
                const commentInputs = document.querySelectorAll('.post-full-comments input, .post-full-comments textarea, .post-full-comments button');
                commentInputs.forEach(input => {
                    input.style.backgroundColor = '#2a2d32';
                    input.style.color = '#ffffff';
                    input.style.border = '1px solid #3a3d42';
                });
                
                // Post content links
                const postContent = document.querySelectorAll('.post-card-content-link, .post-full-content');
                postContent.forEach(content => {
                    content.style.color = '#ffffff';
                    content.style.backgroundColor = '#15171a';
                });
                
                // Post full content background
                const postFullContent = document.querySelectorAll('.post-full-content, .post-template .site-main, .page-template .site-main');
                postFullContent.forEach(content => {
                    content.style.backgroundColor = '#15171a';
                    content.style.color = '#ffffff';
                });
                
            } else {
                // Reset to light theme
                document.body.style.backgroundColor = '#f4f8fb';
                document.body.style.color = '#15171a';
                
                const siteMain = document.querySelector('.site-main');
                if (siteMain) {
                    siteMain.style.backgroundColor = '';
                    siteMain.style.color = '';
                }
                
                // Reset all elements to default
                const postCards = document.querySelectorAll('.post-card');
                postCards.forEach(card => {
                    card.style.backgroundColor = '';
                    card.style.borderColor = '';
                    card.style.color = '';
                });
                
                // Reset all text elements
                const textElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div, a, .post-card-title, .post-card-excerpt, .post-full-title, .post-full-content');
                textElements.forEach(element => {
                    element.style.color = '';
                });
                
                const postContent = document.querySelectorAll('.post-card-content-link, .post-full-content');
                postContent.forEach(content => {
                    content.style.color = '';
                    content.style.backgroundColor = '';
                });
                
                // Reset post full content
                const postFullContent = document.querySelectorAll('.post-full-content, .post-template .site-main, .page-template .site-main');
                postFullContent.forEach(content => {
                    content.style.backgroundColor = '';
                    content.style.color = '';
                });
                
                // Reset 작성자 정보와 메타 정보들
                const authorElements = document.querySelectorAll('.post-card-author, .author-card-name, .author-card-name a, .post-full-meta, .post-full-meta-date');
                authorElements.forEach(element => {
                    element.style.color = '';
                });
                
                // 메타 영역 완전 리셋
                const metaElements = document.querySelectorAll('.post-card-meta, .post-card-meta *, .reading-time, .post-card-tags');
                metaElements.forEach(element => {
                    element.style.backgroundColor = '';
                    element.style.color = '';
                    element.style.border = '';
                    element.style.borderRadius = '';
                    element.style.margin = '';
                });
                
                const metaContainers = document.querySelectorAll('.post-card-meta');
                metaContainers.forEach(meta => {
                    meta.style.backgroundColor = '';
                    meta.style.borderTop = '';
                    meta.style.borderRadius = '';
                    meta.style.margin = '';
                });
                
                const profileImages = document.querySelectorAll('.author-profile-image');
                profileImages.forEach(img => {
                    img.style.border = '';
                });
                
                // 댓글 시스템 라이트 모드 리셋
                const commentElements = document.querySelectorAll('.post-full-comments, .post-full-comments *');
                commentElements.forEach(element => {
                    element.style.backgroundColor = '';
                    element.style.color = '';
                });
                
                const commentInputs = document.querySelectorAll('.post-full-comments input, .post-full-comments textarea, .post-full-comments button');
                commentInputs.forEach(input => {
                    input.style.backgroundColor = '';
                    input.style.color = '';
                    input.style.border = '';
                });
            }
        }
        
        function toggleTheme() {
            const currentTheme = getCurrentTheme();
            const newTheme = currentTheme === THEMES.LIGHT ? THEMES.DARK : THEMES.LIGHT;
            applyTheme(newTheme);
            return newTheme;
        }
        
        function createThemeToggle() {
            if (document.getElementById('theme-toggle')) {
                return document.getElementById('theme-toggle');
            }
            
            const button = document.createElement('button');
            button.id = 'theme-toggle';
            button.innerHTML = '🌙';
            
            // 현재 페이지가 포스트 페이지인지 확인
            const isPostPage = document.body.classList.contains('post-template');
            
            if (isPostPage) {
                // 포스트 페이지: 처음에는 네비게이션에 위치
                setupNavigationButton(button);
            } else {
                // 다른 페이지: 항상 네비게이션에 위치
                setupNavigationButton(button);
            }
            
            button.addEventListener('click', function() {
                const newTheme = toggleTheme();
                button.innerHTML = newTheme === THEMES.DARK ? '☀️' : '🌙';
                console.log('Theme toggled to:', newTheme);
            });
            
            console.log('Theme toggle button created');
            return button;
        }
        
        function setupNavigationButton(button) {
            // 네비게이션 바 스타일
            button.style.cssText = `
                position: relative;
                width: 40px;
                height: 40px;
                margin-left: 10px;
                padding: 0;
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                color: #fff;
                cursor: pointer;
                transition: all 0.3s ease;
                opacity: 0.8;
                font-size: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            // 호버 효과
            button.addEventListener('mouseenter', function() {
                button.style.opacity = '1';
                button.style.borderColor = 'rgba(255, 255, 255, 0.5)';
                button.style.background = 'rgba(255, 255, 255, 0.1)';
            });
            
            button.addEventListener('mouseleave', function() {
                button.style.opacity = '0.8';
                button.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                button.style.background = 'transparent';
            });
            
            // 네비게이션에 추가
            const navRight = document.querySelector('.site-nav-right');
            const socialLinks = document.querySelector('.social-links');
            
            if (navRight) {
                navRight.appendChild(button);
            } else if (socialLinks) {
                socialLinks.appendChild(button);
            } else {
                // 폴백: body에 추가하되 네비게이션 스타일 유지
                document.body.appendChild(button);
                button.style.position = 'fixed';
                button.style.top = '20px';
                button.style.right = '20px';
                button.style.zIndex = '1000';
            }
            
            // 포스트 페이지에서만 스크롤 감지
            if (document.body.classList.contains('post-template')) {
                setupScrollBehavior(button);
            }
        }
        
        function setupScrollBehavior(button) {
            let isFloating = false;
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const shouldFloat = scrollTop > 200; // 200px 스크롤 후 플로팅 모드
                
                if (shouldFloat && !isFloating) {
                    // 플로팅 모드로 전환
                    isFloating = true;
                    button.setAttribute('data-mode', 'floating');
                    button.style.cssText = `
                        position: fixed;
                        top: 80px;
                        right: 25px;
                        z-index: 9999;
                        width: 48px;
                        height: 48px;
                        border: 2px solid rgba(255, 255, 255, 0.2);
                        border-radius: 50%;
                        background: linear-gradient(135deg, #3eb0ef 0%, #2a8bc7 100%);
                        color: white;
                        font-size: 18px;
                        cursor: pointer;
                        box-shadow: 
                            0 4px 15px rgba(62, 176, 239, 0.3),
                            0 2px 8px rgba(0, 0, 0, 0.2);
                        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        backdrop-filter: blur(10px);
                        -webkit-backdrop-filter: blur(10px);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        opacity: 1;
                        transform: translateY(0);
                    `;
                    
                    // 플로팅 모드 호버 효과 재설정
                    button.onmouseenter = function() {
                        button.style.transform = 'translateY(-2px) scale(1.05)';
                        button.style.boxShadow = `
                            0 6px 20px rgba(62, 176, 239, 0.4),
                            0 4px 12px rgba(0, 0, 0, 0.3)
                        `;
                    };
                    
                    button.onmouseleave = function() {
                        button.style.transform = 'translateY(0) scale(1)';
                        button.style.boxShadow = `
                            0 4px 15px rgba(62, 176, 239, 0.3),
                            0 2px 8px rgba(0, 0, 0, 0.2)
                        `;
                    };
                    
                } else if (!shouldFloat && isFloating) {
                    // 네비게이션 모드로 복원
                    isFloating = false;
                    button.removeAttribute('data-mode');
                    
                    // 원래 위치로 버튼 이동
                    const navRight = document.querySelector('.site-nav-right');
                    if (navRight && !navRight.contains(button)) {
                        navRight.appendChild(button);
                    }
                    
                    setupNavigationButton(button);
                }
                
                // 플로팅 헤더와 겹치지 않도록 조정
                if (isFloating) {
                    const floatingHeader = document.querySelector('.floating-header');
                    if (floatingHeader && floatingHeader.classList.contains('floating-active')) {
                        button.style.top = '120px';
                    } else {
                        button.style.top = '80px';
                    }
                }
            }, { passive: true });
        }
        
        function init() {
            console.log('Initializing theme system...');
            const initialTheme = getCurrentTheme();
            applyTheme(initialTheme);
            
            function setupButton() {
                const button = createThemeToggle();
                button.innerHTML = initialTheme === THEMES.DARK ? '☀️' : '🌙';
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupButton);
            } else {
                setupButton();
            }
        }
        
        // Initialize immediately
        init();
    })();
    </script>

    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-0FTXSPJZFY', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

        <!-- TOC JavaScript - 포스트 페이지에서만 로드 -->
        <script src="/assets/js/toc.js"></script>
    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
